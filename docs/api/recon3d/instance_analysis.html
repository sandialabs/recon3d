<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>recon3d.instance_analysis API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../recon3d.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;recon3d</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#calc_moment">calc_moment</a>
            </li>
            <li>
                    <a class="function" href="#center_of_mass">center_of_mass</a>
            </li>
            <li>
                    <a class="function" href="#centroid_pix">centroid_pix</a>
            </li>
            <li>
                    <a class="function" href="#ellipsoid_surface_area">ellipsoid_surface_area</a>
            </li>
            <li>
                    <a class="function" href="#ellipsoid_volume">ellipsoid_volume</a>
            </li>
            <li>
                    <a class="function" href="#equivalent_spherical_diameter">equivalent_spherical_diameter</a>
            </li>
            <li>
                    <a class="function" href="#fit_ellipsoid">fit_ellipsoid</a>
            </li>
            <li>
                    <a class="function" href="#instance_indices">instance_indices</a>
            </li>
            <li>
                    <a class="function" href="#minimum_size_filter">minimum_size_filter</a>
            </li>
            <li>
                    <a class="function" href="#map_features_to_voxels">map_features_to_voxels</a>
            </li>
            <li>
                    <a class="function" href="#nearest_neighbor_distance">nearest_neighbor_distance</a>
            </li>
            <li>
                    <a class="function" href="#num_voxels">num_voxels</a>
            </li>
            <li>
                    <a class="function" href="#process_image_stack">process_image_stack</a>
            </li>
            <li>
                    <a class="function" href="#save_instance_images">save_instance_images</a>
            </li>
            <li>
                    <a class="function" href="#semantic_to_instance">semantic_to_instance</a>
            </li>
            <li>
                    <a class="function" href="#instance_analysis_included">instance_analysis_included</a>
            </li>
            <li>
                    <a class="function" href="#instance_properties">instance_properties</a>
            </li>
            <li>
                    <a class="function" href="#process">process</a>
            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../recon3d.html">recon3d</a><wbr>.instance_analysis    </h1>

                        <div class="docstring"><p>Basic workflow for processing grayscale image stacks to labeled images for
feature property measurement.</p>

<p>This module supports multiple phases (&gt;2 phases) and includes simple
segmentation for demonstration purposes.</p>

<p>It writes outputs as image directories, but can be integrated with HDF for
internal dataset storage.</p>
</div>

                        <input id="mod-instance_analysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-instance_analysis-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">Basic workflow for processing grayscale image stacks to labeled images for</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">feature property measurement.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">This module supports multiple phases (&gt;2 phases) and includes simple</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">segmentation for demonstration purposes.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">It writes outputs as image directories, but can be integrated with HDF for</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">internal dataset storage.</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="c1"># TODO Integrate with HDF writing</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="c1"># TODO Integrate with feature measurements</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="c1"># TODO Use constants for Z axis in other module</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="c1"># TODO Simplify/Impose structure for image directory (dataset directory in HDF)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="c1"># to remove magic numbers and indexing of phase_paths and label_paths</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="c1"># TODO Devise better solution for multiphase support without if/else blocks</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Final</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">List</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npt</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">skimage.io</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">skio</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">NearestNeighbors</span> <span class="k">as</span> <span class="n">sklearnNN</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">skimage.measure</span><span class="w"> </span><span class="kn">import</span> <span class="n">label</span><span class="p">,</span> <span class="n">regionprops</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">cc3d</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">fastremap</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">recon3d.constants</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cs</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">recon3d.types</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">recon3d.utility</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ut</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">recon3d.hdf_io</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hio</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">recon3d.types</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="c1"># # ----------------------------------</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="c1"># # USER INPUT DATA HARD CODES - begin</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="c1"># # ----------------------------------</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="c1"># # NEED TO PUT INTO A .yml file instead of hard codes</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="c1"># # input_dir: str = &quot;/Users/apolon/Desktop/test_recon/input/&quot;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="c1"># # save_dir: str = &quot;/Users/apolon/Desktop/test_recon/output/&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="c1"># input_dir: Final[str] = &quot;/Users/chovey/temp/test_recon/input/&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="c1"># save_dir: Final[str] = &quot;/Users/chovey/temp/test_recon/output/&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="c1"># file_type: Final[str] = &quot;.tif&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="c1"># gray_path: Final[str] = f&quot;{save_dir}/gray/&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="c1"># threshold: Final[int] = 185</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="c1"># segmented_path: Final[str] = f&quot;{save_dir}/segmented/&quot;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="c1"># # first phase is always assumed to be the sample (1 or 255 in segmented images)</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="c1"># phase_paths: np.ndarray = np.array(</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="c1">#     [f&quot;{save_dir}/sample_mask/&quot;, f&quot;{save_dir}/void_mask/&quot;]</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="c1"># )</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="c1"># # first label path is always assumed to the first phase after the sample,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="c1"># # same ordering as phase_paths</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="c1"># label_paths: np.ndarray = np.array([f&quot;{save_dir}/void_ids/&quot;])</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="c1"># # --------------------------------</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="c1"># # USER INPUT DATA HARD CODES - end</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="c1"># # --------------------------------</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_moment</span><span class="p">(</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>    <span class="n">p</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>    <span class="n">q</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="n">centroid_px</span><span class="p">:</span> <span class="n">Centroid</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">    Calculate 3D moment invariants of a feature based on its voxel locations.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">    Mask is given in index locations, so math here is all done in pixel units.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">    Parameters</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">    ----------</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">    indices : np.ndarray[np.int32]</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        Array of [Z,Y,X] indices corresponding to the feature&#39;s voxel</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        locations.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">        The shape of the array should be (n, 3), where n is the number of</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">        voxels of the feature.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">        Example: np.array([[Z1, Y1, X1], [Z2, Y2, X2], ..., [Zn, Yn, Xn]]).</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">    p : int</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        Order of the moment for the X dimension.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">    q : int</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">        Order of the moment for the Y dimension.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">    r : int</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">        Order of the moment for the Z dimension.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">    centroid_px : Centroid</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">        Centroid location for X, Y, and Z axis, respectively, in pixel units.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">    Returns</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">    -------</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">    float</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">        The 3D central moment (translation invariant) in pixel units</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">        normalized by object volume.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">    Raises</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">    ------</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">    ValueError</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">        If the units of the centroid are not in pixel/voxel units.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">    Examples</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">    --------</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">    &gt;&gt;&gt; indices = np.array([[0, 0, 0], [1, 1, 1], [2, 2, 2]], dtype=np.int32)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">    &gt;&gt;&gt; centroid_px = Centroid(</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">    ...     cx=Length(1.0, Units.VOXEL),</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">    ...     cy=Length(1.0, Units.VOXEL),</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">    ...     cz=Length(1.0, Units.VOXEL)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">    ... )</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">    &gt;&gt;&gt; calc_moment(indices, 2, 2, 2, centroid_px)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">    0.66</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">centroid_px</span><span class="o">.</span><span class="n">cx</span><span class="o">.</span><span class="n">unit</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>    <span class="k">if</span> <span class="n">unit</span> <span class="o">!=</span> <span class="n">Units</span><span class="o">.</span><span class="n">VOXEL</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>            <span class="sa">f</span><span class="s2">&quot;Moment invariants are calculated using pixel/voxel units, but </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2"> units were given&quot;</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>        <span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    <span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>        <span class="n">mu</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>            <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid_px</span><span class="o">.</span><span class="n">cx</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>            <span class="o">**</span> <span class="n">p</span>  <span class="c1"># x-location of voxel w.r.t x-centroid</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>            <span class="o">*</span> <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid_px</span><span class="o">.</span><span class="n">cy</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>            <span class="o">**</span> <span class="n">q</span>  <span class="c1"># y-location of voxel w.r.t y-centroid</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="o">*</span> <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid_px</span><span class="o">.</span><span class="n">cz</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>            <span class="o">**</span> <span class="n">r</span>  <span class="c1"># z-location of voxel w.r.t z-centroid</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>        <span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>    <span class="k">return</span> <span class="n">mu</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="k">def</span><span class="w"> </span><span class="nf">center_of_mass</span><span class="p">(</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="n">resolution</span><span class="p">:</span> <span class="n">Resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">Origin</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Centroid</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">    Calculates the center of mass (centroid) of an instance object.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">    Requires that the instance object has uniform density (is homogeneous).</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">    Parameters</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">    ----------</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">    indices : np.ndarray[np.int32]</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        Array of [Z,Y,X] indices corresponding to the feature&#39;s voxel</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">        locations.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        The shape of the array should be (n, 3), where n is the number of</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        voxels of the feature.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        Example: np.array([[Z1, Y1, X1], [Z2, Y2, X2], ..., [Zn, Yn, Xn]]).</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">    resolution : Resolution</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        Resolution of the voxel grid in each dimension (dx, dy, dz).</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">    origin : Origin</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">        Origin of the voxel grid in each dimension (x0, y0, z0).</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">    Returns</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">    -------</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">    Centroid</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">        The centroid location for X, Y, and Z axis, respectively, in microns.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">    Examples</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">    --------</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">    &gt;&gt;&gt; indices = np.array([[0, 0, 0], [1, 1, 1], [2, 2, 2]], dtype=np.int32)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">    &gt;&gt;&gt; resolution = Resolution(dx=Length(1.0, Units.MICRON), dy=Length(1.0, Units.MICRON), dz=Length(1.0, Units.MICRON))</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">    &gt;&gt;&gt; origin = Origin(x0=Length(0.0, Units.MICRON), y0=Length(0.0, Units.MICRON), z0=Length(0.0, Units.MICRON))</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">    &gt;&gt;&gt; center_of_mass(indices, resolution, origin)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">    Centroid(cx=Length(value=1.0, unit=Units.MICRON), cy=Length(value=1.0, unit=Units.MICRON), cz=Length(value=1.0, unit=Units.MICRON))</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="n">centroid_zyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>                <span class="p">[</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                    <span class="n">resolution</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>                    <span class="n">resolution</span><span class="o">.</span><span class="n">dy</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>                    <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>                <span class="p">]</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>            <span class="p">),</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="p">),</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>            <span class="p">[</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>                <span class="n">origin</span><span class="o">.</span><span class="n">z0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>                <span class="n">origin</span><span class="o">.</span><span class="n">y0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>                <span class="n">origin</span><span class="o">.</span><span class="n">x0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>            <span class="p">]</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="p">),</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>    <span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="n">cx</span> <span class="o">=</span> <span class="n">centroid_zyx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>    <span class="n">cy</span> <span class="o">=</span> <span class="n">centroid_zyx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>    <span class="n">cz</span> <span class="o">=</span> <span class="n">centroid_zyx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="k">return</span> <span class="n">Centroid</span><span class="p">(</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>    <span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="k">def</span><span class="w"> </span><span class="nf">centroid_pix</span><span class="p">(</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>    <span class="n">centroid</span><span class="p">:</span> <span class="n">Centroid</span><span class="p">,</span> <span class="n">resolution</span><span class="p">:</span> <span class="n">Resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">Origin</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Centroid</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">    Convert between real space units and pixel units.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">    Parameters</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">    ----------</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">    centroid : Centroid</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        The centroid location in real space units.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">    resolution : Resolution</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        Resolution of the voxel grid in each dimension (dx, dy, dz).</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">    origin : Origin</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        Origin of the voxel grid in each dimension (x0, y0, z0).</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">    Returns</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">    -------</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">    Centroid</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        The centroid location in pixel units.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">    Examples</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">    --------</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">    &gt;&gt;&gt; centroid = Centroid(cx=Length(10.0, Units.MICRON), cy=Length(20.0, Units.MICRON), cz=Length(30.0, Units.MICRON))</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">    &gt;&gt;&gt; resolution = Resolution(dx=Length(1.0, Units.MICRON), dy=Length(1.0, Units.MICRON), dz=Length(1.0, Units.MICRON))</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">    &gt;&gt;&gt; origin = Origin(x0=Length(0.0, Units.MICRON), y0=Length(0.0, Units.MICRON), z0=Length(0.0, Units.MICRON))</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">    &gt;&gt;&gt; centroid_pix(centroid, resolution, origin)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">    Centroid(cx=Length(value=10.0, unit=Units.VOXEL), cy=Length(value=20.0, unit=Units.VOXEL), cz=Length(value=30.0, unit=Units.VOXEL))</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="c1"># convert centroids to normalized pixel units</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>    <span class="n">cx</span> <span class="o">=</span> <span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">cx</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">origin</span><span class="o">.</span><span class="n">x0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>    <span class="n">cy</span> <span class="o">=</span> <span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">cy</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">origin</span><span class="o">.</span><span class="n">y0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dy</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>    <span class="n">cz</span> <span class="o">=</span> <span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">cz</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">origin</span><span class="o">.</span><span class="n">z0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">VOXEL</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>    <span class="k">return</span> <span class="n">Centroid</span><span class="p">(</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>        <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>    <span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="k">def</span><span class="w"> </span><span class="nf">ellipsoid_surface_area</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">:</span> <span class="n">BestFitEllipsoid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Area</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">    Calculate the surface area of the best fit ellipsoid using the Knud Thomsen formula.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">    Applicable to scalene ellipsoids (semi-axes a &gt; b &gt; c), with a relative error of at most 1.061%.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">    Parameters</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">    ----------</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">    ellipsoid : BestFitEllipsoid</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">        The best fit ellipsoid with semi-axes lengths a, b, and c.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">    Returns</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">    -------</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">    Area</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">        The surface area of the ellipsoid in microns squared.</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">    Examples</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">    --------</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">    &gt;&gt;&gt; ellipsoid = BestFitEllipsoid(</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">    ...     a=EllipsoidAxis(length=Length(5.0, Units.MICRON), orientation=UnitVector(u=1, v=0, w=0)),</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">    ...     b=EllipsoidAxis(length=Length(3.0, Units.MICRON), orientation=UnitVector(u=0, v=1, w=0)),</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">    ...     c=EllipsoidAxis(length=Length(2.0, Units.MICRON), orientation=UnitVector(u=0, v=0, w=1))</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">    ... )</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">    &gt;&gt;&gt; ellipsoid_surface_area(ellipsoid)</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">    Area(value=134.8149867941625, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">unit</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Constants</span><span class="p">()</span><span class="o">.</span><span class="n">KNUD_THOMSEN_FACTOR</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>    <span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>    <span class="n">surface_area</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="mi">4</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="o">*</span> <span class="p">((((</span><span class="n">a</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">b</span><span class="o">**</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">c</span><span class="o">**</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">c</span><span class="o">**</span><span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">p</span><span class="p">))</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>    <span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>    <span class="k">return</span> <span class="n">Area</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">surface_area</span><span class="p">,</span> <span class="n">unit_squared</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="k">def</span><span class="w"> </span><span class="nf">ellipsoid_volume</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">:</span> <span class="n">BestFitEllipsoid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Volume</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">    Calculate the volume of the best fit ellipsoid using semi-axes lengths.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">    Parameters</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">    ----------</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">    ellipsoid : BestFitEllipsoid</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">        The best fit ellipsoid with semi-axes lengths a, b, and c.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">    Returns</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">    -------</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">    Volume</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">        The volume of the ellipsoid in microns cubed.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">    Examples</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">    --------</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">    &gt;&gt;&gt; ellipsoid = BestFitEllipsoid(</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">    ...     a=EllipsoidAxis(length=Length(5.0, Units.MICRON), orientation=UnitVector(u=1, v=0, w=0)),</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">    ...     b=EllipsoidAxis(length=Length(3.0, Units.MICRON), orientation=UnitVector(u=0, v=1, w=0)),</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">    ...     c=EllipsoidAxis(length=Length(2.0, Units.MICRON), orientation=UnitVector(u=0, v=0, w=1))</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">    ... )</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">    &gt;&gt;&gt; ellipsoid_volume(ellipsoid)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">    Volume(value=125.66370614359171, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">unit</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>    <span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>    <span class="n">volume</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">volume</span><span class="p">,</span> <span class="n">unit_cubed</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="k">def</span><span class="w"> </span><span class="nf">equivalent_spherical_diameter</span><span class="p">(</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="n">n_voxels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>    <span class="n">resolution</span><span class="p">:</span> <span class="n">Resolution</span><span class="p">,</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Length</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">    Calculate the equivalent spherical diameter of a feature.</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">    Parameters</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">    ----------</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">    n_voxels : int</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">        The number of voxels in the feature.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">    resolution : Resolution</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">        The resolution of the voxel grid in each dimension (dx, dy, dz).</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">    Returns</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">    -------</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">    Length</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">        The equivalent spherical diameter of the feature in the same units as</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">        the resolution.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">    Examples</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">    --------</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">    &gt;&gt;&gt; resolution = Resolution(</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">    ...     dx=Length(1.0, Units.MICRON),</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">    ...     dy=Length(1.0, Units.MICRON),</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">    ...     dz=Length(1.0, Units.MICRON)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">    ... )</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">    &gt;&gt;&gt; equivalent_spherical_diameter(1000, resolution)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">    Length(value=12.407009817988, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>    <span class="n">value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="p">(</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>            <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                <span class="n">n_voxels</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dy</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            <span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="p">),</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>    <span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>    <span class="k">return</span> <span class="n">Length</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fit_ellipsoid</span><span class="p">(</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>    <span class="n">centroid</span><span class="p">:</span> <span class="n">Centroid</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>    <span class="n">resolution</span><span class="p">:</span> <span class="n">Resolution</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="n">origin</span><span class="p">:</span> <span class="n">Origin</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BestFitEllipsoid</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">    Fit a 3D ellipsoid to a set of voxel indices.</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">    Parameters</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">    ----------</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">    indices : np.ndarray</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">        Array of [Z,Y,X] indices corresponding to the feature&#39;s voxel</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">        locations.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        The shape of the array should be (n, 3), where n is the number of</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        voxels of the feature.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">    centroid : Centroid</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">        Centroid location for X, Y, and Z axis, respectively, in spatial</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">        coordinates (e.g., microns).</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">    resolution : Resolution</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">        Voxel resolution for X, Y, and Z dimensions, respectively, in length</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">        units (e.g., microns).</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">    origin : Origin</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">        Optional origin in spatial coordinates if the volume has been</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">        previously transformed.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">    Returns</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">    -------</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">    BestFitEllipsoid</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">        The best fit ellipsoid with semi-axes lengths and orientations.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">    Examples</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">    --------</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">    &gt;&gt;&gt; indices = np.array([[0, 0, 0], [1, 1, 1], [2, 2, 2]], dtype=np.int32)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">    &gt;&gt;&gt; centroid = Centroid(cx=Length(1.0, Units.MICRON), cy=Length(1.0, Units.MICRON), cz=Length(1.0, Units.MICRON))</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">    &gt;&gt;&gt; resolution = Resolution(dx=Length(1.0, Units.MICRON), dy=Length(1.0, Units.MICRON), dz=Length(1.0, Units.MICRON))</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">    &gt;&gt;&gt; origin = Origin(x0=Length(0.0, Units.MICRON), y0=Length(0.0, Units.MICRON), z0=Length(0.0, Units.MICRON))</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">    &gt;&gt;&gt; fit_ellipsoid(indices, centroid, resolution, origin)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">    BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=80.146386085398, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=-0.25175905655605574, v=-0.5305735687527386, w=-0.8093880809494217)), b=EllipsoidAxis(length=Length(value=1.2477168951003976, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=-0.8774683531474325, v=-0.227651095921704, w=0.4221661613042665)), c=EllipsoidAxis(length=Length(value=2.380014006104306e-07, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.4082482904637247, v=-0.816496580927762, w=0.4082482904639296)))</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span> <span class="o">==</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dy</span> <span class="o">==</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dz</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>            <span class="s2">&quot;Only isotropic voxels are currently supported for axis length calculation&quot;</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>    <span class="c1"># convert centroids to normalized pixel units</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>    <span class="n">cen_px</span> <span class="o">=</span> <span class="n">centroid_pix</span><span class="p">(</span><span class="n">centroid</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>    <span class="c1"># Get moments</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>    <span class="n">s_xx</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>    <span class="n">s_yy</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>    <span class="n">s_zz</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>    <span class="n">s_xy</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>    <span class="n">s_xz</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>    <span class="n">s_yz</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>    <span class="c1"># Create matrix of 3D moments</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>    <span class="n">s_ij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>        <span class="p">[</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="p">[</span><span class="n">s_xx</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">],</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>            <span class="p">[</span><span class="n">s_xy</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">],</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>            <span class="p">[</span><span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">],</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        <span class="p">]</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>    <span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>    <span class="n">eig_val</span><span class="p">,</span> <span class="n">eig_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">s_ij</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>    <span class="n">semi_ax_lengths_px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">eig_val</span><span class="p">)</span>  <span class="c1"># still in pixel units</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">semi_ax_lengths_px</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># sort descending axis lengths</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>    <span class="c1"># TODO: math to account for change in length as function</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>    <span class="c1">#       as function of axis orientation in anisotropic voxels</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="c1">#       remove NotImplementedError above</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>    <span class="n">semi_ax_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="p">[</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="n">semi_ax_lengths_px</span><span class="p">[</span><span class="n">sort</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            <span class="n">semi_ax_lengths_px</span><span class="p">[</span><span class="n">sort</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="n">semi_ax_lengths_px</span><span class="p">[</span><span class="n">sort</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>        <span class="p">]</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>    <span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>    <span class="c1"># some axes lengths are NAN, should overwrite to 0.0</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>    <span class="n">semi_ax_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">semi_ax_lengths</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="c1"># from docs on np.linalg.eig: The normalized (unit “length”) eigenvectors,</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>    <span class="c1"># such that the column eigenvectors[:,i] is the eigenvector corresponding to the eigenvalue eigenvalues[i].</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>    <span class="n">ax_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>        <span class="p">[</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>            <span class="n">eig_vec</span><span class="p">[:,</span> <span class="n">sort</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>            <span class="n">eig_vec</span><span class="p">[:,</span> <span class="n">sort</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            <span class="n">eig_vec</span><span class="p">[:,</span> <span class="n">sort</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="p">]</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>    <span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>    <span class="n">ax_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ax_vectors</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">))</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>    <span class="n">a_vector</span> <span class="o">=</span> <span class="n">UnitVector</span><span class="p">(</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="n">u</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="n">v</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="n">w</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>    <span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">EllipsoidAxis</span><span class="p">(</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">semi_ax_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>        <span class="n">orientation</span><span class="o">=</span><span class="n">a_vector</span><span class="p">,</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>    <span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>    <span class="n">b_vector</span> <span class="o">=</span> <span class="n">UnitVector</span><span class="p">(</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="n">u</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="n">v</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="n">w</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>    <span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">EllipsoidAxis</span><span class="p">(</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">semi_ax_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>        <span class="n">orientation</span><span class="o">=</span><span class="n">b_vector</span><span class="p">,</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>    <span class="n">c_vector</span> <span class="o">=</span> <span class="n">UnitVector</span><span class="p">(</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="n">u</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="n">v</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="n">w</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>    <span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">EllipsoidAxis</span><span class="p">(</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">semi_ax_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="n">orientation</span><span class="o">=</span><span class="n">c_vector</span><span class="p">,</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>    <span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>    <span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">BestFitEllipsoid</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>    <span class="k">return</span> <span class="n">ellipsoid</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="k">def</span><span class="w"> </span><span class="nf">instance_indices</span><span class="p">(</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>    <span class="n">instance_stack</span><span class="p">:</span> <span class="n">InstanceImageStack</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InstanceIndices</span><span class="p">:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">    Returns an array of instances and a list of N-dimensional arrays of indices</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">    of the unique values in the instance stack.</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">    Parameters</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">    ----------</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">    instance_stack : InstanceImageStack</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">        Array with arbitrary dimensions.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a><span class="sd">    Returns</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">    -------</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="sd">    InstanceIndices</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="sd">        - 1D-array of sorted unique values.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">        - List of arrays. Each array contains the indices where a given value in x is found.</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">    Examples</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">    --------</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">    &gt;&gt;&gt; instance_stack = InstanceImageStack(</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">    ...     name=&quot;example_stack&quot;,</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">    ...     metadata=MetaData(</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">    ...         data_volume=DataVolume(x_width=2, y_height=2, z_image_count=1),</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">    ...         resolution=Resolution(</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">    ...             dx=Length(1.0, Units.MICRON),</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">    ...             dy=Length(1.0, Units.MICRON),</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">    ...             dz=Length(1.0, Units.MICRON)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">    ...         ),</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">    ...         pixel_units=Units.MICRON,</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">    ...         origin=Origin(</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">    ...             x0=Length(0.0, Units.MICRON),</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">    ...             y0=Length(0.0, Units.MICRON),</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">    ...             z0=Length(0.0, Units.MICRON)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">    ...         )</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">    ...     ),</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">    ...     data=np.array([[1, 2, 2], [3, 1, 1]]),</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">    ...     nlabels=3,</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">    ...     min_feature_size=1</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">    ... )</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">    &gt;&gt;&gt; instance_indices(instance_stack)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">    InstanceIndices(</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">        source_name=&#39;example_stack&#39;,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        indices=[array([[0, 0], [1, 1], [1, 2]]), array([[0, 1], [0, 2]]), array([[1, 0]])],</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">        labels=InstanceLabels(data=np.array([1, 2, 3]))</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">    )</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>    <span class="n">x_flat</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="n">ix_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x_flat</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>    <span class="n">u</span><span class="p">,</span> <span class="n">ix_u</span> <span class="o">=</span> <span class="n">fastremap</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x_flat</span><span class="p">[</span><span class="n">ix_flat</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>    <span class="n">ix_ndim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">ix_flat</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>    <span class="n">ix_ndim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">ix_ndim</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">ix_flat</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ix_ndim</span><span class="p">,</span> <span class="n">ix_u</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>    <span class="n">instance_ids</span> <span class="o">=</span> <span class="n">InstanceIndices</span><span class="p">(</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="n">source_name</span><span class="o">=</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="n">labels</span><span class="o">=</span><span class="n">InstanceLabels</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">labels</span><span class="p">),</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>    <span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>    <span class="k">return</span> <span class="n">instance_ids</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="k">def</span><span class="w"> </span><span class="nf">minimum_size_filter</span><span class="p">(</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>    <span class="n">initial_stack</span><span class="p">:</span> <span class="n">InstanceImageStack</span><span class="p">,</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>    <span class="n">initial_indices</span><span class="p">:</span> <span class="n">InstanceIndices</span><span class="p">,</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">InstanceImageStack</span><span class="p">,</span> <span class="n">InstanceIndices</span><span class="p">]:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">    Removes features below minimum size from InstanceIndices and corresponding</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">    InstanceImageStack. Should be done before shape metrics are determined.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">    Parameters</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">    ----------</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">    initial_stack : InstanceImageStack</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">        The initial instance image stack.</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">    initial_indices : InstanceIndices</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">        The initial instance indices.</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">    Returns</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">    -------</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">    Tuple[InstanceImageStack, InstanceIndices]</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">        The filtered instance image stack and the filtered instance indices.</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">    Raises</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">    ------</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">    ValueError</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        If the names of the initial stack and indices do not match.</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">    Examples</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">    --------</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">    &gt;&gt;&gt; initial_stack = InstanceImageStack(</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">    ...     name=&quot;example_stack&quot;,</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">    ...     metadata=MetaData(</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">    ...         data_volume=DataVolume(x_width=4, y_height=2, z_image_count=1),</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">    ...         resolution=Resolution(</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">    ...             dx=Length(1.0, Units.MICRON),</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">    ...             dy=Length(1.0, Units.MICRON),</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">    ...             dz=Length(1.0, Units.MICRON)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">    ...         ),</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">    ...         pixel_units=Units.MICRON,</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">    ...         origin=Origin(</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">    ...             x0=Length(0.0, Units.MICRON),</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">    ...             y0=Length(0.0, Units.MICRON),</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">    ...             z0=Length(0.0, Units.MICRON)</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">    ...         )</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">    ...     ),</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">    ...     data=np.array([[1, 2, 2, 1], [3, 1, 1, 1]]),</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">    ...     nlabels=3,</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">    ...     min_feature_size=2</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">    ... )</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">    &gt;&gt;&gt; initial_indices = instance_indices(initial_stack)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="sd">    &gt;&gt;&gt; minimum_size_filter(initial_stack, initial_indices)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="sd">    2 connected components remaining after minimum size filter of 2 voxels</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">    (InstanceImageStack(name=&#39;example_stack&#39;, metadata=MetaData(data_volume=DataVolume(x_width=4, y_height=2, z_image_count=1), resolution=Resolution(dx=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dy=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dz=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), pixel_units=&lt;Units.MICRON: &#39;micron&#39;&gt;, origin=Origin(x0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), y0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), z0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))), data=array([[1, 0, 0, 1],[2, 1, 1, 1]], dtype=int8), nlabels=2, min_feature_size=2), InstanceIndices(source_name=&#39;example_stack&#39;, labels=InstanceLabels(data=array([0, 1, 2], dtype=int8)), indices=[array([[0, 1],[0, 2]]), array([[0, 0],[0, 3],[1, 1],[1, 2],[1, 3]]), array([[1, 0]])]))</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">initial_stack</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">initial_indices</span><span class="o">.</span><span class="n">source_name</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Initial InstanceImageStack name (</span><span class="si">{</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">) and</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="s2">            InstanceIndices name (</span><span class="si">{</span><span class="n">initial_indices</span><span class="o">.</span><span class="n">source_name</span><span class="si">}</span><span class="s2">) do not match.</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="s2">            Function inputs must be from same dataset.&quot;&quot;&quot;</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>    <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">num_voxels</span><span class="p">(</span><span class="n">initial_indices</span><span class="p">)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>    <span class="n">n_voxels_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n_voxels</span><span class="p">])</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>    <span class="n">invalid_instance_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">n_voxels_vals</span> <span class="o">&lt;</span> <span class="n">initial_stack</span><span class="o">.</span><span class="n">min_feature_size</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>    <span class="n">masked_instance_ids</span> <span class="o">=</span> <span class="n">fastremap</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">invalid_instance_ids</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>    <span class="n">remapped_instance_ids</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fastremap</span><span class="o">.</span><span class="n">renumber</span><span class="p">(</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="n">masked_instance_ids</span><span class="p">,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="n">preserve_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>    <span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>    <span class="n">nlabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">remapped_instance_ids</span><span class="p">))</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>    <span class="n">filtered_stack</span> <span class="o">=</span> <span class="n">InstanceImageStack</span><span class="p">(</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="n">metadata</span><span class="o">=</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">remapped_instance_ids</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="n">nlabels</span><span class="o">=</span><span class="n">nlabels</span><span class="p">,</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>        <span class="n">min_feature_size</span><span class="o">=</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">min_feature_size</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>    <span class="p">)</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>    <span class="n">filtered_indices</span> <span class="o">=</span> <span class="n">instance_indices</span><span class="p">(</span><span class="n">instance_stack</span><span class="o">=</span><span class="n">filtered_stack</span><span class="p">)</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="si">{</span><span class="n">nlabels</span><span class="si">}</span><span class="s2"> connected components remaining after minimum size filter of </span><span class="si">{</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">min_feature_size</span><span class="si">}</span><span class="s2"> voxels&quot;</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>    <span class="p">)</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>    <span class="k">return</span> <span class="n">filtered_stack</span><span class="p">,</span> <span class="n">filtered_indices</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="c1"># TODO</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="k">def</span><span class="w"> </span><span class="nf">map_features_to_voxels</span><span class="p">():</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;To come.&quot;&quot;&quot;</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="k">def</span><span class="w"> </span><span class="nf">nearest_neighbor_distance</span><span class="p">(</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>    <span class="n">centroids</span><span class="p">:</span> <span class="n">Centroids</span><span class="p">,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NthNearestNeighbors</span><span class="p">:</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd">    Calculate the nearest neighbor distance for a set of centroids.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">    With nth_nearest_neighbor=1 returning the features themselves</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">    (distances=0, neighbor is themselves).</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">    Parameters</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">    ----------</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">    centroids : Centroids</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        The centroids for which to calculate the nearest neighbor distance.</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">    Returns</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">    -------</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">    NthNearestNeighbors</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">        The nth nearest neighbors, distances, and instance IDs.</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">    Examples</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">    --------</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">    &gt;&gt;&gt; centroids = Centroids(data=[</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">    ...     Centroid(cx=Length(0.0, Units.MICRON), cy=Length(0.0, Units.MICRON), cz=Length(0.0, Units.MICRON)),</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">    ...     Centroid(cx=Length(1.0, Units.MICRON), cy=Length(1.0, Units.MICRON), cz=Length(1.0, Units.MICRON)),</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">    ...     Centroid(cx=Length(2.0, Units.MICRON), cy=Length(2.0, Units.MICRON), cz=Length(2.0, Units.MICRON))</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">    ... ])</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">    &gt;&gt;&gt; nearest_neighbor_distance(centroids)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">    NthNearestNeighbors(nth_nearest=2, distances=[Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)], instance_id=array([0, 0, 1]))</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>    <span class="n">neighbor</span> <span class="o">=</span> <span class="n">sklearnNN</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>    <span class="n">centroid_array</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">centroids_to_ndarray</span><span class="p">(</span><span class="n">centroids</span><span class="o">=</span><span class="n">centroids</span><span class="p">)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>    <span class="n">neighbor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">centroid_array</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>    <span class="n">neighbor_dist</span><span class="p">,</span> <span class="n">neighbor_index</span> <span class="o">=</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="n">centroid_array</span><span class="p">,</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="n">return_distance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>    <span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>    <span class="n">distances</span> <span class="o">=</span> <span class="n">neighbor_dist</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>    <span class="n">instance_id</span> <span class="o">=</span> <span class="n">neighbor_index</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>    <span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">instance_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>  <span class="c1"># set feature 0 to 0 distance and neighbor 0</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">centroids</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cx</span><span class="o">.</span><span class="n">unit</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>    <span class="n">distances_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">Length</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">distances</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>    <span class="n">nth_nearest</span> <span class="o">=</span> <span class="n">NthNearestNeighbors</span><span class="p">(</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">nth_nearest</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">distances</span><span class="o">=</span><span class="n">distances_list</span><span class="p">,</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="n">instance_id</span><span class="o">=</span><span class="n">instance_id</span><span class="p">,</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>    <span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>    <span class="k">return</span> <span class="n">nth_nearest</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="k">def</span><span class="w"> </span><span class="nf">num_voxels</span><span class="p">(</span><span class="n">indices</span><span class="p">:</span> <span class="n">InstanceIndices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NVoxel</span><span class="p">]:</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">    Returns the number of voxels for each instance ID from an InstanceImageStack.</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">    Parameters</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">    ----------</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">    indices : InstanceIndices</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">        The instance indices containing the indices of each instance.</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">    Returns</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">    -------</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">    List[NVoxel]</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">        A list of NVoxel objects, each representing the number of voxels for an instance.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">    Examples</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">    --------</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">    &gt;&gt;&gt; indices = InstanceIndices(</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">    ...     source_name=&quot;example_stack&quot;,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">    ...     indices=[np.array([[0, 0], [1, 1]]), np.array([[0, 1], [1, 2]])],</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">    ...     labels=InstanceLabels(data=np.array([1, 2]))</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">    ... )</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">    &gt;&gt;&gt; num_voxels(indices)</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">    [NVoxel(value=2, unit=&lt;Units.VOXEL: &#39;voxel&#39;&gt;), NVoxel(value=2, unit=&lt;Units.VOXEL: &#39;voxel&#39;&gt;)]</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">indices</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">NVoxel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>    <span class="c1"># n_voxels = np.asarray(data, dtype=NVoxel)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>    <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>    <span class="k">return</span> <span class="n">n_voxels</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="k">def</span><span class="w"> </span><span class="nf">process_image_stack</span><span class="p">(</span><span class="n">yml_input_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SemanticImageStack</span><span class="p">:</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">    Given a yml input file, converts it to a SemanticImageStack.</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">    Parameters</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">    ----------</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">    yml_input_file : Path</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        The fully pathed yml file that specifies settings.</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">    Returns</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">    -------</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">    SemanticImageStack</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">        The SemanticImageStack object.</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">    Examples</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">    --------</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">    &gt;&gt;&gt; yml_input_file = Path(&quot;path/to/input.yml&quot;)</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">    &gt;&gt;&gt; semantic_image_stack = process_image_stack(yml_input_file)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing specification file: </span><span class="si">{</span><span class="n">yml_input_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>    <span class="n">db</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">yml_input_file</span><span class="p">)</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>    <span class="n">file_type</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;semantic_images_type&quot;</span><span class="p">]</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>    <span class="n">valid_extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.tiff&quot;</span><span class="p">)</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>    <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_extensions</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: &#39;image_type&#39; must be &#39;.tif&#39; or &#39;.tiff&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>    <span class="n">path_input</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;semantic_images_dir&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_input</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error, &#39;image_dir&#39; of </span><span class="si">{</span><span class="n">path_input</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input path: </span><span class="si">{</span><span class="n">path_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>    <span class="n">path_output</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;out_dir&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_output</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">path_output</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="p">)</span>  <span class="c1"># makes directory if it doesn&#39;t exist</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output path: </span><span class="si">{</span><span class="n">path_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>    <span class="c1"># semantic_seg_dict = db[&quot;class_labels&quot;]</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>    <span class="c1"># # load images</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>    <span class="c1"># imageStack = skio.imread_collection(tiff_files, conserve_memory=True)</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">read_images</span><span class="p">(</span><span class="n">path_input</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>    <span class="n">semantic_seg_stack_name</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;semantic_imagestack_name&quot;</span><span class="p">]</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>    <span class="c1"># create meta data</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>    <span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>    <span class="n">data_volume</span> <span class="o">=</span> <span class="n">DataVolume</span><span class="p">(</span><span class="n">z_image_count</span><span class="o">=</span><span class="n">nz</span><span class="p">,</span> <span class="n">y_height</span><span class="o">=</span><span class="n">ny</span><span class="p">,</span> <span class="n">x_width</span><span class="o">=</span><span class="n">nx</span><span class="p">)</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="sa">f</span><span class="s2">&quot;image stack, </span><span class="si">{</span><span class="n">semantic_seg_stack_name</span><span class="si">}</span><span class="s2">, has dimensions (num_images, row, col): </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>    <span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>    <span class="n">pixel_units</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;pixel_units&quot;</span><span class="p">]</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>    <span class="n">valid_units</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Units</span><span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>    <span class="k">if</span> <span class="n">pixel_units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_units</span><span class="p">:</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>            <span class="sa">f</span><span class="s2">&quot;Error, &#39;</span><span class="si">{</span><span class="n">pixel_units</span><span class="si">}</span><span class="s2">&#39; is not a valid unit, accepted units are: </span><span class="si">{</span><span class="n">valid_units</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>    <span class="n">pixel_units</span> <span class="o">=</span> <span class="n">Units</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;pixel_units&quot;</span><span class="p">])</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;voxel_size&quot;</span><span class="p">][</span><span class="s2">&quot;dx&quot;</span><span class="p">],</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;voxel_size&quot;</span><span class="p">][</span><span class="s2">&quot;dy&quot;</span><span class="p">],</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;voxel_size&quot;</span><span class="p">][</span><span class="s2">&quot;dz&quot;</span><span class="p">],</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>    <span class="p">)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="n">Resolution</span><span class="p">(</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>    <span class="p">)</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">][</span><span class="s2">&quot;x0&quot;</span><span class="p">],</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">][</span><span class="s2">&quot;y0&quot;</span><span class="p">],</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">][</span><span class="s2">&quot;z0&quot;</span><span class="p">],</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>    <span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>    <span class="n">origin</span> <span class="o">=</span> <span class="n">Origin</span><span class="p">(</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>        <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>    <span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>    <span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>        <span class="n">data_volume</span><span class="o">=</span><span class="n">data_volume</span><span class="p">,</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>        <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="n">pixel_units</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">,</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>    <span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>    <span class="c1"># # Optional, grey image stack</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>    <span class="c1"># # TODO: test functionality</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>    <span class="c1"># if db[&quot;grey_image_dir&quot;]:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="c1">#     path_grey_image_dir = Path(db[&quot;path_grey_image_dir&quot;]).expanduser()</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>    <span class="c1">#     assert path_grey_image_dir.is_dir(), &quot;Error, &#39;image_dir&#39; not found.&quot;</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>    <span class="c1">#     grey_image_name = &quot;Raw greyscale&quot;</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="c1">#     grey_data = ut.read_images(path_grey_image_dir, file_type)</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>    <span class="c1">#     assert data.shape == grey_data.shape</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="c1">#     semantic_seg_image_stack = ImageStack(</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="c1">#         name=grey_image_name, metadata=meta, data=grey_data</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>    <span class="c1">#     )</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="c1"># create SemanticImageStack</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>    <span class="n">semantic_seg_image_stack</span> <span class="o">=</span> <span class="n">SemanticImageStack</span><span class="p">(</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">semantic_seg_stack_name</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>    <span class="p">)</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>    <span class="k">return</span> <span class="n">semantic_seg_image_stack</span>  <span class="c1"># , path_file_output)</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="k">def</span><span class="w"> </span><span class="nf">save_instance_images</span><span class="p">(</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>    <span class="n">input_volumes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">InstanceImageStack</span><span class="p">],</span> <span class="n">save_path</span><span class="p">:</span> <span class="n">Path</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">    Save InstanceImageStack objects to image files.</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">    This function takes a list of InstanceImageStack objects and saves each one as a series of image files.</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">    The images are saved in the specified directory, with each stack saved in its own subdirectory.</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">    Parameters</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">    ----------</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">    input_volumes : list of InstanceImageStack</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">        List of InstanceImageStack objects to be saved as images.</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">    save_path : Path</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        The directory where the images will be saved.</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">    Returns</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">    -------</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">    bool</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">        True if the images were saved successfully, False otherwise.</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">    Examples</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">    --------</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">    &gt;&gt;&gt; input_volumes = [</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">    ...     InstanceImageStack(</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">    ...         name=&quot;example_stack_1&quot;,</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">    ...         metadata=MetaData(</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">    ...             data_volume=DataVolume(x_width=256, y_height=256, z_image_count=10),</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">    ...             resolution=Resolution(</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">    ...                 dx=Length(1.0, Units.MICRON),</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">    ...                 dy=Length(1.0, Units.MICRON),</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">    ...                 dz=Length(1.0, Units.MICRON)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">    ...             ),</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">    ...             pixel_units=Units.MICRON,</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">    ...             origin=Origin(</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">    ...                 x0=Length(0.0, Units.MICRON),</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">    ...                 y0=Length(0.0, Units.MICRON),</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">    ...                 z0=Length(0.0, Units.MICRON)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">    ...             )</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">    ...         ),</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">    ...         data=np.random.rand(10, 256, 256),</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">    ...         nlabels=3,</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">    ...         min_feature_size=2</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">    ...     ),</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">    ...     InstanceImageStack(</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">    ...         name=&quot;example_stack_2&quot;,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">    ...         metadata=MetaData(</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">    ...             data_volume=DataVolume(x_width=256, y_height=256, z_image_count=10),</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">    ...             resolution=Resolution(</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">    ...                 dx=Length(1.0, Units.MICRON),</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a><span class="sd">    ...                 dy=Length(1.0, Units.MICRON),</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">    ...                 dz=Length(1.0, Units.MICRON)</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">    ...             ),</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">    ...             pixel_units=Units.MICRON,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">    ...             origin=Origin(</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">    ...                 x0=Length(0.0, Units.MICRON),</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">    ...                 y0=Length(0.0, Units.MICRON),</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">    ...                 z0=Length(0.0, Units.MICRON)</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">    ...             )</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">    ...         ),</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">    ...         data=np.random.rand(10, 256, 256),</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">    ...         nlabels=3,</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">    ...         min_feature_size=2</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">    ...     )</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">    ... ]</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">    &gt;&gt;&gt; save_path = Path(&quot;path/to/save&quot;)</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">    &gt;&gt;&gt; save_instance_images(input_volumes, save_path)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">    True</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>    <span class="k">for</span> <span class="n">instance_volumes</span> <span class="ow">in</span> <span class="n">input_volumes</span><span class="p">:</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="n">ut</span><span class="o">.</span><span class="n">ndarray_to_img</span><span class="p">(</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">instance_volumes</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>            <span class="n">slice_axis</span><span class="o">=</span><span class="n">recon3d</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">CartesianAxis3D</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>            <span class="n">parent_dir</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="n">folder_name</span><span class="o">=</span><span class="n">instance_volumes</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>            <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="n">pad_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="p">)</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="k">def</span><span class="w"> </span><span class="nf">semantic_to_instance</span><span class="p">(</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>    <span class="n">semantic_stack</span><span class="p">:</span> <span class="n">SemanticImageStack</span><span class="p">,</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>    <span class="n">instance_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>    <span class="n">instance_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>    <span class="n">min_feature_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InstanceImageStack</span><span class="p">:</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">    Isolate each unique class in the semantic segmentation (e.g., Cats or Dogs)</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">    and create the Instance Image Stacks.</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">    Parameters</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">    ----------</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">    semantic_stack : SemanticImageStack</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">        The semantic image stack containing the segmented data.</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">    instance_name : str</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">        The name for the instance image stack.</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">    instance_value : int</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">        The value in the semantic stack representing the class to isolate.</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">    min_feature_size : int</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">        The minimum feature size to retain in the instance image stack.</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">    Returns</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">    -------</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">    InstanceImageStack</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        The instance image stack with isolated features.</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">    Examples</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">    --------</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">    &gt;&gt;&gt; semantic_stack = SemanticImageStack(</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">    ...     name=&quot;example_semantic_stack&quot;,</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">    ...     metadata=MetaData(</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">    ...         data_volume=DataVolume(z_image_count=10, y_height=256, x_width=256),</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">    ...         resolution=Resolution(</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">    ...             dx=Length(1.0, Units.MICRON),</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">    ...             dy=Length(1.0, Units.MICRON),</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">    ...             dz=Length(1.0, Units.MICRON)</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">    ...         ),</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">    ...         pixel_units=Units.MICRON,</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">    ...         origin=Origin(</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">    ...             x0=Length(0.0, Units.MICRON),</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">    ...             y0=Length(0.0, Units.MICRON),</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">    ...             z0=Length(0.0, Units.MICRON)</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">    ...         )</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">    ...     ),</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">    ...     data=np.random.randint(0, 2, (10, 256, 256))</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">    ... )</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">    &gt;&gt;&gt; instance_stack = semantic_to_instance(</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">    ...     semantic_stack,</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">    ...     instance_name=&quot;example_instance_stack&quot;,</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">    ...     instance_value=1,</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">    ...     min_feature_size=10</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">    ... )</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">    &gt;&gt;&gt; print(instance_stack)</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">    InstanceImageStack(name=&#39;example_instance_stack&#39;, metadata=MetaData(data_volume=DataVolume(z_image_count=10, y_height=256, x_width=256), resolution=Resolution(dx=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dy=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dz=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), pixel_units=&lt;Units.MICRON: &#39;micron&#39;&gt;, origin=Origin(x0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), y0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), z0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))), data=array(...), nlabels=..., min_feature_size=10)</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>    <span class="c1"># Create a boolean mask of the array</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>    <span class="n">masked_stack</span> <span class="o">=</span> <span class="n">semantic_stack</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">instance_value</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">labelling connected components in &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="c1"># Use cc3d for connected components labeling</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>    <span class="n">cc3d_instance_stack</span><span class="p">,</span> <span class="n">cc3d_nlabels</span> <span class="o">=</span> <span class="n">cc3d</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="n">masked_stack</span><span class="p">,</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="n">connectivity</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">CC3DConnectivity</span><span class="o">.</span><span class="n">FACE_NEIGHBORS</span><span class="p">,</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>        <span class="n">return_N</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>    <span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">with cc3d package, found </span><span class="si">{</span><span class="n">cc3d_nlabels</span><span class="si">}</span><span class="s2"> connected components in &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>    <span class="p">)</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>    <span class="k">return</span> <span class="n">InstanceImageStack</span><span class="p">(</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">instance_name</span><span class="p">,</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">cc3d_instance_stack</span><span class="p">,</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="n">metadata</span><span class="o">=</span><span class="n">semantic_stack</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="n">nlabels</span><span class="o">=</span><span class="n">cc3d_nlabels</span><span class="p">,</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="n">min_feature_size</span><span class="o">=</span><span class="n">min_feature_size</span><span class="p">,</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>    <span class="p">)</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="c1">##### MAIN FUNCTIONS</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="c1"># TODO remove hardcoding here with yml config type</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="k">def</span><span class="w"> </span><span class="nf">instance_analysis_included</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">    Checks YAML settings to determine if instance analysis should be performed.</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">    This function checks the provided settings dictionary to see if instance analysis</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">    is included for the specified key.</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">    Parameters</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">    ----------</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">    settings : dict</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">        The settings dictionary, typically loaded from a YAML file.</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">    key : str</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">        The key representing the class label to check for instance analysis inclusion.</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">    Returns</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">    -------</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">    bool</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        True if instance analysis is included for the specified key, False otherwise.</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">    Examples</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">    --------</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">    &gt;&gt;&gt; settings = {</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">    ...     &quot;class_labels&quot;: {</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">    ...         &quot;cat&quot;: {</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">    ...             &quot;instance_analysis&quot;: {</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">    ...                 &quot;include&quot;: True</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">    ...             }</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">    ...         },</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">    ...         &quot;dog&quot;: {</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">    ...             &quot;instance_analysis&quot;: {</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="sd">    ...                 &quot;include&quot;: False</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">    ...             }</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">    ...         }</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">    ...     }</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">    ... }</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">    &gt;&gt;&gt; instance_analysis_included(settings, &quot;cat&quot;)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">    True</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="sd">    &gt;&gt;&gt; instance_analysis_included(settings, &quot;dog&quot;)</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">    False</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="sd">    &gt;&gt;&gt; instance_analysis_included(settings, &quot;bird&quot;)</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="sd">    False</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;class_labels&quot;</span><span class="p">]</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="k">return</span> <span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;instance_analysis&quot;</span><span class="p">][</span><span class="s2">&quot;include&quot;</span><span class="p">]</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="k">def</span><span class="w"> </span><span class="nf">instance_properties</span><span class="p">(</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>    <span class="n">instance_stack</span><span class="p">:</span> <span class="n">InstanceImageStack</span><span class="p">,</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>    <span class="n">inst_indices</span><span class="p">:</span> <span class="n">InstanceIndices</span><span class="p">,</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InstanceProperties</span><span class="p">:</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">    Calculate various properties for each instance in an InstanceImageStack.</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">    Parameters</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">    ----------</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">    instance_stack : InstanceImageStack</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">        The instance image stack containing the segmented data.</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">    inst_indices : InstanceIndices</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">        The instance indices containing the indices of each instance.</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">    Returns</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">    -------</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">    InstanceProperties</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">        The properties of each instance, including number of voxels, equivalent spherical diameters,</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">        centroids, ellipsoids, surface areas, and volumes.</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">    Examples</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">    --------</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">    &gt;&gt;&gt; instance_stack = InstanceImageStack(</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">    ...     name=&quot;example_instance_stack&quot;,</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">    ...     metadata=MetaData(</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">    ...         data_volume=DataVolume(z_image_count=10, y_height=256, x_width=256),</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">    ...         resolution=Resolution(</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">    ...             dx=Length(1.0, Units.MICRON),</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">    ...             dy=Length(1.0, Units.MICRON),</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">    ...             dz=Length(1.0, Units.MICRON)</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">    ...         ),</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">    ...         pixel_units=Units.MICRON,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="sd">    ...         origin=Origin(</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">    ...             x0=Length(0.0, Units.MICRON),</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="sd">    ...             y0=Length(0.0, Units.MICRON),</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">    ...             z0=Length(0.0, Units.MICRON)</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">    ...         )</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="sd">    ...     ),</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">    ...     data=np.random.randint(0, 2, (10, 256, 256)),</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">    ...     nlabels=3,</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">    ...     min_feature_size=2</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">    ... )</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">    &gt;&gt;&gt; inst_indices = InstanceIndices(</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">    ...     source_name=&quot;example_instance_stack&quot;,</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">    ...     indices=[np.array([[0, 0], [1, 1]]), np.array([[0, 1], [1, 2]])],</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">    ...     labels=InstanceLabels(data=np.array([1, 2]))</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">    ... )</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">    &gt;&gt;&gt; properties = instance_properties(instance_stack, inst_indices)</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">    &gt;&gt;&gt; print(properties)</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">    InstanceProperties(source_name=&#39;example_instance_stack&#39;, labels=InstanceLabels(data=array([1, 2])), n_voxels=[NVoxel(value=0), NVoxel(value=2), NVoxel(value=2)], equivalent_sphere_diameters=[Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)], centroids=Centroids(data=[Centroid(cx=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), Centroid(cx=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), Centroid(cx=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))]), ellipsoids=BestFitEllipsoids(data=[BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0))]), BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=1.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=1.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=1.0))]), BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=1.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=1.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=1.0))])]), surface_areas=EllipsoidSurfaceAreas(data=[Area(value=0.0, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;), Area(value=19.739208802178716, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;), Area(value=19.739208802178716, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;)]), volumes=EllipsoidVolumes(data=[Volume(value=0.0, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;), Volume(value=4.1887902047863905, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;), Volume(value=4.1887902047863905, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;)]))</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>    <span class="n">num_labels</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">nlabels</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>    <span class="c1"># feature 0 is the background, and we want to include the last label</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>    <span class="n">stack_n_voxels</span> <span class="o">=</span> <span class="n">num_voxels</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">inst_indices</span><span class="p">)</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="n">stack_eq_diameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>    <span class="n">stack_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>    <span class="n">stack_ellipsoids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>    <span class="n">stack_surface_areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="n">stack_volumes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>    <span class="n">origin</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">origin</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>    <span class="c1"># null types</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>    <span class="n">null_length</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>    <span class="n">null_area</span> <span class="o">=</span> <span class="n">Area</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">unit_squared</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>    <span class="n">null_volume</span> <span class="o">=</span> <span class="n">Volume</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">unit_cubed</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>    <span class="n">null_axis</span> <span class="o">=</span> <span class="n">EllipsoidAxis</span><span class="p">(</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>        <span class="n">length</span><span class="o">=</span><span class="n">null_length</span><span class="p">,</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>        <span class="n">orientation</span><span class="o">=</span><span class="n">UnitVector</span><span class="p">(</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>            <span class="n">u</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>            <span class="n">v</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>            <span class="n">w</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="p">),</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>    <span class="p">)</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>    <span class="c1"># set first entry to correct type of zero for feature 0</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>    <span class="n">stack_n_voxels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">NVoxel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>    <span class="n">stack_eq_diameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">null_length</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>    <span class="n">stack_centroids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Centroid</span><span class="p">(</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>        <span class="n">cx</span><span class="o">=</span><span class="n">null_length</span><span class="p">,</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>        <span class="n">cy</span><span class="o">=</span><span class="n">null_length</span><span class="p">,</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>        <span class="n">cz</span><span class="o">=</span><span class="n">null_length</span><span class="p">,</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>    <span class="p">)</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>    <span class="n">stack_ellipsoids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">BestFitEllipsoid</span><span class="p">(</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="n">a</span><span class="o">=</span><span class="n">null_axis</span><span class="p">,</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>        <span class="n">b</span><span class="o">=</span><span class="n">null_axis</span><span class="p">,</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="n">c</span><span class="o">=</span><span class="n">null_axis</span><span class="p">,</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>    <span class="p">)</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>    <span class="n">stack_surface_areas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">null_area</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>    <span class="n">stack_volumes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">null_volume</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="k">if</span> <span class="p">((</span><span class="n">instance</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Analyzing feature </span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">num_labels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="n">inst_indices</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>        <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">stack_n_voxels</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>        <span class="c1"># Equivalent spherical diameter</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="n">stack_eq_diameters</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">equivalent_spherical_diameter</span><span class="p">(</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>            <span class="n">n_voxels</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="p">)</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>        <span class="c1"># Centroid (real-space coordinates)</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="n">centroid</span> <span class="o">=</span> <span class="n">center_of_mass</span><span class="p">(</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>        <span class="p">)</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="n">stack_centroids</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>        <span class="c1"># Ellipsoid properties</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>        <span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">fit_ellipsoid</span><span class="p">(</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>            <span class="n">centroid</span><span class="o">=</span><span class="n">centroid</span><span class="p">,</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>        <span class="p">)</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>        <span class="n">stack_ellipsoids</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">ellipsoid</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>        <span class="n">surface_area</span> <span class="o">=</span> <span class="n">ellipsoid_surface_area</span><span class="p">(</span><span class="n">ellipsoid</span><span class="o">=</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>        <span class="n">stack_surface_areas</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_area</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>        <span class="n">volume</span> <span class="o">=</span> <span class="n">ellipsoid_volume</span><span class="p">(</span><span class="n">ellipsoid</span><span class="o">=</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>        <span class="n">stack_volumes</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>    <span class="n">properties</span> <span class="o">=</span> <span class="n">InstanceProperties</span><span class="p">(</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="n">source_name</span><span class="o">=</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="n">labels</span><span class="o">=</span><span class="n">inst_indices</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>        <span class="n">n_voxels</span><span class="o">=</span><span class="n">stack_n_voxels</span><span class="p">,</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>        <span class="n">equivalent_sphere_diameters</span><span class="o">=</span><span class="n">stack_eq_diameters</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>        <span class="n">centroids</span><span class="o">=</span><span class="n">Centroids</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stack_centroids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>        <span class="n">ellipsoids</span><span class="o">=</span><span class="n">BestFitEllipsoids</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stack_ellipsoids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>        <span class="n">surface_areas</span><span class="o">=</span><span class="n">EllipsoidSurfaceAreas</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stack_surface_areas</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="n">volumes</span><span class="o">=</span><span class="n">EllipsoidVolumes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stack_volumes</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>    <span class="p">)</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>    <span class="k">return</span> <span class="n">properties</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">yml_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">    Processes a directory of images specified in a YAML file, creates a semantic image stack,</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">    and performs instance analysis on all semantic label classes within the stack.</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a><span class="sd">    Saves all instance stacks and properties into an HDF5 file containing the original semantic image stack.</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">    Parameters</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">    ----------</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">    yml_file : Path</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="sd">        The fully pathed YAML file that specifies settings.</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a><span class="sd">    Returns</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">    -------</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">    bool</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="sd">        True if the process was successful, False otherwise.</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">    Examples</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">    --------</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">    &gt;&gt;&gt; yml_file = Path(&quot;path/to/input.yml&quot;)</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">    &gt;&gt;&gt; process(yml_file)</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">    True</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>    <span class="n">semantic_stack</span> <span class="o">=</span> <span class="n">process_image_stack</span><span class="p">(</span><span class="n">yml_file</span><span class="p">)</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>    <span class="n">n_semantic_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">semantic_stack</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>    <span class="c1"># create h5</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>    <span class="n">h5_path</span> <span class="o">=</span> <span class="n">hio</span><span class="o">.</span><span class="n">image_to_hdf</span><span class="p">(</span><span class="n">yml_file</span><span class="p">)</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>    <span class="c1"># start instance analysis</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>    <span class="n">db</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">yml_file</span><span class="p">)</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>    <span class="k">for</span> <span class="n">instance_name</span> <span class="ow">in</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;class_labels&quot;</span><span class="p">]:</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="c1"># # check yml values match the labels in the semantic image stack</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="c1"># for semantic_label in n_semantic_labels:</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance_analysis_included</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">instance_name</span><span class="p">):</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>            <span class="k">continue</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analyzing &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; semantic label&quot;</span><span class="p">)</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>        <span class="c1"># create the instance_stacks</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>        <span class="n">inst_stack</span> <span class="o">=</span> <span class="n">semantic_to_instance</span><span class="p">(</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>            <span class="n">semantic_stack</span><span class="o">=</span><span class="n">semantic_stack</span><span class="p">,</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>            <span class="n">instance_name</span><span class="o">=</span><span class="n">instance_name</span><span class="p">,</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            <span class="n">instance_value</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;class_labels&quot;</span><span class="p">][</span><span class="n">instance_name</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>            <span class="n">min_feature_size</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;class_labels&quot;</span><span class="p">][</span><span class="n">instance_name</span><span class="p">][</span><span class="s2">&quot;instance_analysis&quot;</span><span class="p">][</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>                <span class="s2">&quot;min_feature_size&quot;</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>            <span class="p">],</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>        <span class="p">)</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>        <span class="c1"># get instance_indices</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="n">inst_indices</span> <span class="o">=</span> <span class="n">instance_indices</span><span class="p">(</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>            <span class="n">instance_stack</span><span class="o">=</span><span class="n">inst_stack</span><span class="p">,</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="p">)</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="k">if</span> <span class="n">inst_stack</span><span class="o">.</span><span class="n">min_feature_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>            <span class="c1"># overwrites instance_stack and inst_indices</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>            <span class="n">inst_stack</span><span class="p">,</span> <span class="n">inst_indices</span> <span class="o">=</span> <span class="n">minimum_size_filter</span><span class="p">(</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>                <span class="n">initial_stack</span><span class="o">=</span><span class="n">inst_stack</span><span class="p">,</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                <span class="n">initial_indices</span><span class="o">=</span><span class="n">inst_indices</span><span class="p">,</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>            <span class="p">)</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="c1"># add to h5</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>        <span class="n">hio</span><span class="o">.</span><span class="n">add_to_h5</span><span class="p">(</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>            <span class="n">inst_stack</span><span class="p">,</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>            <span class="n">h5_path</span><span class="o">=</span><span class="n">h5_path</span><span class="p">,</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>            <span class="n">h5_group</span><span class="o">=</span><span class="s2">&quot;VoxelData&quot;</span><span class="p">,</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>        <span class="p">)</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">labelled &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; voxel data added&quot;</span><span class="p">)</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>        <span class="c1"># TODO not implemented instance indices yet</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>        <span class="c1"># hio.add_to_h5(</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>        <span class="c1">#     inst_indices,</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>        <span class="c1">#     h5_path=h5_path,</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>        <span class="c1">#     h5_group=f&quot;{instance_name}&quot;,</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="c1"># )</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">calculating &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; instance properties...&quot;</span><span class="p">)</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>        <span class="c1"># calculate indepedendent feature properties</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="n">inst_properties</span> <span class="o">=</span> <span class="n">instance_properties</span><span class="p">(</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>            <span class="n">instance_stack</span><span class="o">=</span><span class="n">inst_stack</span><span class="p">,</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>            <span class="n">inst_indices</span><span class="o">=</span><span class="n">inst_indices</span><span class="p">,</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="p">)</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="c1"># add to h5</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>        <span class="n">hio</span><span class="o">.</span><span class="n">add_to_h5</span><span class="p">(</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>            <span class="n">inst_properties</span><span class="p">,</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>            <span class="n">h5_path</span><span class="o">=</span><span class="n">h5_path</span><span class="p">,</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="n">h5_group</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>        <span class="p">)</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; instance property data added&quot;</span><span class="p">)</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>        <span class="n">nearest_neighbors</span> <span class="o">=</span> <span class="n">nearest_neighbor_distance</span><span class="p">(</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="n">centroids</span><span class="o">=</span><span class="n">inst_properties</span><span class="o">.</span><span class="n">centroids</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="p">)</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="n">hio</span><span class="o">.</span><span class="n">add_to_h5</span><span class="p">(</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>            <span class="n">nearest_neighbors</span><span class="p">,</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>            <span class="n">h5_path</span><span class="o">=</span><span class="n">h5_path</span><span class="p">,</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>            <span class="n">h5_group</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="p">)</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; neighborhood property data added&quot;</span><span class="p">)</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="sd">    Command-line interface for running instance analysis on image stacks.</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="sd">    This function serves as the entry point for terminal-based access to the instance analysis module.</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a><span class="sd">    It is invoked from the command line using the &#39;instance_analysis&#39; command specified in pyproject.toml.</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a><span class="sd">    The function processes a YAML input file to create a semantic image stack and performs instance analysis</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a><span class="sd">    on all semantic label classes within the stack. The results, including instance stacks and properties,</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="sd">    are saved into an HDF5 file.</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="sd">    Parameters</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">    ----------</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">    None</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="sd">    Returns</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="sd">    -------</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a><span class="sd">    None</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="sd">    Examples</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a><span class="sd">    --------</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="sd">    To run the instance analysis, use the following command in the terminal:</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="sd">    $ instance_analysis path/to/input.yml</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the .yml user input file&quot;</span><span class="p">)</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>    <span class="n">input_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_file</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>    <span class="n">process</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2"> processed!&quot;</span><span class="p">)</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>    <span class="n">main</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="calc_moment">
                            <input id="calc_moment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calc_moment</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">indices</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">]</span>,</span><span class="param">	<span class="n">p</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">q</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">r</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">centroid_px</span><span class="p">:</span> <span class="n"><a href="types.html#Centroid">recon3d.types.Centroid</a></span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="calc_moment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#calc_moment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="calc_moment-72"><a href="#calc_moment-72"><span class="linenos"> 72</span></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_moment</span><span class="p">(</span>
</span><span id="calc_moment-73"><a href="#calc_moment-73"><span class="linenos"> 73</span></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="calc_moment-74"><a href="#calc_moment-74"><span class="linenos"> 74</span></a>    <span class="n">p</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="calc_moment-75"><a href="#calc_moment-75"><span class="linenos"> 75</span></a>    <span class="n">q</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="calc_moment-76"><a href="#calc_moment-76"><span class="linenos"> 76</span></a>    <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="calc_moment-77"><a href="#calc_moment-77"><span class="linenos"> 77</span></a>    <span class="n">centroid_px</span><span class="p">:</span> <span class="n">Centroid</span><span class="p">,</span>
</span><span id="calc_moment-78"><a href="#calc_moment-78"><span class="linenos"> 78</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="calc_moment-79"><a href="#calc_moment-79"><span class="linenos"> 79</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="calc_moment-80"><a href="#calc_moment-80"><span class="linenos"> 80</span></a><span class="sd">    Calculate 3D moment invariants of a feature based on its voxel locations.</span>
</span><span id="calc_moment-81"><a href="#calc_moment-81"><span class="linenos"> 81</span></a><span class="sd">    Mask is given in index locations, so math here is all done in pixel units.</span>
</span><span id="calc_moment-82"><a href="#calc_moment-82"><span class="linenos"> 82</span></a>
</span><span id="calc_moment-83"><a href="#calc_moment-83"><span class="linenos"> 83</span></a><span class="sd">    Parameters</span>
</span><span id="calc_moment-84"><a href="#calc_moment-84"><span class="linenos"> 84</span></a><span class="sd">    ----------</span>
</span><span id="calc_moment-85"><a href="#calc_moment-85"><span class="linenos"> 85</span></a><span class="sd">    indices : np.ndarray[np.int32]</span>
</span><span id="calc_moment-86"><a href="#calc_moment-86"><span class="linenos"> 86</span></a><span class="sd">        Array of [Z,Y,X] indices corresponding to the feature&#39;s voxel</span>
</span><span id="calc_moment-87"><a href="#calc_moment-87"><span class="linenos"> 87</span></a><span class="sd">        locations.</span>
</span><span id="calc_moment-88"><a href="#calc_moment-88"><span class="linenos"> 88</span></a><span class="sd">        The shape of the array should be (n, 3), where n is the number of</span>
</span><span id="calc_moment-89"><a href="#calc_moment-89"><span class="linenos"> 89</span></a><span class="sd">        voxels of the feature.</span>
</span><span id="calc_moment-90"><a href="#calc_moment-90"><span class="linenos"> 90</span></a><span class="sd">        Example: np.array([[Z1, Y1, X1], [Z2, Y2, X2], ..., [Zn, Yn, Xn]]).</span>
</span><span id="calc_moment-91"><a href="#calc_moment-91"><span class="linenos"> 91</span></a><span class="sd">    p : int</span>
</span><span id="calc_moment-92"><a href="#calc_moment-92"><span class="linenos"> 92</span></a><span class="sd">        Order of the moment for the X dimension.</span>
</span><span id="calc_moment-93"><a href="#calc_moment-93"><span class="linenos"> 93</span></a><span class="sd">    q : int</span>
</span><span id="calc_moment-94"><a href="#calc_moment-94"><span class="linenos"> 94</span></a><span class="sd">        Order of the moment for the Y dimension.</span>
</span><span id="calc_moment-95"><a href="#calc_moment-95"><span class="linenos"> 95</span></a><span class="sd">    r : int</span>
</span><span id="calc_moment-96"><a href="#calc_moment-96"><span class="linenos"> 96</span></a><span class="sd">        Order of the moment for the Z dimension.</span>
</span><span id="calc_moment-97"><a href="#calc_moment-97"><span class="linenos"> 97</span></a><span class="sd">    centroid_px : Centroid</span>
</span><span id="calc_moment-98"><a href="#calc_moment-98"><span class="linenos"> 98</span></a><span class="sd">        Centroid location for X, Y, and Z axis, respectively, in pixel units.</span>
</span><span id="calc_moment-99"><a href="#calc_moment-99"><span class="linenos"> 99</span></a>
</span><span id="calc_moment-100"><a href="#calc_moment-100"><span class="linenos">100</span></a><span class="sd">    Returns</span>
</span><span id="calc_moment-101"><a href="#calc_moment-101"><span class="linenos">101</span></a><span class="sd">    -------</span>
</span><span id="calc_moment-102"><a href="#calc_moment-102"><span class="linenos">102</span></a><span class="sd">    float</span>
</span><span id="calc_moment-103"><a href="#calc_moment-103"><span class="linenos">103</span></a><span class="sd">        The 3D central moment (translation invariant) in pixel units</span>
</span><span id="calc_moment-104"><a href="#calc_moment-104"><span class="linenos">104</span></a><span class="sd">        normalized by object volume.</span>
</span><span id="calc_moment-105"><a href="#calc_moment-105"><span class="linenos">105</span></a>
</span><span id="calc_moment-106"><a href="#calc_moment-106"><span class="linenos">106</span></a><span class="sd">    Raises</span>
</span><span id="calc_moment-107"><a href="#calc_moment-107"><span class="linenos">107</span></a><span class="sd">    ------</span>
</span><span id="calc_moment-108"><a href="#calc_moment-108"><span class="linenos">108</span></a><span class="sd">    ValueError</span>
</span><span id="calc_moment-109"><a href="#calc_moment-109"><span class="linenos">109</span></a><span class="sd">        If the units of the centroid are not in pixel/voxel units.</span>
</span><span id="calc_moment-110"><a href="#calc_moment-110"><span class="linenos">110</span></a>
</span><span id="calc_moment-111"><a href="#calc_moment-111"><span class="linenos">111</span></a><span class="sd">    Examples</span>
</span><span id="calc_moment-112"><a href="#calc_moment-112"><span class="linenos">112</span></a><span class="sd">    --------</span>
</span><span id="calc_moment-113"><a href="#calc_moment-113"><span class="linenos">113</span></a><span class="sd">    &gt;&gt;&gt; indices = np.array([[0, 0, 0], [1, 1, 1], [2, 2, 2]], dtype=np.int32)</span>
</span><span id="calc_moment-114"><a href="#calc_moment-114"><span class="linenos">114</span></a><span class="sd">    &gt;&gt;&gt; centroid_px = Centroid(</span>
</span><span id="calc_moment-115"><a href="#calc_moment-115"><span class="linenos">115</span></a><span class="sd">    ...     cx=Length(1.0, Units.VOXEL),</span>
</span><span id="calc_moment-116"><a href="#calc_moment-116"><span class="linenos">116</span></a><span class="sd">    ...     cy=Length(1.0, Units.VOXEL),</span>
</span><span id="calc_moment-117"><a href="#calc_moment-117"><span class="linenos">117</span></a><span class="sd">    ...     cz=Length(1.0, Units.VOXEL)</span>
</span><span id="calc_moment-118"><a href="#calc_moment-118"><span class="linenos">118</span></a><span class="sd">    ... )</span>
</span><span id="calc_moment-119"><a href="#calc_moment-119"><span class="linenos">119</span></a><span class="sd">    &gt;&gt;&gt; calc_moment(indices, 2, 2, 2, centroid_px)</span>
</span><span id="calc_moment-120"><a href="#calc_moment-120"><span class="linenos">120</span></a><span class="sd">    0.66</span>
</span><span id="calc_moment-121"><a href="#calc_moment-121"><span class="linenos">121</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="calc_moment-122"><a href="#calc_moment-122"><span class="linenos">122</span></a>
</span><span id="calc_moment-123"><a href="#calc_moment-123"><span class="linenos">123</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">centroid_px</span><span class="o">.</span><span class="n">cx</span><span class="o">.</span><span class="n">unit</span>
</span><span id="calc_moment-124"><a href="#calc_moment-124"><span class="linenos">124</span></a>    <span class="k">if</span> <span class="n">unit</span> <span class="o">!=</span> <span class="n">Units</span><span class="o">.</span><span class="n">VOXEL</span><span class="p">:</span>
</span><span id="calc_moment-125"><a href="#calc_moment-125"><span class="linenos">125</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="calc_moment-126"><a href="#calc_moment-126"><span class="linenos">126</span></a>            <span class="sa">f</span><span class="s2">&quot;Moment invariants are calculated using pixel/voxel units, but </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2"> units were given&quot;</span>
</span><span id="calc_moment-127"><a href="#calc_moment-127"><span class="linenos">127</span></a>        <span class="p">)</span>
</span><span id="calc_moment-128"><a href="#calc_moment-128"><span class="linenos">128</span></a>
</span><span id="calc_moment-129"><a href="#calc_moment-129"><span class="linenos">129</span></a>    <span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="calc_moment-130"><a href="#calc_moment-130"><span class="linenos">130</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="calc_moment-131"><a href="#calc_moment-131"><span class="linenos">131</span></a>        <span class="n">mu</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="calc_moment-132"><a href="#calc_moment-132"><span class="linenos">132</span></a>            <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid_px</span><span class="o">.</span><span class="n">cx</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="calc_moment-133"><a href="#calc_moment-133"><span class="linenos">133</span></a>            <span class="o">**</span> <span class="n">p</span>  <span class="c1"># x-location of voxel w.r.t x-centroid</span>
</span><span id="calc_moment-134"><a href="#calc_moment-134"><span class="linenos">134</span></a>            <span class="o">*</span> <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid_px</span><span class="o">.</span><span class="n">cy</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="calc_moment-135"><a href="#calc_moment-135"><span class="linenos">135</span></a>            <span class="o">**</span> <span class="n">q</span>  <span class="c1"># y-location of voxel w.r.t y-centroid</span>
</span><span id="calc_moment-136"><a href="#calc_moment-136"><span class="linenos">136</span></a>            <span class="o">*</span> <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid_px</span><span class="o">.</span><span class="n">cz</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="calc_moment-137"><a href="#calc_moment-137"><span class="linenos">137</span></a>            <span class="o">**</span> <span class="n">r</span>  <span class="c1"># z-location of voxel w.r.t z-centroid</span>
</span><span id="calc_moment-138"><a href="#calc_moment-138"><span class="linenos">138</span></a>        <span class="p">)</span>
</span><span id="calc_moment-139"><a href="#calc_moment-139"><span class="linenos">139</span></a>    <span class="k">return</span> <span class="n">mu</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate 3D moment invariants of a feature based on its voxel locations.
Mask is given in index locations, so math here is all done in pixel units.</p>

<h2 id="parameters">Parameters</h2>

<p>indices : np.ndarray[np.int32]
    Array of [Z,Y,X] indices corresponding to the feature's voxel
    locations.
    The shape of the array should be (n, 3), where n is the number of
    voxels of the feature.
    Example: np.array([[Z1, Y1, X1], [Z2, Y2, X2], ..., [Zn, Yn, Xn]]).
p : int
    Order of the moment for the X dimension.
q : int
    Order of the moment for the Y dimension.
r : int
    Order of the moment for the Z dimension.
centroid_px : Centroid
    Centroid location for X, Y, and Z axis, respectively, in pixel units.</p>

<h2 id="returns">Returns</h2>

<p>float
    The 3D central moment (translation invariant) in pixel units
    normalized by object volume.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the units of the centroid are not in pixel/voxel units.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">centroid_px</span> <span class="o">=</span> <span class="n">Centroid</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">VOXEL</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">VOXEL</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">VOXEL</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">centroid_px</span><span class="p">)</span>
<span class="go">0.66</span>
</code></pre>
</div>
</div>


                </section>
                <section id="center_of_mass">
                            <input id="center_of_mass-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">center_of_mass</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">indices</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">]</span>,</span><span class="param">	<span class="n">resolution</span><span class="p">:</span> <span class="n"><a href="types.html#Resolution">recon3d.types.Resolution</a></span>,</span><span class="param">	<span class="n">origin</span><span class="p">:</span> <span class="n"><a href="types.html#Origin">recon3d.types.Origin</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Centroid">recon3d.types.Centroid</a></span>:</span></span>

                <label class="view-source-button" for="center_of_mass-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#center_of_mass"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="center_of_mass-142"><a href="#center_of_mass-142"><span class="linenos">142</span></a><span class="k">def</span><span class="w"> </span><span class="nf">center_of_mass</span><span class="p">(</span>
</span><span id="center_of_mass-143"><a href="#center_of_mass-143"><span class="linenos">143</span></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="n">resolution</span><span class="p">:</span> <span class="n">Resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">Origin</span>
</span><span id="center_of_mass-144"><a href="#center_of_mass-144"><span class="linenos">144</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Centroid</span><span class="p">:</span>
</span><span id="center_of_mass-145"><a href="#center_of_mass-145"><span class="linenos">145</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="center_of_mass-146"><a href="#center_of_mass-146"><span class="linenos">146</span></a><span class="sd">    Calculates the center of mass (centroid) of an instance object.</span>
</span><span id="center_of_mass-147"><a href="#center_of_mass-147"><span class="linenos">147</span></a><span class="sd">    Requires that the instance object has uniform density (is homogeneous).</span>
</span><span id="center_of_mass-148"><a href="#center_of_mass-148"><span class="linenos">148</span></a>
</span><span id="center_of_mass-149"><a href="#center_of_mass-149"><span class="linenos">149</span></a><span class="sd">    Parameters</span>
</span><span id="center_of_mass-150"><a href="#center_of_mass-150"><span class="linenos">150</span></a><span class="sd">    ----------</span>
</span><span id="center_of_mass-151"><a href="#center_of_mass-151"><span class="linenos">151</span></a><span class="sd">    indices : np.ndarray[np.int32]</span>
</span><span id="center_of_mass-152"><a href="#center_of_mass-152"><span class="linenos">152</span></a><span class="sd">        Array of [Z,Y,X] indices corresponding to the feature&#39;s voxel</span>
</span><span id="center_of_mass-153"><a href="#center_of_mass-153"><span class="linenos">153</span></a><span class="sd">        locations.</span>
</span><span id="center_of_mass-154"><a href="#center_of_mass-154"><span class="linenos">154</span></a><span class="sd">        The shape of the array should be (n, 3), where n is the number of</span>
</span><span id="center_of_mass-155"><a href="#center_of_mass-155"><span class="linenos">155</span></a><span class="sd">        voxels of the feature.</span>
</span><span id="center_of_mass-156"><a href="#center_of_mass-156"><span class="linenos">156</span></a><span class="sd">        Example: np.array([[Z1, Y1, X1], [Z2, Y2, X2], ..., [Zn, Yn, Xn]]).</span>
</span><span id="center_of_mass-157"><a href="#center_of_mass-157"><span class="linenos">157</span></a><span class="sd">    resolution : Resolution</span>
</span><span id="center_of_mass-158"><a href="#center_of_mass-158"><span class="linenos">158</span></a><span class="sd">        Resolution of the voxel grid in each dimension (dx, dy, dz).</span>
</span><span id="center_of_mass-159"><a href="#center_of_mass-159"><span class="linenos">159</span></a><span class="sd">    origin : Origin</span>
</span><span id="center_of_mass-160"><a href="#center_of_mass-160"><span class="linenos">160</span></a><span class="sd">        Origin of the voxel grid in each dimension (x0, y0, z0).</span>
</span><span id="center_of_mass-161"><a href="#center_of_mass-161"><span class="linenos">161</span></a>
</span><span id="center_of_mass-162"><a href="#center_of_mass-162"><span class="linenos">162</span></a><span class="sd">    Returns</span>
</span><span id="center_of_mass-163"><a href="#center_of_mass-163"><span class="linenos">163</span></a><span class="sd">    -------</span>
</span><span id="center_of_mass-164"><a href="#center_of_mass-164"><span class="linenos">164</span></a><span class="sd">    Centroid</span>
</span><span id="center_of_mass-165"><a href="#center_of_mass-165"><span class="linenos">165</span></a><span class="sd">        The centroid location for X, Y, and Z axis, respectively, in microns.</span>
</span><span id="center_of_mass-166"><a href="#center_of_mass-166"><span class="linenos">166</span></a>
</span><span id="center_of_mass-167"><a href="#center_of_mass-167"><span class="linenos">167</span></a><span class="sd">    Examples</span>
</span><span id="center_of_mass-168"><a href="#center_of_mass-168"><span class="linenos">168</span></a><span class="sd">    --------</span>
</span><span id="center_of_mass-169"><a href="#center_of_mass-169"><span class="linenos">169</span></a><span class="sd">    &gt;&gt;&gt; indices = np.array([[0, 0, 0], [1, 1, 1], [2, 2, 2]], dtype=np.int32)</span>
</span><span id="center_of_mass-170"><a href="#center_of_mass-170"><span class="linenos">170</span></a><span class="sd">    &gt;&gt;&gt; resolution = Resolution(dx=Length(1.0, Units.MICRON), dy=Length(1.0, Units.MICRON), dz=Length(1.0, Units.MICRON))</span>
</span><span id="center_of_mass-171"><a href="#center_of_mass-171"><span class="linenos">171</span></a><span class="sd">    &gt;&gt;&gt; origin = Origin(x0=Length(0.0, Units.MICRON), y0=Length(0.0, Units.MICRON), z0=Length(0.0, Units.MICRON))</span>
</span><span id="center_of_mass-172"><a href="#center_of_mass-172"><span class="linenos">172</span></a><span class="sd">    &gt;&gt;&gt; center_of_mass(indices, resolution, origin)</span>
</span><span id="center_of_mass-173"><a href="#center_of_mass-173"><span class="linenos">173</span></a><span class="sd">    Centroid(cx=Length(value=1.0, unit=Units.MICRON), cy=Length(value=1.0, unit=Units.MICRON), cz=Length(value=1.0, unit=Units.MICRON))</span>
</span><span id="center_of_mass-174"><a href="#center_of_mass-174"><span class="linenos">174</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="center_of_mass-175"><a href="#center_of_mass-175"><span class="linenos">175</span></a>
</span><span id="center_of_mass-176"><a href="#center_of_mass-176"><span class="linenos">176</span></a>    <span class="n">centroid_zyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="center_of_mass-177"><a href="#center_of_mass-177"><span class="linenos">177</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span>
</span><span id="center_of_mass-178"><a href="#center_of_mass-178"><span class="linenos">178</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span><span id="center_of_mass-179"><a href="#center_of_mass-179"><span class="linenos">179</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="center_of_mass-180"><a href="#center_of_mass-180"><span class="linenos">180</span></a>                <span class="p">[</span>
</span><span id="center_of_mass-181"><a href="#center_of_mass-181"><span class="linenos">181</span></a>                    <span class="n">resolution</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="center_of_mass-182"><a href="#center_of_mass-182"><span class="linenos">182</span></a>                    <span class="n">resolution</span><span class="o">.</span><span class="n">dy</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="center_of_mass-183"><a href="#center_of_mass-183"><span class="linenos">183</span></a>                    <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="center_of_mass-184"><a href="#center_of_mass-184"><span class="linenos">184</span></a>                <span class="p">]</span>
</span><span id="center_of_mass-185"><a href="#center_of_mass-185"><span class="linenos">185</span></a>            <span class="p">),</span>
</span><span id="center_of_mass-186"><a href="#center_of_mass-186"><span class="linenos">186</span></a>        <span class="p">),</span>
</span><span id="center_of_mass-187"><a href="#center_of_mass-187"><span class="linenos">187</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="center_of_mass-188"><a href="#center_of_mass-188"><span class="linenos">188</span></a>            <span class="p">[</span>
</span><span id="center_of_mass-189"><a href="#center_of_mass-189"><span class="linenos">189</span></a>                <span class="n">origin</span><span class="o">.</span><span class="n">z0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="center_of_mass-190"><a href="#center_of_mass-190"><span class="linenos">190</span></a>                <span class="n">origin</span><span class="o">.</span><span class="n">y0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="center_of_mass-191"><a href="#center_of_mass-191"><span class="linenos">191</span></a>                <span class="n">origin</span><span class="o">.</span><span class="n">x0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="center_of_mass-192"><a href="#center_of_mass-192"><span class="linenos">192</span></a>            <span class="p">]</span>
</span><span id="center_of_mass-193"><a href="#center_of_mass-193"><span class="linenos">193</span></a>        <span class="p">),</span>
</span><span id="center_of_mass-194"><a href="#center_of_mass-194"><span class="linenos">194</span></a>    <span class="p">)</span>
</span><span id="center_of_mass-195"><a href="#center_of_mass-195"><span class="linenos">195</span></a>    <span class="n">cx</span> <span class="o">=</span> <span class="n">centroid_zyx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="center_of_mass-196"><a href="#center_of_mass-196"><span class="linenos">196</span></a>    <span class="n">cy</span> <span class="o">=</span> <span class="n">centroid_zyx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="center_of_mass-197"><a href="#center_of_mass-197"><span class="linenos">197</span></a>    <span class="n">cz</span> <span class="o">=</span> <span class="n">centroid_zyx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="center_of_mass-198"><a href="#center_of_mass-198"><span class="linenos">198</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span>
</span><span id="center_of_mass-199"><a href="#center_of_mass-199"><span class="linenos">199</span></a>    <span class="k">return</span> <span class="n">Centroid</span><span class="p">(</span>
</span><span id="center_of_mass-200"><a href="#center_of_mass-200"><span class="linenos">200</span></a>        <span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="center_of_mass-201"><a href="#center_of_mass-201"><span class="linenos">201</span></a>        <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="center_of_mass-202"><a href="#center_of_mass-202"><span class="linenos">202</span></a>        <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="center_of_mass-203"><a href="#center_of_mass-203"><span class="linenos">203</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the center of mass (centroid) of an instance object.
Requires that the instance object has uniform density (is homogeneous).</p>

<h2 id="parameters">Parameters</h2>

<p>indices : np.ndarray[np.int32]
    Array of [Z,Y,X] indices corresponding to the feature's voxel
    locations.
    The shape of the array should be (n, 3), where n is the number of
    voxels of the feature.
    Example: np.array([[Z1, Y1, X1], [Z2, Y2, X2], ..., [Zn, Yn, Xn]]).
resolution : Resolution
    Resolution of the voxel grid in each dimension (dx, dy, dz).
origin : Origin
    Origin of the voxel grid in each dimension (x0, y0, z0).</p>

<h2 id="returns">Returns</h2>

<p>Centroid
    The centroid location for X, Y, and Z axis, respectively, in microns.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resolution</span> <span class="o">=</span> <span class="n">Resolution</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">origin</span> <span class="o">=</span> <span class="n">Origin</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">center_of_mass</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
<span class="go">Centroid(cx=Length(value=1.0, unit=Units.MICRON), cy=Length(value=1.0, unit=Units.MICRON), cz=Length(value=1.0, unit=Units.MICRON))</span>
</code></pre>
</div>
</div>


                </section>
                <section id="centroid_pix">
                            <input id="centroid_pix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">centroid_pix</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">centroid</span><span class="p">:</span> <span class="n"><a href="types.html#Centroid">recon3d.types.Centroid</a></span>,</span><span class="param">	<span class="n">resolution</span><span class="p">:</span> <span class="n"><a href="types.html#Resolution">recon3d.types.Resolution</a></span>,</span><span class="param">	<span class="n">origin</span><span class="p">:</span> <span class="n"><a href="types.html#Origin">recon3d.types.Origin</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Centroid">recon3d.types.Centroid</a></span>:</span></span>

                <label class="view-source-button" for="centroid_pix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#centroid_pix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="centroid_pix-206"><a href="#centroid_pix-206"><span class="linenos">206</span></a><span class="k">def</span><span class="w"> </span><span class="nf">centroid_pix</span><span class="p">(</span>
</span><span id="centroid_pix-207"><a href="#centroid_pix-207"><span class="linenos">207</span></a>    <span class="n">centroid</span><span class="p">:</span> <span class="n">Centroid</span><span class="p">,</span> <span class="n">resolution</span><span class="p">:</span> <span class="n">Resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">Origin</span>
</span><span id="centroid_pix-208"><a href="#centroid_pix-208"><span class="linenos">208</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Centroid</span><span class="p">:</span>
</span><span id="centroid_pix-209"><a href="#centroid_pix-209"><span class="linenos">209</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="centroid_pix-210"><a href="#centroid_pix-210"><span class="linenos">210</span></a><span class="sd">    Convert between real space units and pixel units.</span>
</span><span id="centroid_pix-211"><a href="#centroid_pix-211"><span class="linenos">211</span></a>
</span><span id="centroid_pix-212"><a href="#centroid_pix-212"><span class="linenos">212</span></a><span class="sd">    Parameters</span>
</span><span id="centroid_pix-213"><a href="#centroid_pix-213"><span class="linenos">213</span></a><span class="sd">    ----------</span>
</span><span id="centroid_pix-214"><a href="#centroid_pix-214"><span class="linenos">214</span></a><span class="sd">    centroid : Centroid</span>
</span><span id="centroid_pix-215"><a href="#centroid_pix-215"><span class="linenos">215</span></a><span class="sd">        The centroid location in real space units.</span>
</span><span id="centroid_pix-216"><a href="#centroid_pix-216"><span class="linenos">216</span></a><span class="sd">    resolution : Resolution</span>
</span><span id="centroid_pix-217"><a href="#centroid_pix-217"><span class="linenos">217</span></a><span class="sd">        Resolution of the voxel grid in each dimension (dx, dy, dz).</span>
</span><span id="centroid_pix-218"><a href="#centroid_pix-218"><span class="linenos">218</span></a><span class="sd">    origin : Origin</span>
</span><span id="centroid_pix-219"><a href="#centroid_pix-219"><span class="linenos">219</span></a><span class="sd">        Origin of the voxel grid in each dimension (x0, y0, z0).</span>
</span><span id="centroid_pix-220"><a href="#centroid_pix-220"><span class="linenos">220</span></a>
</span><span id="centroid_pix-221"><a href="#centroid_pix-221"><span class="linenos">221</span></a><span class="sd">    Returns</span>
</span><span id="centroid_pix-222"><a href="#centroid_pix-222"><span class="linenos">222</span></a><span class="sd">    -------</span>
</span><span id="centroid_pix-223"><a href="#centroid_pix-223"><span class="linenos">223</span></a><span class="sd">    Centroid</span>
</span><span id="centroid_pix-224"><a href="#centroid_pix-224"><span class="linenos">224</span></a><span class="sd">        The centroid location in pixel units.</span>
</span><span id="centroid_pix-225"><a href="#centroid_pix-225"><span class="linenos">225</span></a>
</span><span id="centroid_pix-226"><a href="#centroid_pix-226"><span class="linenos">226</span></a><span class="sd">    Examples</span>
</span><span id="centroid_pix-227"><a href="#centroid_pix-227"><span class="linenos">227</span></a><span class="sd">    --------</span>
</span><span id="centroid_pix-228"><a href="#centroid_pix-228"><span class="linenos">228</span></a><span class="sd">    &gt;&gt;&gt; centroid = Centroid(cx=Length(10.0, Units.MICRON), cy=Length(20.0, Units.MICRON), cz=Length(30.0, Units.MICRON))</span>
</span><span id="centroid_pix-229"><a href="#centroid_pix-229"><span class="linenos">229</span></a><span class="sd">    &gt;&gt;&gt; resolution = Resolution(dx=Length(1.0, Units.MICRON), dy=Length(1.0, Units.MICRON), dz=Length(1.0, Units.MICRON))</span>
</span><span id="centroid_pix-230"><a href="#centroid_pix-230"><span class="linenos">230</span></a><span class="sd">    &gt;&gt;&gt; origin = Origin(x0=Length(0.0, Units.MICRON), y0=Length(0.0, Units.MICRON), z0=Length(0.0, Units.MICRON))</span>
</span><span id="centroid_pix-231"><a href="#centroid_pix-231"><span class="linenos">231</span></a><span class="sd">    &gt;&gt;&gt; centroid_pix(centroid, resolution, origin)</span>
</span><span id="centroid_pix-232"><a href="#centroid_pix-232"><span class="linenos">232</span></a><span class="sd">    Centroid(cx=Length(value=10.0, unit=Units.VOXEL), cy=Length(value=20.0, unit=Units.VOXEL), cz=Length(value=30.0, unit=Units.VOXEL))</span>
</span><span id="centroid_pix-233"><a href="#centroid_pix-233"><span class="linenos">233</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="centroid_pix-234"><a href="#centroid_pix-234"><span class="linenos">234</span></a>
</span><span id="centroid_pix-235"><a href="#centroid_pix-235"><span class="linenos">235</span></a>    <span class="c1"># convert centroids to normalized pixel units</span>
</span><span id="centroid_pix-236"><a href="#centroid_pix-236"><span class="linenos">236</span></a>    <span class="n">cx</span> <span class="o">=</span> <span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">cx</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">origin</span><span class="o">.</span><span class="n">x0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span>
</span><span id="centroid_pix-237"><a href="#centroid_pix-237"><span class="linenos">237</span></a>    <span class="n">cy</span> <span class="o">=</span> <span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">cy</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">origin</span><span class="o">.</span><span class="n">y0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dy</span><span class="o">.</span><span class="n">value</span>
</span><span id="centroid_pix-238"><a href="#centroid_pix-238"><span class="linenos">238</span></a>    <span class="n">cz</span> <span class="o">=</span> <span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">cz</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">origin</span><span class="o">.</span><span class="n">z0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">value</span>
</span><span id="centroid_pix-239"><a href="#centroid_pix-239"><span class="linenos">239</span></a>
</span><span id="centroid_pix-240"><a href="#centroid_pix-240"><span class="linenos">240</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">VOXEL</span>
</span><span id="centroid_pix-241"><a href="#centroid_pix-241"><span class="linenos">241</span></a>
</span><span id="centroid_pix-242"><a href="#centroid_pix-242"><span class="linenos">242</span></a>    <span class="k">return</span> <span class="n">Centroid</span><span class="p">(</span>
</span><span id="centroid_pix-243"><a href="#centroid_pix-243"><span class="linenos">243</span></a>        <span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="centroid_pix-244"><a href="#centroid_pix-244"><span class="linenos">244</span></a>        <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="centroid_pix-245"><a href="#centroid_pix-245"><span class="linenos">245</span></a>        <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="centroid_pix-246"><a href="#centroid_pix-246"><span class="linenos">246</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert between real space units and pixel units.</p>

<h2 id="parameters">Parameters</h2>

<p>centroid : Centroid
    The centroid location in real space units.
resolution : Resolution
    Resolution of the voxel grid in each dimension (dx, dy, dz).
origin : Origin
    Origin of the voxel grid in each dimension (x0, y0, z0).</p>

<h2 id="returns">Returns</h2>

<p>Centroid
    The centroid location in pixel units.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">centroid</span> <span class="o">=</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resolution</span> <span class="o">=</span> <span class="n">Resolution</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">origin</span> <span class="o">=</span> <span class="n">Origin</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">centroid_pix</span><span class="p">(</span><span class="n">centroid</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
<span class="go">Centroid(cx=Length(value=10.0, unit=Units.VOXEL), cy=Length(value=20.0, unit=Units.VOXEL), cz=Length(value=30.0, unit=Units.VOXEL))</span>
</code></pre>
</div>
</div>


                </section>
                <section id="ellipsoid_surface_area">
                            <input id="ellipsoid_surface_area-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ellipsoid_surface_area</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ellipsoid</span><span class="p">:</span> <span class="n"><a href="types.html#BestFitEllipsoid">recon3d.types.BestFitEllipsoid</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Area">recon3d.types.Area</a></span>:</span></span>

                <label class="view-source-button" for="ellipsoid_surface_area-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ellipsoid_surface_area"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ellipsoid_surface_area-249"><a href="#ellipsoid_surface_area-249"><span class="linenos">249</span></a><span class="k">def</span><span class="w"> </span><span class="nf">ellipsoid_surface_area</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">:</span> <span class="n">BestFitEllipsoid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Area</span><span class="p">:</span>
</span><span id="ellipsoid_surface_area-250"><a href="#ellipsoid_surface_area-250"><span class="linenos">250</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ellipsoid_surface_area-251"><a href="#ellipsoid_surface_area-251"><span class="linenos">251</span></a><span class="sd">    Calculate the surface area of the best fit ellipsoid using the Knud Thomsen formula.</span>
</span><span id="ellipsoid_surface_area-252"><a href="#ellipsoid_surface_area-252"><span class="linenos">252</span></a><span class="sd">    Applicable to scalene ellipsoids (semi-axes a &gt; b &gt; c), with a relative error of at most 1.061%.</span>
</span><span id="ellipsoid_surface_area-253"><a href="#ellipsoid_surface_area-253"><span class="linenos">253</span></a>
</span><span id="ellipsoid_surface_area-254"><a href="#ellipsoid_surface_area-254"><span class="linenos">254</span></a><span class="sd">    Parameters</span>
</span><span id="ellipsoid_surface_area-255"><a href="#ellipsoid_surface_area-255"><span class="linenos">255</span></a><span class="sd">    ----------</span>
</span><span id="ellipsoid_surface_area-256"><a href="#ellipsoid_surface_area-256"><span class="linenos">256</span></a><span class="sd">    ellipsoid : BestFitEllipsoid</span>
</span><span id="ellipsoid_surface_area-257"><a href="#ellipsoid_surface_area-257"><span class="linenos">257</span></a><span class="sd">        The best fit ellipsoid with semi-axes lengths a, b, and c.</span>
</span><span id="ellipsoid_surface_area-258"><a href="#ellipsoid_surface_area-258"><span class="linenos">258</span></a>
</span><span id="ellipsoid_surface_area-259"><a href="#ellipsoid_surface_area-259"><span class="linenos">259</span></a><span class="sd">    Returns</span>
</span><span id="ellipsoid_surface_area-260"><a href="#ellipsoid_surface_area-260"><span class="linenos">260</span></a><span class="sd">    -------</span>
</span><span id="ellipsoid_surface_area-261"><a href="#ellipsoid_surface_area-261"><span class="linenos">261</span></a><span class="sd">    Area</span>
</span><span id="ellipsoid_surface_area-262"><a href="#ellipsoid_surface_area-262"><span class="linenos">262</span></a><span class="sd">        The surface area of the ellipsoid in microns squared.</span>
</span><span id="ellipsoid_surface_area-263"><a href="#ellipsoid_surface_area-263"><span class="linenos">263</span></a>
</span><span id="ellipsoid_surface_area-264"><a href="#ellipsoid_surface_area-264"><span class="linenos">264</span></a><span class="sd">    Examples</span>
</span><span id="ellipsoid_surface_area-265"><a href="#ellipsoid_surface_area-265"><span class="linenos">265</span></a><span class="sd">    --------</span>
</span><span id="ellipsoid_surface_area-266"><a href="#ellipsoid_surface_area-266"><span class="linenos">266</span></a><span class="sd">    &gt;&gt;&gt; ellipsoid = BestFitEllipsoid(</span>
</span><span id="ellipsoid_surface_area-267"><a href="#ellipsoid_surface_area-267"><span class="linenos">267</span></a><span class="sd">    ...     a=EllipsoidAxis(length=Length(5.0, Units.MICRON), orientation=UnitVector(u=1, v=0, w=0)),</span>
</span><span id="ellipsoid_surface_area-268"><a href="#ellipsoid_surface_area-268"><span class="linenos">268</span></a><span class="sd">    ...     b=EllipsoidAxis(length=Length(3.0, Units.MICRON), orientation=UnitVector(u=0, v=1, w=0)),</span>
</span><span id="ellipsoid_surface_area-269"><a href="#ellipsoid_surface_area-269"><span class="linenos">269</span></a><span class="sd">    ...     c=EllipsoidAxis(length=Length(2.0, Units.MICRON), orientation=UnitVector(u=0, v=0, w=1))</span>
</span><span id="ellipsoid_surface_area-270"><a href="#ellipsoid_surface_area-270"><span class="linenos">270</span></a><span class="sd">    ... )</span>
</span><span id="ellipsoid_surface_area-271"><a href="#ellipsoid_surface_area-271"><span class="linenos">271</span></a><span class="sd">    &gt;&gt;&gt; ellipsoid_surface_area(ellipsoid)</span>
</span><span id="ellipsoid_surface_area-272"><a href="#ellipsoid_surface_area-272"><span class="linenos">272</span></a><span class="sd">    Area(value=134.8149867941625, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</span><span id="ellipsoid_surface_area-273"><a href="#ellipsoid_surface_area-273"><span class="linenos">273</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ellipsoid_surface_area-274"><a href="#ellipsoid_surface_area-274"><span class="linenos">274</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">unit</span>
</span><span id="ellipsoid_surface_area-275"><a href="#ellipsoid_surface_area-275"><span class="linenos">275</span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Constants</span><span class="p">()</span><span class="o">.</span><span class="n">KNUD_THOMSEN_FACTOR</span>
</span><span id="ellipsoid_surface_area-276"><a href="#ellipsoid_surface_area-276"><span class="linenos">276</span></a>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ellipsoid_surface_area-277"><a href="#ellipsoid_surface_area-277"><span class="linenos">277</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="ellipsoid_surface_area-278"><a href="#ellipsoid_surface_area-278"><span class="linenos">278</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="ellipsoid_surface_area-279"><a href="#ellipsoid_surface_area-279"><span class="linenos">279</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="ellipsoid_surface_area-280"><a href="#ellipsoid_surface_area-280"><span class="linenos">280</span></a>    <span class="p">)</span>
</span><span id="ellipsoid_surface_area-281"><a href="#ellipsoid_surface_area-281"><span class="linenos">281</span></a>
</span><span id="ellipsoid_surface_area-282"><a href="#ellipsoid_surface_area-282"><span class="linenos">282</span></a>    <span class="n">surface_area</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ellipsoid_surface_area-283"><a href="#ellipsoid_surface_area-283"><span class="linenos">283</span></a>        <span class="mi">4</span>
</span><span id="ellipsoid_surface_area-284"><a href="#ellipsoid_surface_area-284"><span class="linenos">284</span></a>        <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
</span><span id="ellipsoid_surface_area-285"><a href="#ellipsoid_surface_area-285"><span class="linenos">285</span></a>        <span class="o">*</span> <span class="p">((((</span><span class="n">a</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">b</span><span class="o">**</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">c</span><span class="o">**</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">c</span><span class="o">**</span><span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">p</span><span class="p">))</span>
</span><span id="ellipsoid_surface_area-286"><a href="#ellipsoid_surface_area-286"><span class="linenos">286</span></a>    <span class="p">)</span>
</span><span id="ellipsoid_surface_area-287"><a href="#ellipsoid_surface_area-287"><span class="linenos">287</span></a>    <span class="k">return</span> <span class="n">Area</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">surface_area</span><span class="p">,</span> <span class="n">unit_squared</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the surface area of the best fit ellipsoid using the Knud Thomsen formula.
Applicable to scalene ellipsoids (semi-axes a &gt; b &gt; c), with a relative error of at most 1.061%.</p>

<h2 id="parameters">Parameters</h2>

<p>ellipsoid : BestFitEllipsoid
    The best fit ellipsoid with semi-axes lengths a, b, and c.</p>

<h2 id="returns">Returns</h2>

<p>Area
    The surface area of the ellipsoid in microns squared.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">BestFitEllipsoid</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">a</span><span class="o">=</span><span class="n">EllipsoidAxis</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="n">UnitVector</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">b</span><span class="o">=</span><span class="n">EllipsoidAxis</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="n">UnitVector</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">=</span><span class="n">EllipsoidAxis</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="n">UnitVector</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ellipsoid_surface_area</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
<span class="go">Area(value=134.8149867941625, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="ellipsoid_volume">
                            <input id="ellipsoid_volume-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ellipsoid_volume</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ellipsoid</span><span class="p">:</span> <span class="n"><a href="types.html#BestFitEllipsoid">recon3d.types.BestFitEllipsoid</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Volume">recon3d.types.Volume</a></span>:</span></span>

                <label class="view-source-button" for="ellipsoid_volume-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ellipsoid_volume"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ellipsoid_volume-290"><a href="#ellipsoid_volume-290"><span class="linenos">290</span></a><span class="k">def</span><span class="w"> </span><span class="nf">ellipsoid_volume</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">:</span> <span class="n">BestFitEllipsoid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Volume</span><span class="p">:</span>
</span><span id="ellipsoid_volume-291"><a href="#ellipsoid_volume-291"><span class="linenos">291</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ellipsoid_volume-292"><a href="#ellipsoid_volume-292"><span class="linenos">292</span></a><span class="sd">    Calculate the volume of the best fit ellipsoid using semi-axes lengths.</span>
</span><span id="ellipsoid_volume-293"><a href="#ellipsoid_volume-293"><span class="linenos">293</span></a>
</span><span id="ellipsoid_volume-294"><a href="#ellipsoid_volume-294"><span class="linenos">294</span></a><span class="sd">    Parameters</span>
</span><span id="ellipsoid_volume-295"><a href="#ellipsoid_volume-295"><span class="linenos">295</span></a><span class="sd">    ----------</span>
</span><span id="ellipsoid_volume-296"><a href="#ellipsoid_volume-296"><span class="linenos">296</span></a><span class="sd">    ellipsoid : BestFitEllipsoid</span>
</span><span id="ellipsoid_volume-297"><a href="#ellipsoid_volume-297"><span class="linenos">297</span></a><span class="sd">        The best fit ellipsoid with semi-axes lengths a, b, and c.</span>
</span><span id="ellipsoid_volume-298"><a href="#ellipsoid_volume-298"><span class="linenos">298</span></a>
</span><span id="ellipsoid_volume-299"><a href="#ellipsoid_volume-299"><span class="linenos">299</span></a><span class="sd">    Returns</span>
</span><span id="ellipsoid_volume-300"><a href="#ellipsoid_volume-300"><span class="linenos">300</span></a><span class="sd">    -------</span>
</span><span id="ellipsoid_volume-301"><a href="#ellipsoid_volume-301"><span class="linenos">301</span></a><span class="sd">    Volume</span>
</span><span id="ellipsoid_volume-302"><a href="#ellipsoid_volume-302"><span class="linenos">302</span></a><span class="sd">        The volume of the ellipsoid in microns cubed.</span>
</span><span id="ellipsoid_volume-303"><a href="#ellipsoid_volume-303"><span class="linenos">303</span></a>
</span><span id="ellipsoid_volume-304"><a href="#ellipsoid_volume-304"><span class="linenos">304</span></a><span class="sd">    Examples</span>
</span><span id="ellipsoid_volume-305"><a href="#ellipsoid_volume-305"><span class="linenos">305</span></a><span class="sd">    --------</span>
</span><span id="ellipsoid_volume-306"><a href="#ellipsoid_volume-306"><span class="linenos">306</span></a><span class="sd">    &gt;&gt;&gt; ellipsoid = BestFitEllipsoid(</span>
</span><span id="ellipsoid_volume-307"><a href="#ellipsoid_volume-307"><span class="linenos">307</span></a><span class="sd">    ...     a=EllipsoidAxis(length=Length(5.0, Units.MICRON), orientation=UnitVector(u=1, v=0, w=0)),</span>
</span><span id="ellipsoid_volume-308"><a href="#ellipsoid_volume-308"><span class="linenos">308</span></a><span class="sd">    ...     b=EllipsoidAxis(length=Length(3.0, Units.MICRON), orientation=UnitVector(u=0, v=1, w=0)),</span>
</span><span id="ellipsoid_volume-309"><a href="#ellipsoid_volume-309"><span class="linenos">309</span></a><span class="sd">    ...     c=EllipsoidAxis(length=Length(2.0, Units.MICRON), orientation=UnitVector(u=0, v=0, w=1))</span>
</span><span id="ellipsoid_volume-310"><a href="#ellipsoid_volume-310"><span class="linenos">310</span></a><span class="sd">    ... )</span>
</span><span id="ellipsoid_volume-311"><a href="#ellipsoid_volume-311"><span class="linenos">311</span></a><span class="sd">    &gt;&gt;&gt; ellipsoid_volume(ellipsoid)</span>
</span><span id="ellipsoid_volume-312"><a href="#ellipsoid_volume-312"><span class="linenos">312</span></a><span class="sd">    Volume(value=125.66370614359171, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</span><span id="ellipsoid_volume-313"><a href="#ellipsoid_volume-313"><span class="linenos">313</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ellipsoid_volume-314"><a href="#ellipsoid_volume-314"><span class="linenos">314</span></a>
</span><span id="ellipsoid_volume-315"><a href="#ellipsoid_volume-315"><span class="linenos">315</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">unit</span>
</span><span id="ellipsoid_volume-316"><a href="#ellipsoid_volume-316"><span class="linenos">316</span></a>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ellipsoid_volume-317"><a href="#ellipsoid_volume-317"><span class="linenos">317</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="ellipsoid_volume-318"><a href="#ellipsoid_volume-318"><span class="linenos">318</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="ellipsoid_volume-319"><a href="#ellipsoid_volume-319"><span class="linenos">319</span></a>        <span class="n">ellipsoid</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="ellipsoid_volume-320"><a href="#ellipsoid_volume-320"><span class="linenos">320</span></a>    <span class="p">)</span>
</span><span id="ellipsoid_volume-321"><a href="#ellipsoid_volume-321"><span class="linenos">321</span></a>
</span><span id="ellipsoid_volume-322"><a href="#ellipsoid_volume-322"><span class="linenos">322</span></a>    <span class="n">volume</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span>
</span><span id="ellipsoid_volume-323"><a href="#ellipsoid_volume-323"><span class="linenos">323</span></a>
</span><span id="ellipsoid_volume-324"><a href="#ellipsoid_volume-324"><span class="linenos">324</span></a>    <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">volume</span><span class="p">,</span> <span class="n">unit_cubed</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the volume of the best fit ellipsoid using semi-axes lengths.</p>

<h2 id="parameters">Parameters</h2>

<p>ellipsoid : BestFitEllipsoid
    The best fit ellipsoid with semi-axes lengths a, b, and c.</p>

<h2 id="returns">Returns</h2>

<p>Volume
    The volume of the ellipsoid in microns cubed.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">BestFitEllipsoid</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">a</span><span class="o">=</span><span class="n">EllipsoidAxis</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="n">UnitVector</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">b</span><span class="o">=</span><span class="n">EllipsoidAxis</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="n">UnitVector</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">=</span><span class="n">EllipsoidAxis</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="n">UnitVector</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ellipsoid_volume</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
<span class="go">Volume(value=125.66370614359171, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="equivalent_spherical_diameter">
                            <input id="equivalent_spherical_diameter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">equivalent_spherical_diameter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_voxels</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">resolution</span><span class="p">:</span> <span class="n"><a href="types.html#Resolution">recon3d.types.Resolution</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Length">recon3d.types.Length</a></span>:</span></span>

                <label class="view-source-button" for="equivalent_spherical_diameter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#equivalent_spherical_diameter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="equivalent_spherical_diameter-327"><a href="#equivalent_spherical_diameter-327"><span class="linenos">327</span></a><span class="k">def</span><span class="w"> </span><span class="nf">equivalent_spherical_diameter</span><span class="p">(</span>
</span><span id="equivalent_spherical_diameter-328"><a href="#equivalent_spherical_diameter-328"><span class="linenos">328</span></a>    <span class="n">n_voxels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="equivalent_spherical_diameter-329"><a href="#equivalent_spherical_diameter-329"><span class="linenos">329</span></a>    <span class="n">resolution</span><span class="p">:</span> <span class="n">Resolution</span><span class="p">,</span>
</span><span id="equivalent_spherical_diameter-330"><a href="#equivalent_spherical_diameter-330"><span class="linenos">330</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Length</span><span class="p">:</span>
</span><span id="equivalent_spherical_diameter-331"><a href="#equivalent_spherical_diameter-331"><span class="linenos">331</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="equivalent_spherical_diameter-332"><a href="#equivalent_spherical_diameter-332"><span class="linenos">332</span></a><span class="sd">    Calculate the equivalent spherical diameter of a feature.</span>
</span><span id="equivalent_spherical_diameter-333"><a href="#equivalent_spherical_diameter-333"><span class="linenos">333</span></a>
</span><span id="equivalent_spherical_diameter-334"><a href="#equivalent_spherical_diameter-334"><span class="linenos">334</span></a><span class="sd">    Parameters</span>
</span><span id="equivalent_spherical_diameter-335"><a href="#equivalent_spherical_diameter-335"><span class="linenos">335</span></a><span class="sd">    ----------</span>
</span><span id="equivalent_spherical_diameter-336"><a href="#equivalent_spherical_diameter-336"><span class="linenos">336</span></a><span class="sd">    n_voxels : int</span>
</span><span id="equivalent_spherical_diameter-337"><a href="#equivalent_spherical_diameter-337"><span class="linenos">337</span></a><span class="sd">        The number of voxels in the feature.</span>
</span><span id="equivalent_spherical_diameter-338"><a href="#equivalent_spherical_diameter-338"><span class="linenos">338</span></a><span class="sd">    resolution : Resolution</span>
</span><span id="equivalent_spherical_diameter-339"><a href="#equivalent_spherical_diameter-339"><span class="linenos">339</span></a><span class="sd">        The resolution of the voxel grid in each dimension (dx, dy, dz).</span>
</span><span id="equivalent_spherical_diameter-340"><a href="#equivalent_spherical_diameter-340"><span class="linenos">340</span></a>
</span><span id="equivalent_spherical_diameter-341"><a href="#equivalent_spherical_diameter-341"><span class="linenos">341</span></a><span class="sd">    Returns</span>
</span><span id="equivalent_spherical_diameter-342"><a href="#equivalent_spherical_diameter-342"><span class="linenos">342</span></a><span class="sd">    -------</span>
</span><span id="equivalent_spherical_diameter-343"><a href="#equivalent_spherical_diameter-343"><span class="linenos">343</span></a><span class="sd">    Length</span>
</span><span id="equivalent_spherical_diameter-344"><a href="#equivalent_spherical_diameter-344"><span class="linenos">344</span></a><span class="sd">        The equivalent spherical diameter of the feature in the same units as</span>
</span><span id="equivalent_spherical_diameter-345"><a href="#equivalent_spherical_diameter-345"><span class="linenos">345</span></a><span class="sd">        the resolution.</span>
</span><span id="equivalent_spherical_diameter-346"><a href="#equivalent_spherical_diameter-346"><span class="linenos">346</span></a>
</span><span id="equivalent_spherical_diameter-347"><a href="#equivalent_spherical_diameter-347"><span class="linenos">347</span></a><span class="sd">    Examples</span>
</span><span id="equivalent_spherical_diameter-348"><a href="#equivalent_spherical_diameter-348"><span class="linenos">348</span></a><span class="sd">    --------</span>
</span><span id="equivalent_spherical_diameter-349"><a href="#equivalent_spherical_diameter-349"><span class="linenos">349</span></a><span class="sd">    &gt;&gt;&gt; resolution = Resolution(</span>
</span><span id="equivalent_spherical_diameter-350"><a href="#equivalent_spherical_diameter-350"><span class="linenos">350</span></a><span class="sd">    ...     dx=Length(1.0, Units.MICRON),</span>
</span><span id="equivalent_spherical_diameter-351"><a href="#equivalent_spherical_diameter-351"><span class="linenos">351</span></a><span class="sd">    ...     dy=Length(1.0, Units.MICRON),</span>
</span><span id="equivalent_spherical_diameter-352"><a href="#equivalent_spherical_diameter-352"><span class="linenos">352</span></a><span class="sd">    ...     dz=Length(1.0, Units.MICRON)</span>
</span><span id="equivalent_spherical_diameter-353"><a href="#equivalent_spherical_diameter-353"><span class="linenos">353</span></a><span class="sd">    ... )</span>
</span><span id="equivalent_spherical_diameter-354"><a href="#equivalent_spherical_diameter-354"><span class="linenos">354</span></a><span class="sd">    &gt;&gt;&gt; equivalent_spherical_diameter(1000, resolution)</span>
</span><span id="equivalent_spherical_diameter-355"><a href="#equivalent_spherical_diameter-355"><span class="linenos">355</span></a><span class="sd">    Length(value=12.407009817988, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</span><span id="equivalent_spherical_diameter-356"><a href="#equivalent_spherical_diameter-356"><span class="linenos">356</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="equivalent_spherical_diameter-357"><a href="#equivalent_spherical_diameter-357"><span class="linenos">357</span></a>
</span><span id="equivalent_spherical_diameter-358"><a href="#equivalent_spherical_diameter-358"><span class="linenos">358</span></a>    <span class="n">value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
</span><span id="equivalent_spherical_diameter-359"><a href="#equivalent_spherical_diameter-359"><span class="linenos">359</span></a>        <span class="p">(</span>
</span><span id="equivalent_spherical_diameter-360"><a href="#equivalent_spherical_diameter-360"><span class="linenos">360</span></a>            <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
</span><span id="equivalent_spherical_diameter-361"><a href="#equivalent_spherical_diameter-361"><span class="linenos">361</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="equivalent_spherical_diameter-362"><a href="#equivalent_spherical_diameter-362"><span class="linenos">362</span></a>                <span class="n">n_voxels</span>
</span><span id="equivalent_spherical_diameter-363"><a href="#equivalent_spherical_diameter-363"><span class="linenos">363</span></a>                <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span>
</span><span id="equivalent_spherical_diameter-364"><a href="#equivalent_spherical_diameter-364"><span class="linenos">364</span></a>                <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dy</span><span class="o">.</span><span class="n">value</span>
</span><span id="equivalent_spherical_diameter-365"><a href="#equivalent_spherical_diameter-365"><span class="linenos">365</span></a>                <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">value</span>
</span><span id="equivalent_spherical_diameter-366"><a href="#equivalent_spherical_diameter-366"><span class="linenos">366</span></a>            <span class="p">)</span>
</span><span id="equivalent_spherical_diameter-367"><a href="#equivalent_spherical_diameter-367"><span class="linenos">367</span></a>        <span class="p">),</span>
</span><span id="equivalent_spherical_diameter-368"><a href="#equivalent_spherical_diameter-368"><span class="linenos">368</span></a>        <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="equivalent_spherical_diameter-369"><a href="#equivalent_spherical_diameter-369"><span class="linenos">369</span></a>    <span class="p">)</span>
</span><span id="equivalent_spherical_diameter-370"><a href="#equivalent_spherical_diameter-370"><span class="linenos">370</span></a>    <span class="k">return</span> <span class="n">Length</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the equivalent spherical diameter of a feature.</p>

<h2 id="parameters">Parameters</h2>

<p>n_voxels : int
    The number of voxels in the feature.
resolution : Resolution
    The resolution of the voxel grid in each dimension (dx, dy, dz).</p>

<h2 id="returns">Returns</h2>

<p>Length
    The equivalent spherical diameter of the feature in the same units as
    the resolution.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">resolution</span> <span class="o">=</span> <span class="n">Resolution</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">equivalent_spherical_diameter</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
<span class="go">Length(value=12.407009817988, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="fit_ellipsoid">
                            <input id="fit_ellipsoid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit_ellipsoid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">indices</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">centroid</span><span class="p">:</span> <span class="n"><a href="types.html#Centroid">recon3d.types.Centroid</a></span>,</span><span class="param">	<span class="n">resolution</span><span class="p">:</span> <span class="n"><a href="types.html#Resolution">recon3d.types.Resolution</a></span>,</span><span class="param">	<span class="n">origin</span><span class="p">:</span> <span class="n"><a href="types.html#Origin">recon3d.types.Origin</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#BestFitEllipsoid">recon3d.types.BestFitEllipsoid</a></span>:</span></span>

                <label class="view-source-button" for="fit_ellipsoid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fit_ellipsoid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fit_ellipsoid-373"><a href="#fit_ellipsoid-373"><span class="linenos">373</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fit_ellipsoid</span><span class="p">(</span>
</span><span id="fit_ellipsoid-374"><a href="#fit_ellipsoid-374"><span class="linenos">374</span></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="fit_ellipsoid-375"><a href="#fit_ellipsoid-375"><span class="linenos">375</span></a>    <span class="n">centroid</span><span class="p">:</span> <span class="n">Centroid</span><span class="p">,</span>
</span><span id="fit_ellipsoid-376"><a href="#fit_ellipsoid-376"><span class="linenos">376</span></a>    <span class="n">resolution</span><span class="p">:</span> <span class="n">Resolution</span><span class="p">,</span>
</span><span id="fit_ellipsoid-377"><a href="#fit_ellipsoid-377"><span class="linenos">377</span></a>    <span class="n">origin</span><span class="p">:</span> <span class="n">Origin</span><span class="p">,</span>
</span><span id="fit_ellipsoid-378"><a href="#fit_ellipsoid-378"><span class="linenos">378</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BestFitEllipsoid</span><span class="p">:</span>
</span><span id="fit_ellipsoid-379"><a href="#fit_ellipsoid-379"><span class="linenos">379</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="fit_ellipsoid-380"><a href="#fit_ellipsoid-380"><span class="linenos">380</span></a><span class="sd">    Fit a 3D ellipsoid to a set of voxel indices.</span>
</span><span id="fit_ellipsoid-381"><a href="#fit_ellipsoid-381"><span class="linenos">381</span></a>
</span><span id="fit_ellipsoid-382"><a href="#fit_ellipsoid-382"><span class="linenos">382</span></a><span class="sd">    Parameters</span>
</span><span id="fit_ellipsoid-383"><a href="#fit_ellipsoid-383"><span class="linenos">383</span></a><span class="sd">    ----------</span>
</span><span id="fit_ellipsoid-384"><a href="#fit_ellipsoid-384"><span class="linenos">384</span></a><span class="sd">    indices : np.ndarray</span>
</span><span id="fit_ellipsoid-385"><a href="#fit_ellipsoid-385"><span class="linenos">385</span></a><span class="sd">        Array of [Z,Y,X] indices corresponding to the feature&#39;s voxel</span>
</span><span id="fit_ellipsoid-386"><a href="#fit_ellipsoid-386"><span class="linenos">386</span></a><span class="sd">        locations.</span>
</span><span id="fit_ellipsoid-387"><a href="#fit_ellipsoid-387"><span class="linenos">387</span></a><span class="sd">        The shape of the array should be (n, 3), where n is the number of</span>
</span><span id="fit_ellipsoid-388"><a href="#fit_ellipsoid-388"><span class="linenos">388</span></a><span class="sd">        voxels of the feature.</span>
</span><span id="fit_ellipsoid-389"><a href="#fit_ellipsoid-389"><span class="linenos">389</span></a><span class="sd">    centroid : Centroid</span>
</span><span id="fit_ellipsoid-390"><a href="#fit_ellipsoid-390"><span class="linenos">390</span></a><span class="sd">        Centroid location for X, Y, and Z axis, respectively, in spatial</span>
</span><span id="fit_ellipsoid-391"><a href="#fit_ellipsoid-391"><span class="linenos">391</span></a><span class="sd">        coordinates (e.g., microns).</span>
</span><span id="fit_ellipsoid-392"><a href="#fit_ellipsoid-392"><span class="linenos">392</span></a><span class="sd">    resolution : Resolution</span>
</span><span id="fit_ellipsoid-393"><a href="#fit_ellipsoid-393"><span class="linenos">393</span></a><span class="sd">        Voxel resolution for X, Y, and Z dimensions, respectively, in length</span>
</span><span id="fit_ellipsoid-394"><a href="#fit_ellipsoid-394"><span class="linenos">394</span></a><span class="sd">        units (e.g., microns).</span>
</span><span id="fit_ellipsoid-395"><a href="#fit_ellipsoid-395"><span class="linenos">395</span></a><span class="sd">    origin : Origin</span>
</span><span id="fit_ellipsoid-396"><a href="#fit_ellipsoid-396"><span class="linenos">396</span></a><span class="sd">        Optional origin in spatial coordinates if the volume has been</span>
</span><span id="fit_ellipsoid-397"><a href="#fit_ellipsoid-397"><span class="linenos">397</span></a><span class="sd">        previously transformed.</span>
</span><span id="fit_ellipsoid-398"><a href="#fit_ellipsoid-398"><span class="linenos">398</span></a>
</span><span id="fit_ellipsoid-399"><a href="#fit_ellipsoid-399"><span class="linenos">399</span></a><span class="sd">    Returns</span>
</span><span id="fit_ellipsoid-400"><a href="#fit_ellipsoid-400"><span class="linenos">400</span></a><span class="sd">    -------</span>
</span><span id="fit_ellipsoid-401"><a href="#fit_ellipsoid-401"><span class="linenos">401</span></a><span class="sd">    BestFitEllipsoid</span>
</span><span id="fit_ellipsoid-402"><a href="#fit_ellipsoid-402"><span class="linenos">402</span></a><span class="sd">        The best fit ellipsoid with semi-axes lengths and orientations.</span>
</span><span id="fit_ellipsoid-403"><a href="#fit_ellipsoid-403"><span class="linenos">403</span></a>
</span><span id="fit_ellipsoid-404"><a href="#fit_ellipsoid-404"><span class="linenos">404</span></a><span class="sd">    Examples</span>
</span><span id="fit_ellipsoid-405"><a href="#fit_ellipsoid-405"><span class="linenos">405</span></a><span class="sd">    --------</span>
</span><span id="fit_ellipsoid-406"><a href="#fit_ellipsoid-406"><span class="linenos">406</span></a><span class="sd">    &gt;&gt;&gt; indices = np.array([[0, 0, 0], [1, 1, 1], [2, 2, 2]], dtype=np.int32)</span>
</span><span id="fit_ellipsoid-407"><a href="#fit_ellipsoid-407"><span class="linenos">407</span></a><span class="sd">    &gt;&gt;&gt; centroid = Centroid(cx=Length(1.0, Units.MICRON), cy=Length(1.0, Units.MICRON), cz=Length(1.0, Units.MICRON))</span>
</span><span id="fit_ellipsoid-408"><a href="#fit_ellipsoid-408"><span class="linenos">408</span></a><span class="sd">    &gt;&gt;&gt; resolution = Resolution(dx=Length(1.0, Units.MICRON), dy=Length(1.0, Units.MICRON), dz=Length(1.0, Units.MICRON))</span>
</span><span id="fit_ellipsoid-409"><a href="#fit_ellipsoid-409"><span class="linenos">409</span></a><span class="sd">    &gt;&gt;&gt; origin = Origin(x0=Length(0.0, Units.MICRON), y0=Length(0.0, Units.MICRON), z0=Length(0.0, Units.MICRON))</span>
</span><span id="fit_ellipsoid-410"><a href="#fit_ellipsoid-410"><span class="linenos">410</span></a><span class="sd">    &gt;&gt;&gt; fit_ellipsoid(indices, centroid, resolution, origin)</span>
</span><span id="fit_ellipsoid-411"><a href="#fit_ellipsoid-411"><span class="linenos">411</span></a><span class="sd">    BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=80.146386085398, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=-0.25175905655605574, v=-0.5305735687527386, w=-0.8093880809494217)), b=EllipsoidAxis(length=Length(value=1.2477168951003976, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=-0.8774683531474325, v=-0.227651095921704, w=0.4221661613042665)), c=EllipsoidAxis(length=Length(value=2.380014006104306e-07, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.4082482904637247, v=-0.816496580927762, w=0.4082482904639296)))</span>
</span><span id="fit_ellipsoid-412"><a href="#fit_ellipsoid-412"><span class="linenos">412</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fit_ellipsoid-413"><a href="#fit_ellipsoid-413"><span class="linenos">413</span></a>
</span><span id="fit_ellipsoid-414"><a href="#fit_ellipsoid-414"><span class="linenos">414</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span> <span class="o">==</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dy</span> <span class="o">==</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dz</span><span class="p">:</span>
</span><span id="fit_ellipsoid-415"><a href="#fit_ellipsoid-415"><span class="linenos">415</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="fit_ellipsoid-416"><a href="#fit_ellipsoid-416"><span class="linenos">416</span></a>            <span class="s2">&quot;Only isotropic voxels are currently supported for axis length calculation&quot;</span>
</span><span id="fit_ellipsoid-417"><a href="#fit_ellipsoid-417"><span class="linenos">417</span></a>        <span class="p">)</span>
</span><span id="fit_ellipsoid-418"><a href="#fit_ellipsoid-418"><span class="linenos">418</span></a>
</span><span id="fit_ellipsoid-419"><a href="#fit_ellipsoid-419"><span class="linenos">419</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span>
</span><span id="fit_ellipsoid-420"><a href="#fit_ellipsoid-420"><span class="linenos">420</span></a>
</span><span id="fit_ellipsoid-421"><a href="#fit_ellipsoid-421"><span class="linenos">421</span></a>    <span class="c1"># convert centroids to normalized pixel units</span>
</span><span id="fit_ellipsoid-422"><a href="#fit_ellipsoid-422"><span class="linenos">422</span></a>    <span class="n">cen_px</span> <span class="o">=</span> <span class="n">centroid_pix</span><span class="p">(</span><span class="n">centroid</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
</span><span id="fit_ellipsoid-423"><a href="#fit_ellipsoid-423"><span class="linenos">423</span></a>
</span><span id="fit_ellipsoid-424"><a href="#fit_ellipsoid-424"><span class="linenos">424</span></a>    <span class="c1"># Get moments</span>
</span><span id="fit_ellipsoid-425"><a href="#fit_ellipsoid-425"><span class="linenos">425</span></a>    <span class="n">s_xx</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="fit_ellipsoid-426"><a href="#fit_ellipsoid-426"><span class="linenos">426</span></a>    <span class="n">s_yy</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="fit_ellipsoid-427"><a href="#fit_ellipsoid-427"><span class="linenos">427</span></a>    <span class="n">s_zz</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="fit_ellipsoid-428"><a href="#fit_ellipsoid-428"><span class="linenos">428</span></a>    <span class="n">s_xy</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="fit_ellipsoid-429"><a href="#fit_ellipsoid-429"><span class="linenos">429</span></a>    <span class="n">s_xz</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="fit_ellipsoid-430"><a href="#fit_ellipsoid-430"><span class="linenos">430</span></a>    <span class="n">s_yz</span> <span class="o">=</span> <span class="n">calc_moment</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cen_px</span><span class="p">)</span>
</span><span id="fit_ellipsoid-431"><a href="#fit_ellipsoid-431"><span class="linenos">431</span></a>
</span><span id="fit_ellipsoid-432"><a href="#fit_ellipsoid-432"><span class="linenos">432</span></a>    <span class="c1"># Create matrix of 3D moments</span>
</span><span id="fit_ellipsoid-433"><a href="#fit_ellipsoid-433"><span class="linenos">433</span></a>    <span class="n">s_ij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="fit_ellipsoid-434"><a href="#fit_ellipsoid-434"><span class="linenos">434</span></a>        <span class="p">[</span>
</span><span id="fit_ellipsoid-435"><a href="#fit_ellipsoid-435"><span class="linenos">435</span></a>            <span class="p">[</span><span class="n">s_xx</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">],</span>
</span><span id="fit_ellipsoid-436"><a href="#fit_ellipsoid-436"><span class="linenos">436</span></a>            <span class="p">[</span><span class="n">s_xy</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">],</span>
</span><span id="fit_ellipsoid-437"><a href="#fit_ellipsoid-437"><span class="linenos">437</span></a>            <span class="p">[</span><span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">],</span>
</span><span id="fit_ellipsoid-438"><a href="#fit_ellipsoid-438"><span class="linenos">438</span></a>        <span class="p">]</span>
</span><span id="fit_ellipsoid-439"><a href="#fit_ellipsoid-439"><span class="linenos">439</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-440"><a href="#fit_ellipsoid-440"><span class="linenos">440</span></a>    <span class="n">eig_val</span><span class="p">,</span> <span class="n">eig_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">s_ij</span><span class="p">)</span>
</span><span id="fit_ellipsoid-441"><a href="#fit_ellipsoid-441"><span class="linenos">441</span></a>
</span><span id="fit_ellipsoid-442"><a href="#fit_ellipsoid-442"><span class="linenos">442</span></a>    <span class="n">semi_ax_lengths_px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">eig_val</span><span class="p">)</span>  <span class="c1"># still in pixel units</span>
</span><span id="fit_ellipsoid-443"><a href="#fit_ellipsoid-443"><span class="linenos">443</span></a>    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">semi_ax_lengths_px</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># sort descending axis lengths</span>
</span><span id="fit_ellipsoid-444"><a href="#fit_ellipsoid-444"><span class="linenos">444</span></a>
</span><span id="fit_ellipsoid-445"><a href="#fit_ellipsoid-445"><span class="linenos">445</span></a>    <span class="c1"># TODO: math to account for change in length as function</span>
</span><span id="fit_ellipsoid-446"><a href="#fit_ellipsoid-446"><span class="linenos">446</span></a>    <span class="c1">#       as function of axis orientation in anisotropic voxels</span>
</span><span id="fit_ellipsoid-447"><a href="#fit_ellipsoid-447"><span class="linenos">447</span></a>    <span class="c1">#       remove NotImplementedError above</span>
</span><span id="fit_ellipsoid-448"><a href="#fit_ellipsoid-448"><span class="linenos">448</span></a>    <span class="n">semi_ax_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="fit_ellipsoid-449"><a href="#fit_ellipsoid-449"><span class="linenos">449</span></a>        <span class="p">[</span>
</span><span id="fit_ellipsoid-450"><a href="#fit_ellipsoid-450"><span class="linenos">450</span></a>            <span class="n">semi_ax_lengths_px</span><span class="p">[</span><span class="n">sort</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="fit_ellipsoid-451"><a href="#fit_ellipsoid-451"><span class="linenos">451</span></a>            <span class="n">semi_ax_lengths_px</span><span class="p">[</span><span class="n">sort</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="fit_ellipsoid-452"><a href="#fit_ellipsoid-452"><span class="linenos">452</span></a>            <span class="n">semi_ax_lengths_px</span><span class="p">[</span><span class="n">sort</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">*</span> <span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="fit_ellipsoid-453"><a href="#fit_ellipsoid-453"><span class="linenos">453</span></a>        <span class="p">]</span>
</span><span id="fit_ellipsoid-454"><a href="#fit_ellipsoid-454"><span class="linenos">454</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-455"><a href="#fit_ellipsoid-455"><span class="linenos">455</span></a>    <span class="c1"># some axes lengths are NAN, should overwrite to 0.0</span>
</span><span id="fit_ellipsoid-456"><a href="#fit_ellipsoid-456"><span class="linenos">456</span></a>    <span class="n">semi_ax_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">semi_ax_lengths</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="fit_ellipsoid-457"><a href="#fit_ellipsoid-457"><span class="linenos">457</span></a>
</span><span id="fit_ellipsoid-458"><a href="#fit_ellipsoid-458"><span class="linenos">458</span></a>    <span class="c1"># from docs on np.linalg.eig: The normalized (unit “length”) eigenvectors,</span>
</span><span id="fit_ellipsoid-459"><a href="#fit_ellipsoid-459"><span class="linenos">459</span></a>    <span class="c1"># such that the column eigenvectors[:,i] is the eigenvector corresponding to the eigenvalue eigenvalues[i].</span>
</span><span id="fit_ellipsoid-460"><a href="#fit_ellipsoid-460"><span class="linenos">460</span></a>    <span class="n">ax_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="fit_ellipsoid-461"><a href="#fit_ellipsoid-461"><span class="linenos">461</span></a>        <span class="p">[</span>
</span><span id="fit_ellipsoid-462"><a href="#fit_ellipsoid-462"><span class="linenos">462</span></a>            <span class="n">eig_vec</span><span class="p">[:,</span> <span class="n">sort</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="fit_ellipsoid-463"><a href="#fit_ellipsoid-463"><span class="linenos">463</span></a>            <span class="n">eig_vec</span><span class="p">[:,</span> <span class="n">sort</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="fit_ellipsoid-464"><a href="#fit_ellipsoid-464"><span class="linenos">464</span></a>            <span class="n">eig_vec</span><span class="p">[:,</span> <span class="n">sort</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
</span><span id="fit_ellipsoid-465"><a href="#fit_ellipsoid-465"><span class="linenos">465</span></a>        <span class="p">]</span>
</span><span id="fit_ellipsoid-466"><a href="#fit_ellipsoid-466"><span class="linenos">466</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-467"><a href="#fit_ellipsoid-467"><span class="linenos">467</span></a>    <span class="n">ax_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ax_vectors</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">))</span>
</span><span id="fit_ellipsoid-468"><a href="#fit_ellipsoid-468"><span class="linenos">468</span></a>
</span><span id="fit_ellipsoid-469"><a href="#fit_ellipsoid-469"><span class="linenos">469</span></a>    <span class="n">a_vector</span> <span class="o">=</span> <span class="n">UnitVector</span><span class="p">(</span>
</span><span id="fit_ellipsoid-470"><a href="#fit_ellipsoid-470"><span class="linenos">470</span></a>        <span class="n">u</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="fit_ellipsoid-471"><a href="#fit_ellipsoid-471"><span class="linenos">471</span></a>        <span class="n">v</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="fit_ellipsoid-472"><a href="#fit_ellipsoid-472"><span class="linenos">472</span></a>        <span class="n">w</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="fit_ellipsoid-473"><a href="#fit_ellipsoid-473"><span class="linenos">473</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-474"><a href="#fit_ellipsoid-474"><span class="linenos">474</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">EllipsoidAxis</span><span class="p">(</span>
</span><span id="fit_ellipsoid-475"><a href="#fit_ellipsoid-475"><span class="linenos">475</span></a>        <span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">semi_ax_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="fit_ellipsoid-476"><a href="#fit_ellipsoid-476"><span class="linenos">476</span></a>        <span class="n">orientation</span><span class="o">=</span><span class="n">a_vector</span><span class="p">,</span>
</span><span id="fit_ellipsoid-477"><a href="#fit_ellipsoid-477"><span class="linenos">477</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-478"><a href="#fit_ellipsoid-478"><span class="linenos">478</span></a>    <span class="n">b_vector</span> <span class="o">=</span> <span class="n">UnitVector</span><span class="p">(</span>
</span><span id="fit_ellipsoid-479"><a href="#fit_ellipsoid-479"><span class="linenos">479</span></a>        <span class="n">u</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="fit_ellipsoid-480"><a href="#fit_ellipsoid-480"><span class="linenos">480</span></a>        <span class="n">v</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
</span><span id="fit_ellipsoid-481"><a href="#fit_ellipsoid-481"><span class="linenos">481</span></a>        <span class="n">w</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
</span><span id="fit_ellipsoid-482"><a href="#fit_ellipsoid-482"><span class="linenos">482</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-483"><a href="#fit_ellipsoid-483"><span class="linenos">483</span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">EllipsoidAxis</span><span class="p">(</span>
</span><span id="fit_ellipsoid-484"><a href="#fit_ellipsoid-484"><span class="linenos">484</span></a>        <span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">semi_ax_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="fit_ellipsoid-485"><a href="#fit_ellipsoid-485"><span class="linenos">485</span></a>        <span class="n">orientation</span><span class="o">=</span><span class="n">b_vector</span><span class="p">,</span>
</span><span id="fit_ellipsoid-486"><a href="#fit_ellipsoid-486"><span class="linenos">486</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-487"><a href="#fit_ellipsoid-487"><span class="linenos">487</span></a>    <span class="n">c_vector</span> <span class="o">=</span> <span class="n">UnitVector</span><span class="p">(</span>
</span><span id="fit_ellipsoid-488"><a href="#fit_ellipsoid-488"><span class="linenos">488</span></a>        <span class="n">u</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
</span><span id="fit_ellipsoid-489"><a href="#fit_ellipsoid-489"><span class="linenos">489</span></a>        <span class="n">v</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
</span><span id="fit_ellipsoid-490"><a href="#fit_ellipsoid-490"><span class="linenos">490</span></a>        <span class="n">w</span><span class="o">=</span><span class="n">ax_vectors</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
</span><span id="fit_ellipsoid-491"><a href="#fit_ellipsoid-491"><span class="linenos">491</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-492"><a href="#fit_ellipsoid-492"><span class="linenos">492</span></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">EllipsoidAxis</span><span class="p">(</span>
</span><span id="fit_ellipsoid-493"><a href="#fit_ellipsoid-493"><span class="linenos">493</span></a>        <span class="n">length</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">semi_ax_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span>
</span><span id="fit_ellipsoid-494"><a href="#fit_ellipsoid-494"><span class="linenos">494</span></a>        <span class="n">orientation</span><span class="o">=</span><span class="n">c_vector</span><span class="p">,</span>
</span><span id="fit_ellipsoid-495"><a href="#fit_ellipsoid-495"><span class="linenos">495</span></a>    <span class="p">)</span>
</span><span id="fit_ellipsoid-496"><a href="#fit_ellipsoid-496"><span class="linenos">496</span></a>
</span><span id="fit_ellipsoid-497"><a href="#fit_ellipsoid-497"><span class="linenos">497</span></a>    <span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">BestFitEllipsoid</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
</span><span id="fit_ellipsoid-498"><a href="#fit_ellipsoid-498"><span class="linenos">498</span></a>    <span class="k">return</span> <span class="n">ellipsoid</span>
</span></pre></div>


            <div class="docstring"><p>Fit a 3D ellipsoid to a set of voxel indices.</p>

<h2 id="parameters">Parameters</h2>

<p>indices : np.ndarray
    Array of [Z,Y,X] indices corresponding to the feature's voxel
    locations.
    The shape of the array should be (n, 3), where n is the number of
    voxels of the feature.
centroid : Centroid
    Centroid location for X, Y, and Z axis, respectively, in spatial
    coordinates (e.g., microns).
resolution : Resolution
    Voxel resolution for X, Y, and Z dimensions, respectively, in length
    units (e.g., microns).
origin : Origin
    Optional origin in spatial coordinates if the volume has been
    previously transformed.</p>

<h2 id="returns">Returns</h2>

<p>BestFitEllipsoid
    The best fit ellipsoid with semi-axes lengths and orientations.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">centroid</span> <span class="o">=</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resolution</span> <span class="o">=</span> <span class="n">Resolution</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">origin</span> <span class="o">=</span> <span class="n">Origin</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fit_ellipsoid</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">centroid</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
<span class="go">BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=80.146386085398, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=-0.25175905655605574, v=-0.5305735687527386, w=-0.8093880809494217)), b=EllipsoidAxis(length=Length(value=1.2477168951003976, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=-0.8774683531474325, v=-0.227651095921704, w=0.4221661613042665)), c=EllipsoidAxis(length=Length(value=2.380014006104306e-07, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.4082482904637247, v=-0.816496580927762, w=0.4082482904639296)))</span>
</code></pre>
</div>
</div>


                </section>
                <section id="instance_indices">
                            <input id="instance_indices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">instance_indices</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">instance_stack</span><span class="p">:</span> <span class="n"><a href="types.html#InstanceImageStack">recon3d.types.InstanceImageStack</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#InstanceIndices">recon3d.types.InstanceIndices</a></span>:</span></span>

                <label class="view-source-button" for="instance_indices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#instance_indices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="instance_indices-501"><a href="#instance_indices-501"><span class="linenos">501</span></a><span class="k">def</span><span class="w"> </span><span class="nf">instance_indices</span><span class="p">(</span>
</span><span id="instance_indices-502"><a href="#instance_indices-502"><span class="linenos">502</span></a>    <span class="n">instance_stack</span><span class="p">:</span> <span class="n">InstanceImageStack</span><span class="p">,</span>
</span><span id="instance_indices-503"><a href="#instance_indices-503"><span class="linenos">503</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InstanceIndices</span><span class="p">:</span>
</span><span id="instance_indices-504"><a href="#instance_indices-504"><span class="linenos">504</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="instance_indices-505"><a href="#instance_indices-505"><span class="linenos">505</span></a><span class="sd">    Returns an array of instances and a list of N-dimensional arrays of indices</span>
</span><span id="instance_indices-506"><a href="#instance_indices-506"><span class="linenos">506</span></a><span class="sd">    of the unique values in the instance stack.</span>
</span><span id="instance_indices-507"><a href="#instance_indices-507"><span class="linenos">507</span></a>
</span><span id="instance_indices-508"><a href="#instance_indices-508"><span class="linenos">508</span></a><span class="sd">    Parameters</span>
</span><span id="instance_indices-509"><a href="#instance_indices-509"><span class="linenos">509</span></a><span class="sd">    ----------</span>
</span><span id="instance_indices-510"><a href="#instance_indices-510"><span class="linenos">510</span></a><span class="sd">    instance_stack : InstanceImageStack</span>
</span><span id="instance_indices-511"><a href="#instance_indices-511"><span class="linenos">511</span></a><span class="sd">        Array with arbitrary dimensions.</span>
</span><span id="instance_indices-512"><a href="#instance_indices-512"><span class="linenos">512</span></a>
</span><span id="instance_indices-513"><a href="#instance_indices-513"><span class="linenos">513</span></a><span class="sd">    Returns</span>
</span><span id="instance_indices-514"><a href="#instance_indices-514"><span class="linenos">514</span></a><span class="sd">    -------</span>
</span><span id="instance_indices-515"><a href="#instance_indices-515"><span class="linenos">515</span></a><span class="sd">    InstanceIndices</span>
</span><span id="instance_indices-516"><a href="#instance_indices-516"><span class="linenos">516</span></a><span class="sd">        - 1D-array of sorted unique values.</span>
</span><span id="instance_indices-517"><a href="#instance_indices-517"><span class="linenos">517</span></a><span class="sd">        - List of arrays. Each array contains the indices where a given value in x is found.</span>
</span><span id="instance_indices-518"><a href="#instance_indices-518"><span class="linenos">518</span></a>
</span><span id="instance_indices-519"><a href="#instance_indices-519"><span class="linenos">519</span></a><span class="sd">    Examples</span>
</span><span id="instance_indices-520"><a href="#instance_indices-520"><span class="linenos">520</span></a><span class="sd">    --------</span>
</span><span id="instance_indices-521"><a href="#instance_indices-521"><span class="linenos">521</span></a><span class="sd">    &gt;&gt;&gt; instance_stack = InstanceImageStack(</span>
</span><span id="instance_indices-522"><a href="#instance_indices-522"><span class="linenos">522</span></a><span class="sd">    ...     name=&quot;example_stack&quot;,</span>
</span><span id="instance_indices-523"><a href="#instance_indices-523"><span class="linenos">523</span></a><span class="sd">    ...     metadata=MetaData(</span>
</span><span id="instance_indices-524"><a href="#instance_indices-524"><span class="linenos">524</span></a><span class="sd">    ...         data_volume=DataVolume(x_width=2, y_height=2, z_image_count=1),</span>
</span><span id="instance_indices-525"><a href="#instance_indices-525"><span class="linenos">525</span></a><span class="sd">    ...         resolution=Resolution(</span>
</span><span id="instance_indices-526"><a href="#instance_indices-526"><span class="linenos">526</span></a><span class="sd">    ...             dx=Length(1.0, Units.MICRON),</span>
</span><span id="instance_indices-527"><a href="#instance_indices-527"><span class="linenos">527</span></a><span class="sd">    ...             dy=Length(1.0, Units.MICRON),</span>
</span><span id="instance_indices-528"><a href="#instance_indices-528"><span class="linenos">528</span></a><span class="sd">    ...             dz=Length(1.0, Units.MICRON)</span>
</span><span id="instance_indices-529"><a href="#instance_indices-529"><span class="linenos">529</span></a><span class="sd">    ...         ),</span>
</span><span id="instance_indices-530"><a href="#instance_indices-530"><span class="linenos">530</span></a><span class="sd">    ...         pixel_units=Units.MICRON,</span>
</span><span id="instance_indices-531"><a href="#instance_indices-531"><span class="linenos">531</span></a><span class="sd">    ...         origin=Origin(</span>
</span><span id="instance_indices-532"><a href="#instance_indices-532"><span class="linenos">532</span></a><span class="sd">    ...             x0=Length(0.0, Units.MICRON),</span>
</span><span id="instance_indices-533"><a href="#instance_indices-533"><span class="linenos">533</span></a><span class="sd">    ...             y0=Length(0.0, Units.MICRON),</span>
</span><span id="instance_indices-534"><a href="#instance_indices-534"><span class="linenos">534</span></a><span class="sd">    ...             z0=Length(0.0, Units.MICRON)</span>
</span><span id="instance_indices-535"><a href="#instance_indices-535"><span class="linenos">535</span></a><span class="sd">    ...         )</span>
</span><span id="instance_indices-536"><a href="#instance_indices-536"><span class="linenos">536</span></a><span class="sd">    ...     ),</span>
</span><span id="instance_indices-537"><a href="#instance_indices-537"><span class="linenos">537</span></a><span class="sd">    ...     data=np.array([[1, 2, 2], [3, 1, 1]]),</span>
</span><span id="instance_indices-538"><a href="#instance_indices-538"><span class="linenos">538</span></a><span class="sd">    ...     nlabels=3,</span>
</span><span id="instance_indices-539"><a href="#instance_indices-539"><span class="linenos">539</span></a><span class="sd">    ...     min_feature_size=1</span>
</span><span id="instance_indices-540"><a href="#instance_indices-540"><span class="linenos">540</span></a><span class="sd">    ... )</span>
</span><span id="instance_indices-541"><a href="#instance_indices-541"><span class="linenos">541</span></a><span class="sd">    &gt;&gt;&gt; instance_indices(instance_stack)</span>
</span><span id="instance_indices-542"><a href="#instance_indices-542"><span class="linenos">542</span></a><span class="sd">    InstanceIndices(</span>
</span><span id="instance_indices-543"><a href="#instance_indices-543"><span class="linenos">543</span></a><span class="sd">        source_name=&#39;example_stack&#39;,</span>
</span><span id="instance_indices-544"><a href="#instance_indices-544"><span class="linenos">544</span></a><span class="sd">        indices=[array([[0, 0], [1, 1], [1, 2]]), array([[0, 1], [0, 2]]), array([[1, 0]])],</span>
</span><span id="instance_indices-545"><a href="#instance_indices-545"><span class="linenos">545</span></a><span class="sd">        labels=InstanceLabels(data=np.array([1, 2, 3]))</span>
</span><span id="instance_indices-546"><a href="#instance_indices-546"><span class="linenos">546</span></a><span class="sd">    )</span>
</span><span id="instance_indices-547"><a href="#instance_indices-547"><span class="linenos">547</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="instance_indices-548"><a href="#instance_indices-548"><span class="linenos">548</span></a>
</span><span id="instance_indices-549"><a href="#instance_indices-549"><span class="linenos">549</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">data</span>
</span><span id="instance_indices-550"><a href="#instance_indices-550"><span class="linenos">550</span></a>    <span class="n">x_flat</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="instance_indices-551"><a href="#instance_indices-551"><span class="linenos">551</span></a>    <span class="n">ix_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x_flat</span><span class="p">)</span>
</span><span id="instance_indices-552"><a href="#instance_indices-552"><span class="linenos">552</span></a>    <span class="n">u</span><span class="p">,</span> <span class="n">ix_u</span> <span class="o">=</span> <span class="n">fastremap</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x_flat</span><span class="p">[</span><span class="n">ix_flat</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="instance_indices-553"><a href="#instance_indices-553"><span class="linenos">553</span></a>    <span class="n">ix_ndim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">ix_flat</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="instance_indices-554"><a href="#instance_indices-554"><span class="linenos">554</span></a>    <span class="n">ix_ndim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">ix_ndim</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">ix_flat</span>
</span><span id="instance_indices-555"><a href="#instance_indices-555"><span class="linenos">555</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ix_ndim</span><span class="p">,</span> <span class="n">ix_u</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="instance_indices-556"><a href="#instance_indices-556"><span class="linenos">556</span></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="instance_indices-557"><a href="#instance_indices-557"><span class="linenos">557</span></a>    <span class="n">instance_ids</span> <span class="o">=</span> <span class="n">InstanceIndices</span><span class="p">(</span>
</span><span id="instance_indices-558"><a href="#instance_indices-558"><span class="linenos">558</span></a>        <span class="n">source_name</span><span class="o">=</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="instance_indices-559"><a href="#instance_indices-559"><span class="linenos">559</span></a>        <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
</span><span id="instance_indices-560"><a href="#instance_indices-560"><span class="linenos">560</span></a>        <span class="n">labels</span><span class="o">=</span><span class="n">InstanceLabels</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">labels</span><span class="p">),</span>
</span><span id="instance_indices-561"><a href="#instance_indices-561"><span class="linenos">561</span></a>    <span class="p">)</span>
</span><span id="instance_indices-562"><a href="#instance_indices-562"><span class="linenos">562</span></a>    <span class="k">return</span> <span class="n">instance_ids</span>
</span></pre></div>


            <div class="docstring"><p>Returns an array of instances and a list of N-dimensional arrays of indices
of the unique values in the instance stack.</p>

<h2 id="parameters">Parameters</h2>

<p>instance_stack : InstanceImageStack
    Array with arbitrary dimensions.</p>

<h2 id="returns">Returns</h2>

<p>InstanceIndices
    - 1D-array of sorted unique values.
    - List of arrays. Each array contains the indices where a given value in x is found.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">instance_stack</span> <span class="o">=</span> <span class="n">InstanceImageStack</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_stack&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">metadata</span><span class="o">=</span><span class="n">MetaData</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">data_volume</span><span class="o">=</span><span class="n">DataVolume</span><span class="p">(</span><span class="n">x_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y_height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z_image_count</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">resolution</span><span class="o">=</span><span class="n">Resolution</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">pixel_units</span><span class="o">=</span><span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">origin</span><span class="o">=</span><span class="n">Origin</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
<span class="gp">... </span>    <span class="n">nlabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">min_feature_size</span><span class="o">=</span><span class="mi">1</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance_indices</span><span class="p">(</span><span class="n">instance_stack</span><span class="p">)</span>
<span class="go">InstanceIndices(</span>
<span class="go">    source_name=&#39;example_stack&#39;,</span>
<span class="go">    indices=[array([[0, 0], [1, 1], [1, 2]]), array([[0, 1], [0, 2]]), array([[1, 0]])],</span>
<span class="go">    labels=InstanceLabels(data=np.array([1, 2, 3]))</span>
<span class="go">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="minimum_size_filter">
                            <input id="minimum_size_filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">minimum_size_filter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">initial_stack</span><span class="p">:</span> <span class="n"><a href="types.html#InstanceImageStack">recon3d.types.InstanceImageStack</a></span>,</span><span class="param">	<span class="n">initial_indices</span><span class="p">:</span> <span class="n"><a href="types.html#InstanceIndices">recon3d.types.InstanceIndices</a></span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n"><a href="types.html#InstanceImageStack">recon3d.types.InstanceImageStack</a></span><span class="p">,</span> <span class="n"><a href="types.html#InstanceIndices">recon3d.types.InstanceIndices</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="minimum_size_filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#minimum_size_filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="minimum_size_filter-565"><a href="#minimum_size_filter-565"><span class="linenos">565</span></a><span class="k">def</span><span class="w"> </span><span class="nf">minimum_size_filter</span><span class="p">(</span>
</span><span id="minimum_size_filter-566"><a href="#minimum_size_filter-566"><span class="linenos">566</span></a>    <span class="n">initial_stack</span><span class="p">:</span> <span class="n">InstanceImageStack</span><span class="p">,</span>
</span><span id="minimum_size_filter-567"><a href="#minimum_size_filter-567"><span class="linenos">567</span></a>    <span class="n">initial_indices</span><span class="p">:</span> <span class="n">InstanceIndices</span><span class="p">,</span>
</span><span id="minimum_size_filter-568"><a href="#minimum_size_filter-568"><span class="linenos">568</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">InstanceImageStack</span><span class="p">,</span> <span class="n">InstanceIndices</span><span class="p">]:</span>
</span><span id="minimum_size_filter-569"><a href="#minimum_size_filter-569"><span class="linenos">569</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="minimum_size_filter-570"><a href="#minimum_size_filter-570"><span class="linenos">570</span></a><span class="sd">    Removes features below minimum size from InstanceIndices and corresponding</span>
</span><span id="minimum_size_filter-571"><a href="#minimum_size_filter-571"><span class="linenos">571</span></a><span class="sd">    InstanceImageStack. Should be done before shape metrics are determined.</span>
</span><span id="minimum_size_filter-572"><a href="#minimum_size_filter-572"><span class="linenos">572</span></a>
</span><span id="minimum_size_filter-573"><a href="#minimum_size_filter-573"><span class="linenos">573</span></a><span class="sd">    Parameters</span>
</span><span id="minimum_size_filter-574"><a href="#minimum_size_filter-574"><span class="linenos">574</span></a><span class="sd">    ----------</span>
</span><span id="minimum_size_filter-575"><a href="#minimum_size_filter-575"><span class="linenos">575</span></a><span class="sd">    initial_stack : InstanceImageStack</span>
</span><span id="minimum_size_filter-576"><a href="#minimum_size_filter-576"><span class="linenos">576</span></a><span class="sd">        The initial instance image stack.</span>
</span><span id="minimum_size_filter-577"><a href="#minimum_size_filter-577"><span class="linenos">577</span></a><span class="sd">    initial_indices : InstanceIndices</span>
</span><span id="minimum_size_filter-578"><a href="#minimum_size_filter-578"><span class="linenos">578</span></a><span class="sd">        The initial instance indices.</span>
</span><span id="minimum_size_filter-579"><a href="#minimum_size_filter-579"><span class="linenos">579</span></a>
</span><span id="minimum_size_filter-580"><a href="#minimum_size_filter-580"><span class="linenos">580</span></a><span class="sd">    Returns</span>
</span><span id="minimum_size_filter-581"><a href="#minimum_size_filter-581"><span class="linenos">581</span></a><span class="sd">    -------</span>
</span><span id="minimum_size_filter-582"><a href="#minimum_size_filter-582"><span class="linenos">582</span></a><span class="sd">    Tuple[InstanceImageStack, InstanceIndices]</span>
</span><span id="minimum_size_filter-583"><a href="#minimum_size_filter-583"><span class="linenos">583</span></a><span class="sd">        The filtered instance image stack and the filtered instance indices.</span>
</span><span id="minimum_size_filter-584"><a href="#minimum_size_filter-584"><span class="linenos">584</span></a>
</span><span id="minimum_size_filter-585"><a href="#minimum_size_filter-585"><span class="linenos">585</span></a><span class="sd">    Raises</span>
</span><span id="minimum_size_filter-586"><a href="#minimum_size_filter-586"><span class="linenos">586</span></a><span class="sd">    ------</span>
</span><span id="minimum_size_filter-587"><a href="#minimum_size_filter-587"><span class="linenos">587</span></a><span class="sd">    ValueError</span>
</span><span id="minimum_size_filter-588"><a href="#minimum_size_filter-588"><span class="linenos">588</span></a><span class="sd">        If the names of the initial stack and indices do not match.</span>
</span><span id="minimum_size_filter-589"><a href="#minimum_size_filter-589"><span class="linenos">589</span></a>
</span><span id="minimum_size_filter-590"><a href="#minimum_size_filter-590"><span class="linenos">590</span></a><span class="sd">    Examples</span>
</span><span id="minimum_size_filter-591"><a href="#minimum_size_filter-591"><span class="linenos">591</span></a><span class="sd">    --------</span>
</span><span id="minimum_size_filter-592"><a href="#minimum_size_filter-592"><span class="linenos">592</span></a><span class="sd">    &gt;&gt;&gt; initial_stack = InstanceImageStack(</span>
</span><span id="minimum_size_filter-593"><a href="#minimum_size_filter-593"><span class="linenos">593</span></a><span class="sd">    ...     name=&quot;example_stack&quot;,</span>
</span><span id="minimum_size_filter-594"><a href="#minimum_size_filter-594"><span class="linenos">594</span></a><span class="sd">    ...     metadata=MetaData(</span>
</span><span id="minimum_size_filter-595"><a href="#minimum_size_filter-595"><span class="linenos">595</span></a><span class="sd">    ...         data_volume=DataVolume(x_width=4, y_height=2, z_image_count=1),</span>
</span><span id="minimum_size_filter-596"><a href="#minimum_size_filter-596"><span class="linenos">596</span></a><span class="sd">    ...         resolution=Resolution(</span>
</span><span id="minimum_size_filter-597"><a href="#minimum_size_filter-597"><span class="linenos">597</span></a><span class="sd">    ...             dx=Length(1.0, Units.MICRON),</span>
</span><span id="minimum_size_filter-598"><a href="#minimum_size_filter-598"><span class="linenos">598</span></a><span class="sd">    ...             dy=Length(1.0, Units.MICRON),</span>
</span><span id="minimum_size_filter-599"><a href="#minimum_size_filter-599"><span class="linenos">599</span></a><span class="sd">    ...             dz=Length(1.0, Units.MICRON)</span>
</span><span id="minimum_size_filter-600"><a href="#minimum_size_filter-600"><span class="linenos">600</span></a><span class="sd">    ...         ),</span>
</span><span id="minimum_size_filter-601"><a href="#minimum_size_filter-601"><span class="linenos">601</span></a><span class="sd">    ...         pixel_units=Units.MICRON,</span>
</span><span id="minimum_size_filter-602"><a href="#minimum_size_filter-602"><span class="linenos">602</span></a><span class="sd">    ...         origin=Origin(</span>
</span><span id="minimum_size_filter-603"><a href="#minimum_size_filter-603"><span class="linenos">603</span></a><span class="sd">    ...             x0=Length(0.0, Units.MICRON),</span>
</span><span id="minimum_size_filter-604"><a href="#minimum_size_filter-604"><span class="linenos">604</span></a><span class="sd">    ...             y0=Length(0.0, Units.MICRON),</span>
</span><span id="minimum_size_filter-605"><a href="#minimum_size_filter-605"><span class="linenos">605</span></a><span class="sd">    ...             z0=Length(0.0, Units.MICRON)</span>
</span><span id="minimum_size_filter-606"><a href="#minimum_size_filter-606"><span class="linenos">606</span></a><span class="sd">    ...         )</span>
</span><span id="minimum_size_filter-607"><a href="#minimum_size_filter-607"><span class="linenos">607</span></a><span class="sd">    ...     ),</span>
</span><span id="minimum_size_filter-608"><a href="#minimum_size_filter-608"><span class="linenos">608</span></a><span class="sd">    ...     data=np.array([[1, 2, 2, 1], [3, 1, 1, 1]]),</span>
</span><span id="minimum_size_filter-609"><a href="#minimum_size_filter-609"><span class="linenos">609</span></a><span class="sd">    ...     nlabels=3,</span>
</span><span id="minimum_size_filter-610"><a href="#minimum_size_filter-610"><span class="linenos">610</span></a><span class="sd">    ...     min_feature_size=2</span>
</span><span id="minimum_size_filter-611"><a href="#minimum_size_filter-611"><span class="linenos">611</span></a><span class="sd">    ... )</span>
</span><span id="minimum_size_filter-612"><a href="#minimum_size_filter-612"><span class="linenos">612</span></a><span class="sd">    &gt;&gt;&gt; initial_indices = instance_indices(initial_stack)</span>
</span><span id="minimum_size_filter-613"><a href="#minimum_size_filter-613"><span class="linenos">613</span></a><span class="sd">    &gt;&gt;&gt; minimum_size_filter(initial_stack, initial_indices)</span>
</span><span id="minimum_size_filter-614"><a href="#minimum_size_filter-614"><span class="linenos">614</span></a><span class="sd">    2 connected components remaining after minimum size filter of 2 voxels</span>
</span><span id="minimum_size_filter-615"><a href="#minimum_size_filter-615"><span class="linenos">615</span></a><span class="sd">    (InstanceImageStack(name=&#39;example_stack&#39;, metadata=MetaData(data_volume=DataVolume(x_width=4, y_height=2, z_image_count=1), resolution=Resolution(dx=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dy=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dz=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), pixel_units=&lt;Units.MICRON: &#39;micron&#39;&gt;, origin=Origin(x0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), y0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), z0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))), data=array([[1, 0, 0, 1],[2, 1, 1, 1]], dtype=int8), nlabels=2, min_feature_size=2), InstanceIndices(source_name=&#39;example_stack&#39;, labels=InstanceLabels(data=array([0, 1, 2], dtype=int8)), indices=[array([[0, 1],[0, 2]]), array([[0, 0],[0, 3],[1, 1],[1, 2],[1, 3]]), array([[1, 0]])]))</span>
</span><span id="minimum_size_filter-616"><a href="#minimum_size_filter-616"><span class="linenos">616</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="minimum_size_filter-617"><a href="#minimum_size_filter-617"><span class="linenos">617</span></a>
</span><span id="minimum_size_filter-618"><a href="#minimum_size_filter-618"><span class="linenos">618</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">initial_stack</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">initial_indices</span><span class="o">.</span><span class="n">source_name</span><span class="p">:</span>
</span><span id="minimum_size_filter-619"><a href="#minimum_size_filter-619"><span class="linenos">619</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="minimum_size_filter-620"><a href="#minimum_size_filter-620"><span class="linenos">620</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Initial InstanceImageStack name (</span><span class="si">{</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">) and</span>
</span><span id="minimum_size_filter-621"><a href="#minimum_size_filter-621"><span class="linenos">621</span></a><span class="s2">            InstanceIndices name (</span><span class="si">{</span><span class="n">initial_indices</span><span class="o">.</span><span class="n">source_name</span><span class="si">}</span><span class="s2">) do not match.</span>
</span><span id="minimum_size_filter-622"><a href="#minimum_size_filter-622"><span class="linenos">622</span></a><span class="s2">            Function inputs must be from same dataset.&quot;&quot;&quot;</span>
</span><span id="minimum_size_filter-623"><a href="#minimum_size_filter-623"><span class="linenos">623</span></a>        <span class="p">)</span>
</span><span id="minimum_size_filter-624"><a href="#minimum_size_filter-624"><span class="linenos">624</span></a>
</span><span id="minimum_size_filter-625"><a href="#minimum_size_filter-625"><span class="linenos">625</span></a>    <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">num_voxels</span><span class="p">(</span><span class="n">initial_indices</span><span class="p">)</span>
</span><span id="minimum_size_filter-626"><a href="#minimum_size_filter-626"><span class="linenos">626</span></a>    <span class="n">n_voxels_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n_voxels</span><span class="p">])</span>
</span><span id="minimum_size_filter-627"><a href="#minimum_size_filter-627"><span class="linenos">627</span></a>    <span class="n">invalid_instance_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">n_voxels_vals</span> <span class="o">&lt;</span> <span class="n">initial_stack</span><span class="o">.</span><span class="n">min_feature_size</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="minimum_size_filter-628"><a href="#minimum_size_filter-628"><span class="linenos">628</span></a>    <span class="n">masked_instance_ids</span> <span class="o">=</span> <span class="n">fastremap</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">invalid_instance_ids</span><span class="p">)</span>
</span><span id="minimum_size_filter-629"><a href="#minimum_size_filter-629"><span class="linenos">629</span></a>    <span class="n">remapped_instance_ids</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fastremap</span><span class="o">.</span><span class="n">renumber</span><span class="p">(</span>
</span><span id="minimum_size_filter-630"><a href="#minimum_size_filter-630"><span class="linenos">630</span></a>        <span class="n">masked_instance_ids</span><span class="p">,</span>
</span><span id="minimum_size_filter-631"><a href="#minimum_size_filter-631"><span class="linenos">631</span></a>        <span class="n">preserve_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="minimum_size_filter-632"><a href="#minimum_size_filter-632"><span class="linenos">632</span></a>    <span class="p">)</span>
</span><span id="minimum_size_filter-633"><a href="#minimum_size_filter-633"><span class="linenos">633</span></a>    <span class="n">nlabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">remapped_instance_ids</span><span class="p">))</span>
</span><span id="minimum_size_filter-634"><a href="#minimum_size_filter-634"><span class="linenos">634</span></a>
</span><span id="minimum_size_filter-635"><a href="#minimum_size_filter-635"><span class="linenos">635</span></a>    <span class="n">filtered_stack</span> <span class="o">=</span> <span class="n">InstanceImageStack</span><span class="p">(</span>
</span><span id="minimum_size_filter-636"><a href="#minimum_size_filter-636"><span class="linenos">636</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="minimum_size_filter-637"><a href="#minimum_size_filter-637"><span class="linenos">637</span></a>        <span class="n">metadata</span><span class="o">=</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
</span><span id="minimum_size_filter-638"><a href="#minimum_size_filter-638"><span class="linenos">638</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">remapped_instance_ids</span><span class="p">,</span>
</span><span id="minimum_size_filter-639"><a href="#minimum_size_filter-639"><span class="linenos">639</span></a>        <span class="n">nlabels</span><span class="o">=</span><span class="n">nlabels</span><span class="p">,</span>
</span><span id="minimum_size_filter-640"><a href="#minimum_size_filter-640"><span class="linenos">640</span></a>        <span class="n">min_feature_size</span><span class="o">=</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">min_feature_size</span><span class="p">,</span>
</span><span id="minimum_size_filter-641"><a href="#minimum_size_filter-641"><span class="linenos">641</span></a>    <span class="p">)</span>
</span><span id="minimum_size_filter-642"><a href="#minimum_size_filter-642"><span class="linenos">642</span></a>
</span><span id="minimum_size_filter-643"><a href="#minimum_size_filter-643"><span class="linenos">643</span></a>    <span class="n">filtered_indices</span> <span class="o">=</span> <span class="n">instance_indices</span><span class="p">(</span><span class="n">instance_stack</span><span class="o">=</span><span class="n">filtered_stack</span><span class="p">)</span>
</span><span id="minimum_size_filter-644"><a href="#minimum_size_filter-644"><span class="linenos">644</span></a>
</span><span id="minimum_size_filter-645"><a href="#minimum_size_filter-645"><span class="linenos">645</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="minimum_size_filter-646"><a href="#minimum_size_filter-646"><span class="linenos">646</span></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="si">{</span><span class="n">nlabels</span><span class="si">}</span><span class="s2"> connected components remaining after minimum size filter of </span><span class="si">{</span><span class="n">initial_stack</span><span class="o">.</span><span class="n">min_feature_size</span><span class="si">}</span><span class="s2"> voxels&quot;</span>
</span><span id="minimum_size_filter-647"><a href="#minimum_size_filter-647"><span class="linenos">647</span></a>    <span class="p">)</span>
</span><span id="minimum_size_filter-648"><a href="#minimum_size_filter-648"><span class="linenos">648</span></a>    <span class="k">return</span> <span class="n">filtered_stack</span><span class="p">,</span> <span class="n">filtered_indices</span>
</span></pre></div>


            <div class="docstring"><p>Removes features below minimum size from InstanceIndices and corresponding
InstanceImageStack. Should be done before shape metrics are determined.</p>

<h2 id="parameters">Parameters</h2>

<p>initial_stack : InstanceImageStack
    The initial instance image stack.
initial_indices : InstanceIndices
    The initial instance indices.</p>

<h2 id="returns">Returns</h2>

<p>Tuple[InstanceImageStack, InstanceIndices]
    The filtered instance image stack and the filtered instance indices.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the names of the initial stack and indices do not match.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">initial_stack</span> <span class="o">=</span> <span class="n">InstanceImageStack</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_stack&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">metadata</span><span class="o">=</span><span class="n">MetaData</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">data_volume</span><span class="o">=</span><span class="n">DataVolume</span><span class="p">(</span><span class="n">x_width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">y_height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z_image_count</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">resolution</span><span class="o">=</span><span class="n">Resolution</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">pixel_units</span><span class="o">=</span><span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">origin</span><span class="o">=</span><span class="n">Origin</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
<span class="gp">... </span>    <span class="n">nlabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">min_feature_size</span><span class="o">=</span><span class="mi">2</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">initial_indices</span> <span class="o">=</span> <span class="n">instance_indices</span><span class="p">(</span><span class="n">initial_stack</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">minimum_size_filter</span><span class="p">(</span><span class="n">initial_stack</span><span class="p">,</span> <span class="n">initial_indices</span><span class="p">)</span>
<span class="go">2 connected components remaining after minimum size filter of 2 voxels</span>
<span class="go">(InstanceImageStack(name=&#39;example_stack&#39;, metadata=MetaData(data_volume=DataVolume(x_width=4, y_height=2, z_image_count=1), resolution=Resolution(dx=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dy=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dz=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), pixel_units=&lt;Units.MICRON: &#39;micron&#39;&gt;, origin=Origin(x0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), y0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), z0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))), data=array([[1, 0, 0, 1],[2, 1, 1, 1]], dtype=int8), nlabels=2, min_feature_size=2), InstanceIndices(source_name=&#39;example_stack&#39;, labels=InstanceLabels(data=array([0, 1, 2], dtype=int8)), indices=[array([[0, 1],[0, 2]]), array([[0, 0],[0, 3],[1, 1],[1, 2],[1, 3]]), array([[1, 0]])]))</span>
</code></pre>
</div>
</div>


                </section>
                <section id="map_features_to_voxels">
                            <input id="map_features_to_voxels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map_features_to_voxels</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="map_features_to_voxels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#map_features_to_voxels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="map_features_to_voxels-652"><a href="#map_features_to_voxels-652"><span class="linenos">652</span></a><span class="k">def</span><span class="w"> </span><span class="nf">map_features_to_voxels</span><span class="p">():</span>
</span><span id="map_features_to_voxels-653"><a href="#map_features_to_voxels-653"><span class="linenos">653</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;To come.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>To come.</p>
</div>


                </section>
                <section id="nearest_neighbor_distance">
                            <input id="nearest_neighbor_distance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nearest_neighbor_distance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">centroids</span><span class="p">:</span> <span class="n"><a href="types.html#Centroids">recon3d.types.Centroids</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#NthNearestNeighbors">recon3d.types.NthNearestNeighbors</a></span>:</span></span>

                <label class="view-source-button" for="nearest_neighbor_distance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#nearest_neighbor_distance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="nearest_neighbor_distance-656"><a href="#nearest_neighbor_distance-656"><span class="linenos">656</span></a><span class="k">def</span><span class="w"> </span><span class="nf">nearest_neighbor_distance</span><span class="p">(</span>
</span><span id="nearest_neighbor_distance-657"><a href="#nearest_neighbor_distance-657"><span class="linenos">657</span></a>    <span class="n">centroids</span><span class="p">:</span> <span class="n">Centroids</span><span class="p">,</span>
</span><span id="nearest_neighbor_distance-658"><a href="#nearest_neighbor_distance-658"><span class="linenos">658</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NthNearestNeighbors</span><span class="p">:</span>
</span><span id="nearest_neighbor_distance-659"><a href="#nearest_neighbor_distance-659"><span class="linenos">659</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="nearest_neighbor_distance-660"><a href="#nearest_neighbor_distance-660"><span class="linenos">660</span></a><span class="sd">    Calculate the nearest neighbor distance for a set of centroids.</span>
</span><span id="nearest_neighbor_distance-661"><a href="#nearest_neighbor_distance-661"><span class="linenos">661</span></a><span class="sd">    With nth_nearest_neighbor=1 returning the features themselves</span>
</span><span id="nearest_neighbor_distance-662"><a href="#nearest_neighbor_distance-662"><span class="linenos">662</span></a><span class="sd">    (distances=0, neighbor is themselves).</span>
</span><span id="nearest_neighbor_distance-663"><a href="#nearest_neighbor_distance-663"><span class="linenos">663</span></a>
</span><span id="nearest_neighbor_distance-664"><a href="#nearest_neighbor_distance-664"><span class="linenos">664</span></a><span class="sd">    Parameters</span>
</span><span id="nearest_neighbor_distance-665"><a href="#nearest_neighbor_distance-665"><span class="linenos">665</span></a><span class="sd">    ----------</span>
</span><span id="nearest_neighbor_distance-666"><a href="#nearest_neighbor_distance-666"><span class="linenos">666</span></a><span class="sd">    centroids : Centroids</span>
</span><span id="nearest_neighbor_distance-667"><a href="#nearest_neighbor_distance-667"><span class="linenos">667</span></a><span class="sd">        The centroids for which to calculate the nearest neighbor distance.</span>
</span><span id="nearest_neighbor_distance-668"><a href="#nearest_neighbor_distance-668"><span class="linenos">668</span></a>
</span><span id="nearest_neighbor_distance-669"><a href="#nearest_neighbor_distance-669"><span class="linenos">669</span></a><span class="sd">    Returns</span>
</span><span id="nearest_neighbor_distance-670"><a href="#nearest_neighbor_distance-670"><span class="linenos">670</span></a><span class="sd">    -------</span>
</span><span id="nearest_neighbor_distance-671"><a href="#nearest_neighbor_distance-671"><span class="linenos">671</span></a><span class="sd">    NthNearestNeighbors</span>
</span><span id="nearest_neighbor_distance-672"><a href="#nearest_neighbor_distance-672"><span class="linenos">672</span></a><span class="sd">        The nth nearest neighbors, distances, and instance IDs.</span>
</span><span id="nearest_neighbor_distance-673"><a href="#nearest_neighbor_distance-673"><span class="linenos">673</span></a>
</span><span id="nearest_neighbor_distance-674"><a href="#nearest_neighbor_distance-674"><span class="linenos">674</span></a><span class="sd">    Examples</span>
</span><span id="nearest_neighbor_distance-675"><a href="#nearest_neighbor_distance-675"><span class="linenos">675</span></a><span class="sd">    --------</span>
</span><span id="nearest_neighbor_distance-676"><a href="#nearest_neighbor_distance-676"><span class="linenos">676</span></a><span class="sd">    &gt;&gt;&gt; centroids = Centroids(data=[</span>
</span><span id="nearest_neighbor_distance-677"><a href="#nearest_neighbor_distance-677"><span class="linenos">677</span></a><span class="sd">    ...     Centroid(cx=Length(0.0, Units.MICRON), cy=Length(0.0, Units.MICRON), cz=Length(0.0, Units.MICRON)),</span>
</span><span id="nearest_neighbor_distance-678"><a href="#nearest_neighbor_distance-678"><span class="linenos">678</span></a><span class="sd">    ...     Centroid(cx=Length(1.0, Units.MICRON), cy=Length(1.0, Units.MICRON), cz=Length(1.0, Units.MICRON)),</span>
</span><span id="nearest_neighbor_distance-679"><a href="#nearest_neighbor_distance-679"><span class="linenos">679</span></a><span class="sd">    ...     Centroid(cx=Length(2.0, Units.MICRON), cy=Length(2.0, Units.MICRON), cz=Length(2.0, Units.MICRON))</span>
</span><span id="nearest_neighbor_distance-680"><a href="#nearest_neighbor_distance-680"><span class="linenos">680</span></a><span class="sd">    ... ])</span>
</span><span id="nearest_neighbor_distance-681"><a href="#nearest_neighbor_distance-681"><span class="linenos">681</span></a><span class="sd">    &gt;&gt;&gt; nearest_neighbor_distance(centroids)</span>
</span><span id="nearest_neighbor_distance-682"><a href="#nearest_neighbor_distance-682"><span class="linenos">682</span></a><span class="sd">    NthNearestNeighbors(nth_nearest=2, distances=[Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)], instance_id=array([0, 0, 1]))</span>
</span><span id="nearest_neighbor_distance-683"><a href="#nearest_neighbor_distance-683"><span class="linenos">683</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="nearest_neighbor_distance-684"><a href="#nearest_neighbor_distance-684"><span class="linenos">684</span></a>
</span><span id="nearest_neighbor_distance-685"><a href="#nearest_neighbor_distance-685"><span class="linenos">685</span></a>    <span class="n">neighbor</span> <span class="o">=</span> <span class="n">sklearnNN</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="nearest_neighbor_distance-686"><a href="#nearest_neighbor_distance-686"><span class="linenos">686</span></a>    <span class="n">centroid_array</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">centroids_to_ndarray</span><span class="p">(</span><span class="n">centroids</span><span class="o">=</span><span class="n">centroids</span><span class="p">)</span>
</span><span id="nearest_neighbor_distance-687"><a href="#nearest_neighbor_distance-687"><span class="linenos">687</span></a>    <span class="n">neighbor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">centroid_array</span><span class="p">)</span>
</span><span id="nearest_neighbor_distance-688"><a href="#nearest_neighbor_distance-688"><span class="linenos">688</span></a>    <span class="n">neighbor_dist</span><span class="p">,</span> <span class="n">neighbor_index</span> <span class="o">=</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span>
</span><span id="nearest_neighbor_distance-689"><a href="#nearest_neighbor_distance-689"><span class="linenos">689</span></a>        <span class="n">centroid_array</span><span class="p">,</span>
</span><span id="nearest_neighbor_distance-690"><a href="#nearest_neighbor_distance-690"><span class="linenos">690</span></a>        <span class="n">return_distance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="nearest_neighbor_distance-691"><a href="#nearest_neighbor_distance-691"><span class="linenos">691</span></a>    <span class="p">)</span>
</span><span id="nearest_neighbor_distance-692"><a href="#nearest_neighbor_distance-692"><span class="linenos">692</span></a>    <span class="n">distances</span> <span class="o">=</span> <span class="n">neighbor_dist</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="nearest_neighbor_distance-693"><a href="#nearest_neighbor_distance-693"><span class="linenos">693</span></a>    <span class="n">instance_id</span> <span class="o">=</span> <span class="n">neighbor_index</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="nearest_neighbor_distance-694"><a href="#nearest_neighbor_distance-694"><span class="linenos">694</span></a>    <span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">instance_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>  <span class="c1"># set feature 0 to 0 distance and neighbor 0</span>
</span><span id="nearest_neighbor_distance-695"><a href="#nearest_neighbor_distance-695"><span class="linenos">695</span></a>
</span><span id="nearest_neighbor_distance-696"><a href="#nearest_neighbor_distance-696"><span class="linenos">696</span></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">centroids</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cx</span><span class="o">.</span><span class="n">unit</span>
</span><span id="nearest_neighbor_distance-697"><a href="#nearest_neighbor_distance-697"><span class="linenos">697</span></a>    <span class="n">distances_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">Length</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">distances</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
</span><span id="nearest_neighbor_distance-698"><a href="#nearest_neighbor_distance-698"><span class="linenos">698</span></a>    <span class="n">nth_nearest</span> <span class="o">=</span> <span class="n">NthNearestNeighbors</span><span class="p">(</span>
</span><span id="nearest_neighbor_distance-699"><a href="#nearest_neighbor_distance-699"><span class="linenos">699</span></a>        <span class="n">nth_nearest</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="nearest_neighbor_distance-700"><a href="#nearest_neighbor_distance-700"><span class="linenos">700</span></a>        <span class="n">distances</span><span class="o">=</span><span class="n">distances_list</span><span class="p">,</span>
</span><span id="nearest_neighbor_distance-701"><a href="#nearest_neighbor_distance-701"><span class="linenos">701</span></a>        <span class="n">instance_id</span><span class="o">=</span><span class="n">instance_id</span><span class="p">,</span>
</span><span id="nearest_neighbor_distance-702"><a href="#nearest_neighbor_distance-702"><span class="linenos">702</span></a>    <span class="p">)</span>
</span><span id="nearest_neighbor_distance-703"><a href="#nearest_neighbor_distance-703"><span class="linenos">703</span></a>    <span class="k">return</span> <span class="n">nth_nearest</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the nearest neighbor distance for a set of centroids.
With nth_nearest_neighbor=1 returning the features themselves
(distances=0, neighbor is themselves).</p>

<h2 id="parameters">Parameters</h2>

<p>centroids : Centroids
    The centroids for which to calculate the nearest neighbor distance.</p>

<h2 id="returns">Returns</h2>

<p>NthNearestNeighbors
    The nth nearest neighbors, distances, and instance IDs.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">centroids</span> <span class="o">=</span> <span class="n">Centroids</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>    <span class="n">Centroid</span><span class="p">(</span><span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">Centroid</span><span class="p">(</span><span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">Centroid</span><span class="p">(</span><span class="n">cx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span> <span class="n">cz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">))</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nearest_neighbor_distance</span><span class="p">(</span><span class="n">centroids</span><span class="p">)</span>
<span class="go">NthNearestNeighbors(nth_nearest=2, distances=[Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.7320508075688772, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)], instance_id=array([0, 0, 1]))</span>
</code></pre>
</div>
</div>


                </section>
                <section id="num_voxels">
                            <input id="num_voxels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">num_voxels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">indices</span><span class="p">:</span> <span class="n"><a href="types.html#InstanceIndices">recon3d.types.InstanceIndices</a></span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="types.html#NVoxel">recon3d.types.NVoxel</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="num_voxels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#num_voxels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="num_voxels-706"><a href="#num_voxels-706"><span class="linenos">706</span></a><span class="k">def</span><span class="w"> </span><span class="nf">num_voxels</span><span class="p">(</span><span class="n">indices</span><span class="p">:</span> <span class="n">InstanceIndices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NVoxel</span><span class="p">]:</span>
</span><span id="num_voxels-707"><a href="#num_voxels-707"><span class="linenos">707</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="num_voxels-708"><a href="#num_voxels-708"><span class="linenos">708</span></a><span class="sd">    Returns the number of voxels for each instance ID from an InstanceImageStack.</span>
</span><span id="num_voxels-709"><a href="#num_voxels-709"><span class="linenos">709</span></a>
</span><span id="num_voxels-710"><a href="#num_voxels-710"><span class="linenos">710</span></a><span class="sd">    Parameters</span>
</span><span id="num_voxels-711"><a href="#num_voxels-711"><span class="linenos">711</span></a><span class="sd">    ----------</span>
</span><span id="num_voxels-712"><a href="#num_voxels-712"><span class="linenos">712</span></a><span class="sd">    indices : InstanceIndices</span>
</span><span id="num_voxels-713"><a href="#num_voxels-713"><span class="linenos">713</span></a><span class="sd">        The instance indices containing the indices of each instance.</span>
</span><span id="num_voxels-714"><a href="#num_voxels-714"><span class="linenos">714</span></a>
</span><span id="num_voxels-715"><a href="#num_voxels-715"><span class="linenos">715</span></a><span class="sd">    Returns</span>
</span><span id="num_voxels-716"><a href="#num_voxels-716"><span class="linenos">716</span></a><span class="sd">    -------</span>
</span><span id="num_voxels-717"><a href="#num_voxels-717"><span class="linenos">717</span></a><span class="sd">    List[NVoxel]</span>
</span><span id="num_voxels-718"><a href="#num_voxels-718"><span class="linenos">718</span></a><span class="sd">        A list of NVoxel objects, each representing the number of voxels for an instance.</span>
</span><span id="num_voxels-719"><a href="#num_voxels-719"><span class="linenos">719</span></a>
</span><span id="num_voxels-720"><a href="#num_voxels-720"><span class="linenos">720</span></a><span class="sd">    Examples</span>
</span><span id="num_voxels-721"><a href="#num_voxels-721"><span class="linenos">721</span></a><span class="sd">    --------</span>
</span><span id="num_voxels-722"><a href="#num_voxels-722"><span class="linenos">722</span></a><span class="sd">    &gt;&gt;&gt; indices = InstanceIndices(</span>
</span><span id="num_voxels-723"><a href="#num_voxels-723"><span class="linenos">723</span></a><span class="sd">    ...     source_name=&quot;example_stack&quot;,</span>
</span><span id="num_voxels-724"><a href="#num_voxels-724"><span class="linenos">724</span></a><span class="sd">    ...     indices=[np.array([[0, 0], [1, 1]]), np.array([[0, 1], [1, 2]])],</span>
</span><span id="num_voxels-725"><a href="#num_voxels-725"><span class="linenos">725</span></a><span class="sd">    ...     labels=InstanceLabels(data=np.array([1, 2]))</span>
</span><span id="num_voxels-726"><a href="#num_voxels-726"><span class="linenos">726</span></a><span class="sd">    ... )</span>
</span><span id="num_voxels-727"><a href="#num_voxels-727"><span class="linenos">727</span></a><span class="sd">    &gt;&gt;&gt; num_voxels(indices)</span>
</span><span id="num_voxels-728"><a href="#num_voxels-728"><span class="linenos">728</span></a><span class="sd">    [NVoxel(value=2, unit=&lt;Units.VOXEL: &#39;voxel&#39;&gt;), NVoxel(value=2, unit=&lt;Units.VOXEL: &#39;voxel&#39;&gt;)]</span>
</span><span id="num_voxels-729"><a href="#num_voxels-729"><span class="linenos">729</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="num_voxels-730"><a href="#num_voxels-730"><span class="linenos">730</span></a>
</span><span id="num_voxels-731"><a href="#num_voxels-731"><span class="linenos">731</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">indices</span>
</span><span id="num_voxels-732"><a href="#num_voxels-732"><span class="linenos">732</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">NVoxel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
</span><span id="num_voxels-733"><a href="#num_voxels-733"><span class="linenos">733</span></a>    <span class="c1"># n_voxels = np.asarray(data, dtype=NVoxel)</span>
</span><span id="num_voxels-734"><a href="#num_voxels-734"><span class="linenos">734</span></a>    <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="num_voxels-735"><a href="#num_voxels-735"><span class="linenos">735</span></a>    <span class="k">return</span> <span class="n">n_voxels</span>
</span></pre></div>


            <div class="docstring"><p>Returns the number of voxels for each instance ID from an InstanceImageStack.</p>

<h2 id="parameters">Parameters</h2>

<p>indices : InstanceIndices
    The instance indices containing the indices of each instance.</p>

<h2 id="returns">Returns</h2>

<p>List[NVoxel]
    A list of NVoxel objects, each representing the number of voxels for an instance.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">indices</span> <span class="o">=</span> <span class="n">InstanceIndices</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">source_name</span><span class="o">=</span><span class="s2">&quot;example_stack&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">indices</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])],</span>
<span class="gp">... </span>    <span class="n">labels</span><span class="o">=</span><span class="n">InstanceLabels</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_voxels</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
<span class="go">[NVoxel(value=2, unit=&lt;Units.VOXEL: &#39;voxel&#39;&gt;), NVoxel(value=2, unit=&lt;Units.VOXEL: &#39;voxel&#39;&gt;)]</span>
</code></pre>
</div>
</div>


                </section>
                <section id="process_image_stack">
                            <input id="process_image_stack-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_image_stack</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">yml_input_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#SemanticImageStack">recon3d.types.SemanticImageStack</a></span>:</span></span>

                <label class="view-source-button" for="process_image_stack-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#process_image_stack"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="process_image_stack-738"><a href="#process_image_stack-738"><span class="linenos">738</span></a><span class="k">def</span><span class="w"> </span><span class="nf">process_image_stack</span><span class="p">(</span><span class="n">yml_input_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SemanticImageStack</span><span class="p">:</span>
</span><span id="process_image_stack-739"><a href="#process_image_stack-739"><span class="linenos">739</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="process_image_stack-740"><a href="#process_image_stack-740"><span class="linenos">740</span></a><span class="sd">    Given a yml input file, converts it to a SemanticImageStack.</span>
</span><span id="process_image_stack-741"><a href="#process_image_stack-741"><span class="linenos">741</span></a>
</span><span id="process_image_stack-742"><a href="#process_image_stack-742"><span class="linenos">742</span></a><span class="sd">    Parameters</span>
</span><span id="process_image_stack-743"><a href="#process_image_stack-743"><span class="linenos">743</span></a><span class="sd">    ----------</span>
</span><span id="process_image_stack-744"><a href="#process_image_stack-744"><span class="linenos">744</span></a><span class="sd">    yml_input_file : Path</span>
</span><span id="process_image_stack-745"><a href="#process_image_stack-745"><span class="linenos">745</span></a><span class="sd">        The fully pathed yml file that specifies settings.</span>
</span><span id="process_image_stack-746"><a href="#process_image_stack-746"><span class="linenos">746</span></a>
</span><span id="process_image_stack-747"><a href="#process_image_stack-747"><span class="linenos">747</span></a><span class="sd">    Returns</span>
</span><span id="process_image_stack-748"><a href="#process_image_stack-748"><span class="linenos">748</span></a><span class="sd">    -------</span>
</span><span id="process_image_stack-749"><a href="#process_image_stack-749"><span class="linenos">749</span></a><span class="sd">    SemanticImageStack</span>
</span><span id="process_image_stack-750"><a href="#process_image_stack-750"><span class="linenos">750</span></a><span class="sd">        The SemanticImageStack object.</span>
</span><span id="process_image_stack-751"><a href="#process_image_stack-751"><span class="linenos">751</span></a>
</span><span id="process_image_stack-752"><a href="#process_image_stack-752"><span class="linenos">752</span></a><span class="sd">    Examples</span>
</span><span id="process_image_stack-753"><a href="#process_image_stack-753"><span class="linenos">753</span></a><span class="sd">    --------</span>
</span><span id="process_image_stack-754"><a href="#process_image_stack-754"><span class="linenos">754</span></a><span class="sd">    &gt;&gt;&gt; yml_input_file = Path(&quot;path/to/input.yml&quot;)</span>
</span><span id="process_image_stack-755"><a href="#process_image_stack-755"><span class="linenos">755</span></a><span class="sd">    &gt;&gt;&gt; semantic_image_stack = process_image_stack(yml_input_file)</span>
</span><span id="process_image_stack-756"><a href="#process_image_stack-756"><span class="linenos">756</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="process_image_stack-757"><a href="#process_image_stack-757"><span class="linenos">757</span></a>
</span><span id="process_image_stack-758"><a href="#process_image_stack-758"><span class="linenos">758</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing specification file: </span><span class="si">{</span><span class="n">yml_input_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="process_image_stack-759"><a href="#process_image_stack-759"><span class="linenos">759</span></a>    <span class="n">db</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">yml_input_file</span><span class="p">)</span>
</span><span id="process_image_stack-760"><a href="#process_image_stack-760"><span class="linenos">760</span></a>
</span><span id="process_image_stack-761"><a href="#process_image_stack-761"><span class="linenos">761</span></a>    <span class="n">file_type</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;semantic_images_type&quot;</span><span class="p">]</span>
</span><span id="process_image_stack-762"><a href="#process_image_stack-762"><span class="linenos">762</span></a>    <span class="n">valid_extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.tiff&quot;</span><span class="p">)</span>
</span><span id="process_image_stack-763"><a href="#process_image_stack-763"><span class="linenos">763</span></a>
</span><span id="process_image_stack-764"><a href="#process_image_stack-764"><span class="linenos">764</span></a>    <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_extensions</span><span class="p">:</span>
</span><span id="process_image_stack-765"><a href="#process_image_stack-765"><span class="linenos">765</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: &#39;image_type&#39; must be &#39;.tif&#39; or &#39;.tiff&#39;.&quot;</span><span class="p">)</span>
</span><span id="process_image_stack-766"><a href="#process_image_stack-766"><span class="linenos">766</span></a>
</span><span id="process_image_stack-767"><a href="#process_image_stack-767"><span class="linenos">767</span></a>    <span class="n">path_input</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;semantic_images_dir&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
</span><span id="process_image_stack-768"><a href="#process_image_stack-768"><span class="linenos">768</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_input</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="process_image_stack-769"><a href="#process_image_stack-769"><span class="linenos">769</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error, &#39;image_dir&#39; of </span><span class="si">{</span><span class="n">path_input</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
</span><span id="process_image_stack-770"><a href="#process_image_stack-770"><span class="linenos">770</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input path: </span><span class="si">{</span><span class="n">path_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="process_image_stack-771"><a href="#process_image_stack-771"><span class="linenos">771</span></a>
</span><span id="process_image_stack-772"><a href="#process_image_stack-772"><span class="linenos">772</span></a>    <span class="n">path_output</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;out_dir&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
</span><span id="process_image_stack-773"><a href="#process_image_stack-773"><span class="linenos">773</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_output</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="process_image_stack-774"><a href="#process_image_stack-774"><span class="linenos">774</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">path_output</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="process_image_stack-775"><a href="#process_image_stack-775"><span class="linenos">775</span></a>            <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="process_image_stack-776"><a href="#process_image_stack-776"><span class="linenos">776</span></a>        <span class="p">)</span>  <span class="c1"># makes directory if it doesn&#39;t exist</span>
</span><span id="process_image_stack-777"><a href="#process_image_stack-777"><span class="linenos">777</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output path: </span><span class="si">{</span><span class="n">path_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="process_image_stack-778"><a href="#process_image_stack-778"><span class="linenos">778</span></a>
</span><span id="process_image_stack-779"><a href="#process_image_stack-779"><span class="linenos">779</span></a>    <span class="c1"># semantic_seg_dict = db[&quot;class_labels&quot;]</span>
</span><span id="process_image_stack-780"><a href="#process_image_stack-780"><span class="linenos">780</span></a>
</span><span id="process_image_stack-781"><a href="#process_image_stack-781"><span class="linenos">781</span></a>    <span class="c1"># # load images</span>
</span><span id="process_image_stack-782"><a href="#process_image_stack-782"><span class="linenos">782</span></a>    <span class="c1"># imageStack = skio.imread_collection(tiff_files, conserve_memory=True)</span>
</span><span id="process_image_stack-783"><a href="#process_image_stack-783"><span class="linenos">783</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">read_images</span><span class="p">(</span><span class="n">path_input</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</span><span id="process_image_stack-784"><a href="#process_image_stack-784"><span class="linenos">784</span></a>    <span class="n">semantic_seg_stack_name</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;semantic_imagestack_name&quot;</span><span class="p">]</span>
</span><span id="process_image_stack-785"><a href="#process_image_stack-785"><span class="linenos">785</span></a>
</span><span id="process_image_stack-786"><a href="#process_image_stack-786"><span class="linenos">786</span></a>    <span class="c1"># create meta data</span>
</span><span id="process_image_stack-787"><a href="#process_image_stack-787"><span class="linenos">787</span></a>    <span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</span><span id="process_image_stack-788"><a href="#process_image_stack-788"><span class="linenos">788</span></a>    <span class="n">data_volume</span> <span class="o">=</span> <span class="n">DataVolume</span><span class="p">(</span><span class="n">z_image_count</span><span class="o">=</span><span class="n">nz</span><span class="p">,</span> <span class="n">y_height</span><span class="o">=</span><span class="n">ny</span><span class="p">,</span> <span class="n">x_width</span><span class="o">=</span><span class="n">nx</span><span class="p">)</span>
</span><span id="process_image_stack-789"><a href="#process_image_stack-789"><span class="linenos">789</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="process_image_stack-790"><a href="#process_image_stack-790"><span class="linenos">790</span></a>        <span class="sa">f</span><span class="s2">&quot;image stack, </span><span class="si">{</span><span class="n">semantic_seg_stack_name</span><span class="si">}</span><span class="s2">, has dimensions (num_images, row, col): </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="process_image_stack-791"><a href="#process_image_stack-791"><span class="linenos">791</span></a>    <span class="p">)</span>
</span><span id="process_image_stack-792"><a href="#process_image_stack-792"><span class="linenos">792</span></a>
</span><span id="process_image_stack-793"><a href="#process_image_stack-793"><span class="linenos">793</span></a>    <span class="n">pixel_units</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;pixel_units&quot;</span><span class="p">]</span>
</span><span id="process_image_stack-794"><a href="#process_image_stack-794"><span class="linenos">794</span></a>    <span class="n">valid_units</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Units</span><span class="p">)</span>
</span><span id="process_image_stack-795"><a href="#process_image_stack-795"><span class="linenos">795</span></a>    <span class="k">if</span> <span class="n">pixel_units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_units</span><span class="p">:</span>
</span><span id="process_image_stack-796"><a href="#process_image_stack-796"><span class="linenos">796</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="process_image_stack-797"><a href="#process_image_stack-797"><span class="linenos">797</span></a>            <span class="sa">f</span><span class="s2">&quot;Error, &#39;</span><span class="si">{</span><span class="n">pixel_units</span><span class="si">}</span><span class="s2">&#39; is not a valid unit, accepted units are: </span><span class="si">{</span><span class="n">valid_units</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="process_image_stack-798"><a href="#process_image_stack-798"><span class="linenos">798</span></a>        <span class="p">)</span>
</span><span id="process_image_stack-799"><a href="#process_image_stack-799"><span class="linenos">799</span></a>    <span class="n">pixel_units</span> <span class="o">=</span> <span class="n">Units</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;pixel_units&quot;</span><span class="p">])</span>
</span><span id="process_image_stack-800"><a href="#process_image_stack-800"><span class="linenos">800</span></a>
</span><span id="process_image_stack-801"><a href="#process_image_stack-801"><span class="linenos">801</span></a>    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="process_image_stack-802"><a href="#process_image_stack-802"><span class="linenos">802</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;voxel_size&quot;</span><span class="p">][</span><span class="s2">&quot;dx&quot;</span><span class="p">],</span>
</span><span id="process_image_stack-803"><a href="#process_image_stack-803"><span class="linenos">803</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;voxel_size&quot;</span><span class="p">][</span><span class="s2">&quot;dy&quot;</span><span class="p">],</span>
</span><span id="process_image_stack-804"><a href="#process_image_stack-804"><span class="linenos">804</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;voxel_size&quot;</span><span class="p">][</span><span class="s2">&quot;dz&quot;</span><span class="p">],</span>
</span><span id="process_image_stack-805"><a href="#process_image_stack-805"><span class="linenos">805</span></a>    <span class="p">)</span>
</span><span id="process_image_stack-806"><a href="#process_image_stack-806"><span class="linenos">806</span></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="n">Resolution</span><span class="p">(</span>
</span><span id="process_image_stack-807"><a href="#process_image_stack-807"><span class="linenos">807</span></a>        <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="process_image_stack-808"><a href="#process_image_stack-808"><span class="linenos">808</span></a>        <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="process_image_stack-809"><a href="#process_image_stack-809"><span class="linenos">809</span></a>        <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="process_image_stack-810"><a href="#process_image_stack-810"><span class="linenos">810</span></a>    <span class="p">)</span>
</span><span id="process_image_stack-811"><a href="#process_image_stack-811"><span class="linenos">811</span></a>
</span><span id="process_image_stack-812"><a href="#process_image_stack-812"><span class="linenos">812</span></a>    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="process_image_stack-813"><a href="#process_image_stack-813"><span class="linenos">813</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">][</span><span class="s2">&quot;x0&quot;</span><span class="p">],</span>
</span><span id="process_image_stack-814"><a href="#process_image_stack-814"><span class="linenos">814</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">][</span><span class="s2">&quot;y0&quot;</span><span class="p">],</span>
</span><span id="process_image_stack-815"><a href="#process_image_stack-815"><span class="linenos">815</span></a>        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">][</span><span class="s2">&quot;z0&quot;</span><span class="p">],</span>
</span><span id="process_image_stack-816"><a href="#process_image_stack-816"><span class="linenos">816</span></a>    <span class="p">)</span>
</span><span id="process_image_stack-817"><a href="#process_image_stack-817"><span class="linenos">817</span></a>    <span class="n">origin</span> <span class="o">=</span> <span class="n">Origin</span><span class="p">(</span>
</span><span id="process_image_stack-818"><a href="#process_image_stack-818"><span class="linenos">818</span></a>        <span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="process_image_stack-819"><a href="#process_image_stack-819"><span class="linenos">819</span></a>        <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="process_image_stack-820"><a href="#process_image_stack-820"><span class="linenos">820</span></a>        <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">),</span>
</span><span id="process_image_stack-821"><a href="#process_image_stack-821"><span class="linenos">821</span></a>    <span class="p">)</span>
</span><span id="process_image_stack-822"><a href="#process_image_stack-822"><span class="linenos">822</span></a>
</span><span id="process_image_stack-823"><a href="#process_image_stack-823"><span class="linenos">823</span></a>    <span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span>
</span><span id="process_image_stack-824"><a href="#process_image_stack-824"><span class="linenos">824</span></a>        <span class="n">data_volume</span><span class="o">=</span><span class="n">data_volume</span><span class="p">,</span>
</span><span id="process_image_stack-825"><a href="#process_image_stack-825"><span class="linenos">825</span></a>        <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="process_image_stack-826"><a href="#process_image_stack-826"><span class="linenos">826</span></a>        <span class="n">pixel_units</span><span class="o">=</span><span class="n">pixel_units</span><span class="p">,</span>
</span><span id="process_image_stack-827"><a href="#process_image_stack-827"><span class="linenos">827</span></a>        <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="process_image_stack-828"><a href="#process_image_stack-828"><span class="linenos">828</span></a>    <span class="p">)</span>
</span><span id="process_image_stack-829"><a href="#process_image_stack-829"><span class="linenos">829</span></a>
</span><span id="process_image_stack-830"><a href="#process_image_stack-830"><span class="linenos">830</span></a>    <span class="c1"># # Optional, grey image stack</span>
</span><span id="process_image_stack-831"><a href="#process_image_stack-831"><span class="linenos">831</span></a>    <span class="c1"># # TODO: test functionality</span>
</span><span id="process_image_stack-832"><a href="#process_image_stack-832"><span class="linenos">832</span></a>    <span class="c1"># if db[&quot;grey_image_dir&quot;]:</span>
</span><span id="process_image_stack-833"><a href="#process_image_stack-833"><span class="linenos">833</span></a>    <span class="c1">#     path_grey_image_dir = Path(db[&quot;path_grey_image_dir&quot;]).expanduser()</span>
</span><span id="process_image_stack-834"><a href="#process_image_stack-834"><span class="linenos">834</span></a>    <span class="c1">#     assert path_grey_image_dir.is_dir(), &quot;Error, &#39;image_dir&#39; not found.&quot;</span>
</span><span id="process_image_stack-835"><a href="#process_image_stack-835"><span class="linenos">835</span></a>    <span class="c1">#     grey_image_name = &quot;Raw greyscale&quot;</span>
</span><span id="process_image_stack-836"><a href="#process_image_stack-836"><span class="linenos">836</span></a>    <span class="c1">#     grey_data = ut.read_images(path_grey_image_dir, file_type)</span>
</span><span id="process_image_stack-837"><a href="#process_image_stack-837"><span class="linenos">837</span></a>    <span class="c1">#     assert data.shape == grey_data.shape</span>
</span><span id="process_image_stack-838"><a href="#process_image_stack-838"><span class="linenos">838</span></a>    <span class="c1">#     semantic_seg_image_stack = ImageStack(</span>
</span><span id="process_image_stack-839"><a href="#process_image_stack-839"><span class="linenos">839</span></a>    <span class="c1">#         name=grey_image_name, metadata=meta, data=grey_data</span>
</span><span id="process_image_stack-840"><a href="#process_image_stack-840"><span class="linenos">840</span></a>    <span class="c1">#     )</span>
</span><span id="process_image_stack-841"><a href="#process_image_stack-841"><span class="linenos">841</span></a>
</span><span id="process_image_stack-842"><a href="#process_image_stack-842"><span class="linenos">842</span></a>    <span class="c1"># create SemanticImageStack</span>
</span><span id="process_image_stack-843"><a href="#process_image_stack-843"><span class="linenos">843</span></a>    <span class="n">semantic_seg_image_stack</span> <span class="o">=</span> <span class="n">SemanticImageStack</span><span class="p">(</span>
</span><span id="process_image_stack-844"><a href="#process_image_stack-844"><span class="linenos">844</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">semantic_seg_stack_name</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span>
</span><span id="process_image_stack-845"><a href="#process_image_stack-845"><span class="linenos">845</span></a>    <span class="p">)</span>
</span><span id="process_image_stack-846"><a href="#process_image_stack-846"><span class="linenos">846</span></a>
</span><span id="process_image_stack-847"><a href="#process_image_stack-847"><span class="linenos">847</span></a>    <span class="k">return</span> <span class="n">semantic_seg_image_stack</span>  <span class="c1"># , path_file_output)</span>
</span></pre></div>


            <div class="docstring"><p>Given a yml input file, converts it to a SemanticImageStack.</p>

<h2 id="parameters">Parameters</h2>

<p>yml_input_file : Path
    The fully pathed yml file that specifies settings.</p>

<h2 id="returns">Returns</h2>

<p>SemanticImageStack
    The SemanticImageStack object.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">yml_input_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;path/to/input.yml&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">semantic_image_stack</span> <span class="o">=</span> <span class="n">process_image_stack</span><span class="p">(</span><span class="n">yml_input_file</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="save_instance_images">
                            <input id="save_instance_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_instance_images</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">input_volumes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="types.html#InstanceImageStack">recon3d.types.InstanceImageStack</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="save_instance_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#save_instance_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="save_instance_images-850"><a href="#save_instance_images-850"><span class="linenos">850</span></a><span class="k">def</span><span class="w"> </span><span class="nf">save_instance_images</span><span class="p">(</span>
</span><span id="save_instance_images-851"><a href="#save_instance_images-851"><span class="linenos">851</span></a>    <span class="n">input_volumes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">InstanceImageStack</span><span class="p">],</span> <span class="n">save_path</span><span class="p">:</span> <span class="n">Path</span>
</span><span id="save_instance_images-852"><a href="#save_instance_images-852"><span class="linenos">852</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="save_instance_images-853"><a href="#save_instance_images-853"><span class="linenos">853</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="save_instance_images-854"><a href="#save_instance_images-854"><span class="linenos">854</span></a><span class="sd">    Save InstanceImageStack objects to image files.</span>
</span><span id="save_instance_images-855"><a href="#save_instance_images-855"><span class="linenos">855</span></a>
</span><span id="save_instance_images-856"><a href="#save_instance_images-856"><span class="linenos">856</span></a><span class="sd">    This function takes a list of InstanceImageStack objects and saves each one as a series of image files.</span>
</span><span id="save_instance_images-857"><a href="#save_instance_images-857"><span class="linenos">857</span></a><span class="sd">    The images are saved in the specified directory, with each stack saved in its own subdirectory.</span>
</span><span id="save_instance_images-858"><a href="#save_instance_images-858"><span class="linenos">858</span></a>
</span><span id="save_instance_images-859"><a href="#save_instance_images-859"><span class="linenos">859</span></a><span class="sd">    Parameters</span>
</span><span id="save_instance_images-860"><a href="#save_instance_images-860"><span class="linenos">860</span></a><span class="sd">    ----------</span>
</span><span id="save_instance_images-861"><a href="#save_instance_images-861"><span class="linenos">861</span></a><span class="sd">    input_volumes : list of InstanceImageStack</span>
</span><span id="save_instance_images-862"><a href="#save_instance_images-862"><span class="linenos">862</span></a><span class="sd">        List of InstanceImageStack objects to be saved as images.</span>
</span><span id="save_instance_images-863"><a href="#save_instance_images-863"><span class="linenos">863</span></a><span class="sd">    save_path : Path</span>
</span><span id="save_instance_images-864"><a href="#save_instance_images-864"><span class="linenos">864</span></a><span class="sd">        The directory where the images will be saved.</span>
</span><span id="save_instance_images-865"><a href="#save_instance_images-865"><span class="linenos">865</span></a>
</span><span id="save_instance_images-866"><a href="#save_instance_images-866"><span class="linenos">866</span></a><span class="sd">    Returns</span>
</span><span id="save_instance_images-867"><a href="#save_instance_images-867"><span class="linenos">867</span></a><span class="sd">    -------</span>
</span><span id="save_instance_images-868"><a href="#save_instance_images-868"><span class="linenos">868</span></a><span class="sd">    bool</span>
</span><span id="save_instance_images-869"><a href="#save_instance_images-869"><span class="linenos">869</span></a><span class="sd">        True if the images were saved successfully, False otherwise.</span>
</span><span id="save_instance_images-870"><a href="#save_instance_images-870"><span class="linenos">870</span></a>
</span><span id="save_instance_images-871"><a href="#save_instance_images-871"><span class="linenos">871</span></a><span class="sd">    Examples</span>
</span><span id="save_instance_images-872"><a href="#save_instance_images-872"><span class="linenos">872</span></a><span class="sd">    --------</span>
</span><span id="save_instance_images-873"><a href="#save_instance_images-873"><span class="linenos">873</span></a><span class="sd">    &gt;&gt;&gt; input_volumes = [</span>
</span><span id="save_instance_images-874"><a href="#save_instance_images-874"><span class="linenos">874</span></a><span class="sd">    ...     InstanceImageStack(</span>
</span><span id="save_instance_images-875"><a href="#save_instance_images-875"><span class="linenos">875</span></a><span class="sd">    ...         name=&quot;example_stack_1&quot;,</span>
</span><span id="save_instance_images-876"><a href="#save_instance_images-876"><span class="linenos">876</span></a><span class="sd">    ...         metadata=MetaData(</span>
</span><span id="save_instance_images-877"><a href="#save_instance_images-877"><span class="linenos">877</span></a><span class="sd">    ...             data_volume=DataVolume(x_width=256, y_height=256, z_image_count=10),</span>
</span><span id="save_instance_images-878"><a href="#save_instance_images-878"><span class="linenos">878</span></a><span class="sd">    ...             resolution=Resolution(</span>
</span><span id="save_instance_images-879"><a href="#save_instance_images-879"><span class="linenos">879</span></a><span class="sd">    ...                 dx=Length(1.0, Units.MICRON),</span>
</span><span id="save_instance_images-880"><a href="#save_instance_images-880"><span class="linenos">880</span></a><span class="sd">    ...                 dy=Length(1.0, Units.MICRON),</span>
</span><span id="save_instance_images-881"><a href="#save_instance_images-881"><span class="linenos">881</span></a><span class="sd">    ...                 dz=Length(1.0, Units.MICRON)</span>
</span><span id="save_instance_images-882"><a href="#save_instance_images-882"><span class="linenos">882</span></a><span class="sd">    ...             ),</span>
</span><span id="save_instance_images-883"><a href="#save_instance_images-883"><span class="linenos">883</span></a><span class="sd">    ...             pixel_units=Units.MICRON,</span>
</span><span id="save_instance_images-884"><a href="#save_instance_images-884"><span class="linenos">884</span></a><span class="sd">    ...             origin=Origin(</span>
</span><span id="save_instance_images-885"><a href="#save_instance_images-885"><span class="linenos">885</span></a><span class="sd">    ...                 x0=Length(0.0, Units.MICRON),</span>
</span><span id="save_instance_images-886"><a href="#save_instance_images-886"><span class="linenos">886</span></a><span class="sd">    ...                 y0=Length(0.0, Units.MICRON),</span>
</span><span id="save_instance_images-887"><a href="#save_instance_images-887"><span class="linenos">887</span></a><span class="sd">    ...                 z0=Length(0.0, Units.MICRON)</span>
</span><span id="save_instance_images-888"><a href="#save_instance_images-888"><span class="linenos">888</span></a><span class="sd">    ...             )</span>
</span><span id="save_instance_images-889"><a href="#save_instance_images-889"><span class="linenos">889</span></a><span class="sd">    ...         ),</span>
</span><span id="save_instance_images-890"><a href="#save_instance_images-890"><span class="linenos">890</span></a><span class="sd">    ...         data=np.random.rand(10, 256, 256),</span>
</span><span id="save_instance_images-891"><a href="#save_instance_images-891"><span class="linenos">891</span></a><span class="sd">    ...         nlabels=3,</span>
</span><span id="save_instance_images-892"><a href="#save_instance_images-892"><span class="linenos">892</span></a><span class="sd">    ...         min_feature_size=2</span>
</span><span id="save_instance_images-893"><a href="#save_instance_images-893"><span class="linenos">893</span></a><span class="sd">    ...     ),</span>
</span><span id="save_instance_images-894"><a href="#save_instance_images-894"><span class="linenos">894</span></a><span class="sd">    ...     InstanceImageStack(</span>
</span><span id="save_instance_images-895"><a href="#save_instance_images-895"><span class="linenos">895</span></a><span class="sd">    ...         name=&quot;example_stack_2&quot;,</span>
</span><span id="save_instance_images-896"><a href="#save_instance_images-896"><span class="linenos">896</span></a><span class="sd">    ...         metadata=MetaData(</span>
</span><span id="save_instance_images-897"><a href="#save_instance_images-897"><span class="linenos">897</span></a><span class="sd">    ...             data_volume=DataVolume(x_width=256, y_height=256, z_image_count=10),</span>
</span><span id="save_instance_images-898"><a href="#save_instance_images-898"><span class="linenos">898</span></a><span class="sd">    ...             resolution=Resolution(</span>
</span><span id="save_instance_images-899"><a href="#save_instance_images-899"><span class="linenos">899</span></a><span class="sd">    ...                 dx=Length(1.0, Units.MICRON),</span>
</span><span id="save_instance_images-900"><a href="#save_instance_images-900"><span class="linenos">900</span></a><span class="sd">    ...                 dy=Length(1.0, Units.MICRON),</span>
</span><span id="save_instance_images-901"><a href="#save_instance_images-901"><span class="linenos">901</span></a><span class="sd">    ...                 dz=Length(1.0, Units.MICRON)</span>
</span><span id="save_instance_images-902"><a href="#save_instance_images-902"><span class="linenos">902</span></a><span class="sd">    ...             ),</span>
</span><span id="save_instance_images-903"><a href="#save_instance_images-903"><span class="linenos">903</span></a><span class="sd">    ...             pixel_units=Units.MICRON,</span>
</span><span id="save_instance_images-904"><a href="#save_instance_images-904"><span class="linenos">904</span></a><span class="sd">    ...             origin=Origin(</span>
</span><span id="save_instance_images-905"><a href="#save_instance_images-905"><span class="linenos">905</span></a><span class="sd">    ...                 x0=Length(0.0, Units.MICRON),</span>
</span><span id="save_instance_images-906"><a href="#save_instance_images-906"><span class="linenos">906</span></a><span class="sd">    ...                 y0=Length(0.0, Units.MICRON),</span>
</span><span id="save_instance_images-907"><a href="#save_instance_images-907"><span class="linenos">907</span></a><span class="sd">    ...                 z0=Length(0.0, Units.MICRON)</span>
</span><span id="save_instance_images-908"><a href="#save_instance_images-908"><span class="linenos">908</span></a><span class="sd">    ...             )</span>
</span><span id="save_instance_images-909"><a href="#save_instance_images-909"><span class="linenos">909</span></a><span class="sd">    ...         ),</span>
</span><span id="save_instance_images-910"><a href="#save_instance_images-910"><span class="linenos">910</span></a><span class="sd">    ...         data=np.random.rand(10, 256, 256),</span>
</span><span id="save_instance_images-911"><a href="#save_instance_images-911"><span class="linenos">911</span></a><span class="sd">    ...         nlabels=3,</span>
</span><span id="save_instance_images-912"><a href="#save_instance_images-912"><span class="linenos">912</span></a><span class="sd">    ...         min_feature_size=2</span>
</span><span id="save_instance_images-913"><a href="#save_instance_images-913"><span class="linenos">913</span></a><span class="sd">    ...     )</span>
</span><span id="save_instance_images-914"><a href="#save_instance_images-914"><span class="linenos">914</span></a><span class="sd">    ... ]</span>
</span><span id="save_instance_images-915"><a href="#save_instance_images-915"><span class="linenos">915</span></a><span class="sd">    &gt;&gt;&gt; save_path = Path(&quot;path/to/save&quot;)</span>
</span><span id="save_instance_images-916"><a href="#save_instance_images-916"><span class="linenos">916</span></a><span class="sd">    &gt;&gt;&gt; save_instance_images(input_volumes, save_path)</span>
</span><span id="save_instance_images-917"><a href="#save_instance_images-917"><span class="linenos">917</span></a><span class="sd">    True</span>
</span><span id="save_instance_images-918"><a href="#save_instance_images-918"><span class="linenos">918</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="save_instance_images-919"><a href="#save_instance_images-919"><span class="linenos">919</span></a>
</span><span id="save_instance_images-920"><a href="#save_instance_images-920"><span class="linenos">920</span></a>    <span class="k">for</span> <span class="n">instance_volumes</span> <span class="ow">in</span> <span class="n">input_volumes</span><span class="p">:</span>
</span><span id="save_instance_images-921"><a href="#save_instance_images-921"><span class="linenos">921</span></a>        <span class="n">ut</span><span class="o">.</span><span class="n">ndarray_to_img</span><span class="p">(</span>
</span><span id="save_instance_images-922"><a href="#save_instance_images-922"><span class="linenos">922</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">instance_volumes</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="save_instance_images-923"><a href="#save_instance_images-923"><span class="linenos">923</span></a>            <span class="n">slice_axis</span><span class="o">=</span><span class="n">recon3d</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">CartesianAxis3D</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="save_instance_images-924"><a href="#save_instance_images-924"><span class="linenos">924</span></a>            <span class="n">parent_dir</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
</span><span id="save_instance_images-925"><a href="#save_instance_images-925"><span class="linenos">925</span></a>            <span class="n">folder_name</span><span class="o">=</span><span class="n">instance_volumes</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="save_instance_images-926"><a href="#save_instance_images-926"><span class="linenos">926</span></a>            <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span>
</span><span id="save_instance_images-927"><a href="#save_instance_images-927"><span class="linenos">927</span></a>            <span class="n">pad_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span id="save_instance_images-928"><a href="#save_instance_images-928"><span class="linenos">928</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save InstanceImageStack objects to image files.</p>

<p>This function takes a list of InstanceImageStack objects and saves each one as a series of image files.
The images are saved in the specified directory, with each stack saved in its own subdirectory.</p>

<h2 id="parameters">Parameters</h2>

<p>input_volumes : list of InstanceImageStack
    List of InstanceImageStack objects to be saved as images.
save_path : Path
    The directory where the images will be saved.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the images were saved successfully, False otherwise.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">input_volumes</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">InstanceImageStack</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_stack_1&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">metadata</span><span class="o">=</span><span class="n">MetaData</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">data_volume</span><span class="o">=</span><span class="n">DataVolume</span><span class="p">(</span><span class="n">x_width</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">y_height</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">z_image_count</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">resolution</span><span class="o">=</span><span class="n">Resolution</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>            <span class="p">),</span>
<span class="gp">... </span>            <span class="n">pixel_units</span><span class="o">=</span><span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">origin</span><span class="o">=</span><span class="n">Origin</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>            <span class="p">)</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">nlabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">min_feature_size</span><span class="o">=</span><span class="mi">2</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">InstanceImageStack</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_stack_2&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">metadata</span><span class="o">=</span><span class="n">MetaData</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">data_volume</span><span class="o">=</span><span class="n">DataVolume</span><span class="p">(</span><span class="n">x_width</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">y_height</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">z_image_count</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">resolution</span><span class="o">=</span><span class="n">Resolution</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>            <span class="p">),</span>
<span class="gp">... </span>            <span class="n">pixel_units</span><span class="o">=</span><span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">origin</span><span class="o">=</span><span class="n">Origin</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>            <span class="p">)</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">nlabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">min_feature_size</span><span class="o">=</span><span class="mi">2</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;path/to/save&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">save_instance_images</span><span class="p">(</span><span class="n">input_volumes</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
<span class="go">True</span>
</code></pre>
</div>
</div>


                </section>
                <section id="semantic_to_instance">
                            <input id="semantic_to_instance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">semantic_to_instance</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">semantic_stack</span><span class="p">:</span> <span class="n"><a href="types.html#SemanticImageStack">recon3d.types.SemanticImageStack</a></span>,</span><span class="param">	<span class="n">instance_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">instance_value</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">min_feature_size</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#InstanceImageStack">recon3d.types.InstanceImageStack</a></span>:</span></span>

                <label class="view-source-button" for="semantic_to_instance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#semantic_to_instance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="semantic_to_instance-931"><a href="#semantic_to_instance-931"><span class="linenos"> 931</span></a><span class="k">def</span><span class="w"> </span><span class="nf">semantic_to_instance</span><span class="p">(</span>
</span><span id="semantic_to_instance-932"><a href="#semantic_to_instance-932"><span class="linenos"> 932</span></a>    <span class="n">semantic_stack</span><span class="p">:</span> <span class="n">SemanticImageStack</span><span class="p">,</span>
</span><span id="semantic_to_instance-933"><a href="#semantic_to_instance-933"><span class="linenos"> 933</span></a>    <span class="n">instance_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="semantic_to_instance-934"><a href="#semantic_to_instance-934"><span class="linenos"> 934</span></a>    <span class="n">instance_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="semantic_to_instance-935"><a href="#semantic_to_instance-935"><span class="linenos"> 935</span></a>    <span class="n">min_feature_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="semantic_to_instance-936"><a href="#semantic_to_instance-936"><span class="linenos"> 936</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InstanceImageStack</span><span class="p">:</span>
</span><span id="semantic_to_instance-937"><a href="#semantic_to_instance-937"><span class="linenos"> 937</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="semantic_to_instance-938"><a href="#semantic_to_instance-938"><span class="linenos"> 938</span></a><span class="sd">    Isolate each unique class in the semantic segmentation (e.g., Cats or Dogs)</span>
</span><span id="semantic_to_instance-939"><a href="#semantic_to_instance-939"><span class="linenos"> 939</span></a><span class="sd">    and create the Instance Image Stacks.</span>
</span><span id="semantic_to_instance-940"><a href="#semantic_to_instance-940"><span class="linenos"> 940</span></a>
</span><span id="semantic_to_instance-941"><a href="#semantic_to_instance-941"><span class="linenos"> 941</span></a><span class="sd">    Parameters</span>
</span><span id="semantic_to_instance-942"><a href="#semantic_to_instance-942"><span class="linenos"> 942</span></a><span class="sd">    ----------</span>
</span><span id="semantic_to_instance-943"><a href="#semantic_to_instance-943"><span class="linenos"> 943</span></a><span class="sd">    semantic_stack : SemanticImageStack</span>
</span><span id="semantic_to_instance-944"><a href="#semantic_to_instance-944"><span class="linenos"> 944</span></a><span class="sd">        The semantic image stack containing the segmented data.</span>
</span><span id="semantic_to_instance-945"><a href="#semantic_to_instance-945"><span class="linenos"> 945</span></a><span class="sd">    instance_name : str</span>
</span><span id="semantic_to_instance-946"><a href="#semantic_to_instance-946"><span class="linenos"> 946</span></a><span class="sd">        The name for the instance image stack.</span>
</span><span id="semantic_to_instance-947"><a href="#semantic_to_instance-947"><span class="linenos"> 947</span></a><span class="sd">    instance_value : int</span>
</span><span id="semantic_to_instance-948"><a href="#semantic_to_instance-948"><span class="linenos"> 948</span></a><span class="sd">        The value in the semantic stack representing the class to isolate.</span>
</span><span id="semantic_to_instance-949"><a href="#semantic_to_instance-949"><span class="linenos"> 949</span></a><span class="sd">    min_feature_size : int</span>
</span><span id="semantic_to_instance-950"><a href="#semantic_to_instance-950"><span class="linenos"> 950</span></a><span class="sd">        The minimum feature size to retain in the instance image stack.</span>
</span><span id="semantic_to_instance-951"><a href="#semantic_to_instance-951"><span class="linenos"> 951</span></a>
</span><span id="semantic_to_instance-952"><a href="#semantic_to_instance-952"><span class="linenos"> 952</span></a><span class="sd">    Returns</span>
</span><span id="semantic_to_instance-953"><a href="#semantic_to_instance-953"><span class="linenos"> 953</span></a><span class="sd">    -------</span>
</span><span id="semantic_to_instance-954"><a href="#semantic_to_instance-954"><span class="linenos"> 954</span></a><span class="sd">    InstanceImageStack</span>
</span><span id="semantic_to_instance-955"><a href="#semantic_to_instance-955"><span class="linenos"> 955</span></a><span class="sd">        The instance image stack with isolated features.</span>
</span><span id="semantic_to_instance-956"><a href="#semantic_to_instance-956"><span class="linenos"> 956</span></a>
</span><span id="semantic_to_instance-957"><a href="#semantic_to_instance-957"><span class="linenos"> 957</span></a><span class="sd">    Examples</span>
</span><span id="semantic_to_instance-958"><a href="#semantic_to_instance-958"><span class="linenos"> 958</span></a><span class="sd">    --------</span>
</span><span id="semantic_to_instance-959"><a href="#semantic_to_instance-959"><span class="linenos"> 959</span></a><span class="sd">    &gt;&gt;&gt; semantic_stack = SemanticImageStack(</span>
</span><span id="semantic_to_instance-960"><a href="#semantic_to_instance-960"><span class="linenos"> 960</span></a><span class="sd">    ...     name=&quot;example_semantic_stack&quot;,</span>
</span><span id="semantic_to_instance-961"><a href="#semantic_to_instance-961"><span class="linenos"> 961</span></a><span class="sd">    ...     metadata=MetaData(</span>
</span><span id="semantic_to_instance-962"><a href="#semantic_to_instance-962"><span class="linenos"> 962</span></a><span class="sd">    ...         data_volume=DataVolume(z_image_count=10, y_height=256, x_width=256),</span>
</span><span id="semantic_to_instance-963"><a href="#semantic_to_instance-963"><span class="linenos"> 963</span></a><span class="sd">    ...         resolution=Resolution(</span>
</span><span id="semantic_to_instance-964"><a href="#semantic_to_instance-964"><span class="linenos"> 964</span></a><span class="sd">    ...             dx=Length(1.0, Units.MICRON),</span>
</span><span id="semantic_to_instance-965"><a href="#semantic_to_instance-965"><span class="linenos"> 965</span></a><span class="sd">    ...             dy=Length(1.0, Units.MICRON),</span>
</span><span id="semantic_to_instance-966"><a href="#semantic_to_instance-966"><span class="linenos"> 966</span></a><span class="sd">    ...             dz=Length(1.0, Units.MICRON)</span>
</span><span id="semantic_to_instance-967"><a href="#semantic_to_instance-967"><span class="linenos"> 967</span></a><span class="sd">    ...         ),</span>
</span><span id="semantic_to_instance-968"><a href="#semantic_to_instance-968"><span class="linenos"> 968</span></a><span class="sd">    ...         pixel_units=Units.MICRON,</span>
</span><span id="semantic_to_instance-969"><a href="#semantic_to_instance-969"><span class="linenos"> 969</span></a><span class="sd">    ...         origin=Origin(</span>
</span><span id="semantic_to_instance-970"><a href="#semantic_to_instance-970"><span class="linenos"> 970</span></a><span class="sd">    ...             x0=Length(0.0, Units.MICRON),</span>
</span><span id="semantic_to_instance-971"><a href="#semantic_to_instance-971"><span class="linenos"> 971</span></a><span class="sd">    ...             y0=Length(0.0, Units.MICRON),</span>
</span><span id="semantic_to_instance-972"><a href="#semantic_to_instance-972"><span class="linenos"> 972</span></a><span class="sd">    ...             z0=Length(0.0, Units.MICRON)</span>
</span><span id="semantic_to_instance-973"><a href="#semantic_to_instance-973"><span class="linenos"> 973</span></a><span class="sd">    ...         )</span>
</span><span id="semantic_to_instance-974"><a href="#semantic_to_instance-974"><span class="linenos"> 974</span></a><span class="sd">    ...     ),</span>
</span><span id="semantic_to_instance-975"><a href="#semantic_to_instance-975"><span class="linenos"> 975</span></a><span class="sd">    ...     data=np.random.randint(0, 2, (10, 256, 256))</span>
</span><span id="semantic_to_instance-976"><a href="#semantic_to_instance-976"><span class="linenos"> 976</span></a><span class="sd">    ... )</span>
</span><span id="semantic_to_instance-977"><a href="#semantic_to_instance-977"><span class="linenos"> 977</span></a><span class="sd">    &gt;&gt;&gt; instance_stack = semantic_to_instance(</span>
</span><span id="semantic_to_instance-978"><a href="#semantic_to_instance-978"><span class="linenos"> 978</span></a><span class="sd">    ...     semantic_stack,</span>
</span><span id="semantic_to_instance-979"><a href="#semantic_to_instance-979"><span class="linenos"> 979</span></a><span class="sd">    ...     instance_name=&quot;example_instance_stack&quot;,</span>
</span><span id="semantic_to_instance-980"><a href="#semantic_to_instance-980"><span class="linenos"> 980</span></a><span class="sd">    ...     instance_value=1,</span>
</span><span id="semantic_to_instance-981"><a href="#semantic_to_instance-981"><span class="linenos"> 981</span></a><span class="sd">    ...     min_feature_size=10</span>
</span><span id="semantic_to_instance-982"><a href="#semantic_to_instance-982"><span class="linenos"> 982</span></a><span class="sd">    ... )</span>
</span><span id="semantic_to_instance-983"><a href="#semantic_to_instance-983"><span class="linenos"> 983</span></a><span class="sd">    &gt;&gt;&gt; print(instance_stack)</span>
</span><span id="semantic_to_instance-984"><a href="#semantic_to_instance-984"><span class="linenos"> 984</span></a><span class="sd">    InstanceImageStack(name=&#39;example_instance_stack&#39;, metadata=MetaData(data_volume=DataVolume(z_image_count=10, y_height=256, x_width=256), resolution=Resolution(dx=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dy=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dz=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), pixel_units=&lt;Units.MICRON: &#39;micron&#39;&gt;, origin=Origin(x0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), y0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), z0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))), data=array(...), nlabels=..., min_feature_size=10)</span>
</span><span id="semantic_to_instance-985"><a href="#semantic_to_instance-985"><span class="linenos"> 985</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="semantic_to_instance-986"><a href="#semantic_to_instance-986"><span class="linenos"> 986</span></a>
</span><span id="semantic_to_instance-987"><a href="#semantic_to_instance-987"><span class="linenos"> 987</span></a>    <span class="c1"># Create a boolean mask of the array</span>
</span><span id="semantic_to_instance-988"><a href="#semantic_to_instance-988"><span class="linenos"> 988</span></a>    <span class="n">masked_stack</span> <span class="o">=</span> <span class="n">semantic_stack</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">instance_value</span>
</span><span id="semantic_to_instance-989"><a href="#semantic_to_instance-989"><span class="linenos"> 989</span></a>
</span><span id="semantic_to_instance-990"><a href="#semantic_to_instance-990"><span class="linenos"> 990</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">labelling connected components in &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="semantic_to_instance-991"><a href="#semantic_to_instance-991"><span class="linenos"> 991</span></a>
</span><span id="semantic_to_instance-992"><a href="#semantic_to_instance-992"><span class="linenos"> 992</span></a>    <span class="c1"># Use cc3d for connected components labeling</span>
</span><span id="semantic_to_instance-993"><a href="#semantic_to_instance-993"><span class="linenos"> 993</span></a>    <span class="n">cc3d_instance_stack</span><span class="p">,</span> <span class="n">cc3d_nlabels</span> <span class="o">=</span> <span class="n">cc3d</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span>
</span><span id="semantic_to_instance-994"><a href="#semantic_to_instance-994"><span class="linenos"> 994</span></a>        <span class="n">masked_stack</span><span class="p">,</span>
</span><span id="semantic_to_instance-995"><a href="#semantic_to_instance-995"><span class="linenos"> 995</span></a>        <span class="n">connectivity</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">CC3DConnectivity</span><span class="o">.</span><span class="n">FACE_NEIGHBORS</span><span class="p">,</span>
</span><span id="semantic_to_instance-996"><a href="#semantic_to_instance-996"><span class="linenos"> 996</span></a>        <span class="n">return_N</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="semantic_to_instance-997"><a href="#semantic_to_instance-997"><span class="linenos"> 997</span></a>    <span class="p">)</span>
</span><span id="semantic_to_instance-998"><a href="#semantic_to_instance-998"><span class="linenos"> 998</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="semantic_to_instance-999"><a href="#semantic_to_instance-999"><span class="linenos"> 999</span></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">with cc3d package, found </span><span class="si">{</span><span class="n">cc3d_nlabels</span><span class="si">}</span><span class="s2"> connected components in &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="semantic_to_instance-1000"><a href="#semantic_to_instance-1000"><span class="linenos">1000</span></a>    <span class="p">)</span>
</span><span id="semantic_to_instance-1001"><a href="#semantic_to_instance-1001"><span class="linenos">1001</span></a>    <span class="k">return</span> <span class="n">InstanceImageStack</span><span class="p">(</span>
</span><span id="semantic_to_instance-1002"><a href="#semantic_to_instance-1002"><span class="linenos">1002</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">instance_name</span><span class="p">,</span>
</span><span id="semantic_to_instance-1003"><a href="#semantic_to_instance-1003"><span class="linenos">1003</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">cc3d_instance_stack</span><span class="p">,</span>
</span><span id="semantic_to_instance-1004"><a href="#semantic_to_instance-1004"><span class="linenos">1004</span></a>        <span class="n">metadata</span><span class="o">=</span><span class="n">semantic_stack</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
</span><span id="semantic_to_instance-1005"><a href="#semantic_to_instance-1005"><span class="linenos">1005</span></a>        <span class="n">nlabels</span><span class="o">=</span><span class="n">cc3d_nlabels</span><span class="p">,</span>
</span><span id="semantic_to_instance-1006"><a href="#semantic_to_instance-1006"><span class="linenos">1006</span></a>        <span class="n">min_feature_size</span><span class="o">=</span><span class="n">min_feature_size</span><span class="p">,</span>
</span><span id="semantic_to_instance-1007"><a href="#semantic_to_instance-1007"><span class="linenos">1007</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Isolate each unique class in the semantic segmentation (e.g., Cats or Dogs)
and create the Instance Image Stacks.</p>

<h2 id="parameters">Parameters</h2>

<p>semantic_stack : SemanticImageStack
    The semantic image stack containing the segmented data.
instance_name : str
    The name for the instance image stack.
instance_value : int
    The value in the semantic stack representing the class to isolate.
min_feature_size : int
    The minimum feature size to retain in the instance image stack.</p>

<h2 id="returns">Returns</h2>

<p>InstanceImageStack
    The instance image stack with isolated features.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">semantic_stack</span> <span class="o">=</span> <span class="n">SemanticImageStack</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_semantic_stack&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">metadata</span><span class="o">=</span><span class="n">MetaData</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">data_volume</span><span class="o">=</span><span class="n">DataVolume</span><span class="p">(</span><span class="n">z_image_count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">y_height</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">x_width</span><span class="o">=</span><span class="mi">256</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">resolution</span><span class="o">=</span><span class="n">Resolution</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">pixel_units</span><span class="o">=</span><span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">origin</span><span class="o">=</span><span class="n">Origin</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance_stack</span> <span class="o">=</span> <span class="n">semantic_to_instance</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">semantic_stack</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">instance_name</span><span class="o">=</span><span class="s2">&quot;example_instance_stack&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">instance_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">min_feature_size</span><span class="o">=</span><span class="mi">10</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">instance_stack</span><span class="p">)</span>
<span class="go">InstanceImageStack(name=&#39;example_instance_stack&#39;, metadata=MetaData(data_volume=DataVolume(z_image_count=10, y_height=256, x_width=256), resolution=Resolution(dx=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dy=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), dz=Length(value=1.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), pixel_units=&lt;Units.MICRON: &#39;micron&#39;&gt;, origin=Origin(x0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), y0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), z0=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))), data=array(...), nlabels=..., min_feature_size=10)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="instance_analysis_included">
                            <input id="instance_analysis_included-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">instance_analysis_included</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">key</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="instance_analysis_included-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#instance_analysis_included"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="instance_analysis_included-1014"><a href="#instance_analysis_included-1014"><span class="linenos">1014</span></a><span class="k">def</span><span class="w"> </span><span class="nf">instance_analysis_included</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="instance_analysis_included-1015"><a href="#instance_analysis_included-1015"><span class="linenos">1015</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="instance_analysis_included-1016"><a href="#instance_analysis_included-1016"><span class="linenos">1016</span></a><span class="sd">    Checks YAML settings to determine if instance analysis should be performed.</span>
</span><span id="instance_analysis_included-1017"><a href="#instance_analysis_included-1017"><span class="linenos">1017</span></a>
</span><span id="instance_analysis_included-1018"><a href="#instance_analysis_included-1018"><span class="linenos">1018</span></a><span class="sd">    This function checks the provided settings dictionary to see if instance analysis</span>
</span><span id="instance_analysis_included-1019"><a href="#instance_analysis_included-1019"><span class="linenos">1019</span></a><span class="sd">    is included for the specified key.</span>
</span><span id="instance_analysis_included-1020"><a href="#instance_analysis_included-1020"><span class="linenos">1020</span></a>
</span><span id="instance_analysis_included-1021"><a href="#instance_analysis_included-1021"><span class="linenos">1021</span></a><span class="sd">    Parameters</span>
</span><span id="instance_analysis_included-1022"><a href="#instance_analysis_included-1022"><span class="linenos">1022</span></a><span class="sd">    ----------</span>
</span><span id="instance_analysis_included-1023"><a href="#instance_analysis_included-1023"><span class="linenos">1023</span></a><span class="sd">    settings : dict</span>
</span><span id="instance_analysis_included-1024"><a href="#instance_analysis_included-1024"><span class="linenos">1024</span></a><span class="sd">        The settings dictionary, typically loaded from a YAML file.</span>
</span><span id="instance_analysis_included-1025"><a href="#instance_analysis_included-1025"><span class="linenos">1025</span></a><span class="sd">    key : str</span>
</span><span id="instance_analysis_included-1026"><a href="#instance_analysis_included-1026"><span class="linenos">1026</span></a><span class="sd">        The key representing the class label to check for instance analysis inclusion.</span>
</span><span id="instance_analysis_included-1027"><a href="#instance_analysis_included-1027"><span class="linenos">1027</span></a>
</span><span id="instance_analysis_included-1028"><a href="#instance_analysis_included-1028"><span class="linenos">1028</span></a><span class="sd">    Returns</span>
</span><span id="instance_analysis_included-1029"><a href="#instance_analysis_included-1029"><span class="linenos">1029</span></a><span class="sd">    -------</span>
</span><span id="instance_analysis_included-1030"><a href="#instance_analysis_included-1030"><span class="linenos">1030</span></a><span class="sd">    bool</span>
</span><span id="instance_analysis_included-1031"><a href="#instance_analysis_included-1031"><span class="linenos">1031</span></a><span class="sd">        True if instance analysis is included for the specified key, False otherwise.</span>
</span><span id="instance_analysis_included-1032"><a href="#instance_analysis_included-1032"><span class="linenos">1032</span></a>
</span><span id="instance_analysis_included-1033"><a href="#instance_analysis_included-1033"><span class="linenos">1033</span></a><span class="sd">    Examples</span>
</span><span id="instance_analysis_included-1034"><a href="#instance_analysis_included-1034"><span class="linenos">1034</span></a><span class="sd">    --------</span>
</span><span id="instance_analysis_included-1035"><a href="#instance_analysis_included-1035"><span class="linenos">1035</span></a><span class="sd">    &gt;&gt;&gt; settings = {</span>
</span><span id="instance_analysis_included-1036"><a href="#instance_analysis_included-1036"><span class="linenos">1036</span></a><span class="sd">    ...     &quot;class_labels&quot;: {</span>
</span><span id="instance_analysis_included-1037"><a href="#instance_analysis_included-1037"><span class="linenos">1037</span></a><span class="sd">    ...         &quot;cat&quot;: {</span>
</span><span id="instance_analysis_included-1038"><a href="#instance_analysis_included-1038"><span class="linenos">1038</span></a><span class="sd">    ...             &quot;instance_analysis&quot;: {</span>
</span><span id="instance_analysis_included-1039"><a href="#instance_analysis_included-1039"><span class="linenos">1039</span></a><span class="sd">    ...                 &quot;include&quot;: True</span>
</span><span id="instance_analysis_included-1040"><a href="#instance_analysis_included-1040"><span class="linenos">1040</span></a><span class="sd">    ...             }</span>
</span><span id="instance_analysis_included-1041"><a href="#instance_analysis_included-1041"><span class="linenos">1041</span></a><span class="sd">    ...         },</span>
</span><span id="instance_analysis_included-1042"><a href="#instance_analysis_included-1042"><span class="linenos">1042</span></a><span class="sd">    ...         &quot;dog&quot;: {</span>
</span><span id="instance_analysis_included-1043"><a href="#instance_analysis_included-1043"><span class="linenos">1043</span></a><span class="sd">    ...             &quot;instance_analysis&quot;: {</span>
</span><span id="instance_analysis_included-1044"><a href="#instance_analysis_included-1044"><span class="linenos">1044</span></a><span class="sd">    ...                 &quot;include&quot;: False</span>
</span><span id="instance_analysis_included-1045"><a href="#instance_analysis_included-1045"><span class="linenos">1045</span></a><span class="sd">    ...             }</span>
</span><span id="instance_analysis_included-1046"><a href="#instance_analysis_included-1046"><span class="linenos">1046</span></a><span class="sd">    ...         }</span>
</span><span id="instance_analysis_included-1047"><a href="#instance_analysis_included-1047"><span class="linenos">1047</span></a><span class="sd">    ...     }</span>
</span><span id="instance_analysis_included-1048"><a href="#instance_analysis_included-1048"><span class="linenos">1048</span></a><span class="sd">    ... }</span>
</span><span id="instance_analysis_included-1049"><a href="#instance_analysis_included-1049"><span class="linenos">1049</span></a><span class="sd">    &gt;&gt;&gt; instance_analysis_included(settings, &quot;cat&quot;)</span>
</span><span id="instance_analysis_included-1050"><a href="#instance_analysis_included-1050"><span class="linenos">1050</span></a><span class="sd">    True</span>
</span><span id="instance_analysis_included-1051"><a href="#instance_analysis_included-1051"><span class="linenos">1051</span></a><span class="sd">    &gt;&gt;&gt; instance_analysis_included(settings, &quot;dog&quot;)</span>
</span><span id="instance_analysis_included-1052"><a href="#instance_analysis_included-1052"><span class="linenos">1052</span></a><span class="sd">    False</span>
</span><span id="instance_analysis_included-1053"><a href="#instance_analysis_included-1053"><span class="linenos">1053</span></a><span class="sd">    &gt;&gt;&gt; instance_analysis_included(settings, &quot;bird&quot;)</span>
</span><span id="instance_analysis_included-1054"><a href="#instance_analysis_included-1054"><span class="linenos">1054</span></a><span class="sd">    False</span>
</span><span id="instance_analysis_included-1055"><a href="#instance_analysis_included-1055"><span class="linenos">1055</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="instance_analysis_included-1056"><a href="#instance_analysis_included-1056"><span class="linenos">1056</span></a>
</span><span id="instance_analysis_included-1057"><a href="#instance_analysis_included-1057"><span class="linenos">1057</span></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;class_labels&quot;</span><span class="p">]</span>
</span><span id="instance_analysis_included-1058"><a href="#instance_analysis_included-1058"><span class="linenos">1058</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="instance_analysis_included-1059"><a href="#instance_analysis_included-1059"><span class="linenos">1059</span></a>        <span class="k">return</span> <span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;instance_analysis&quot;</span><span class="p">][</span><span class="s2">&quot;include&quot;</span><span class="p">]</span>
</span><span id="instance_analysis_included-1060"><a href="#instance_analysis_included-1060"><span class="linenos">1060</span></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="instance_analysis_included-1061"><a href="#instance_analysis_included-1061"><span class="linenos">1061</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Checks YAML settings to determine if instance analysis should be performed.</p>

<p>This function checks the provided settings dictionary to see if instance analysis
is included for the specified key.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The settings dictionary, typically loaded from a YAML file.
key : str
    The key representing the class label to check for instance analysis inclusion.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if instance analysis is included for the specified key, False otherwise.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;class_labels&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;cat&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;instance_analysis&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="gp">... </span>            <span class="p">}</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;dog&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;instance_analysis&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="kc">False</span>
<span class="gp">... </span>            <span class="p">}</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance_analysis_included</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance_analysis_included</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance_analysis_included</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;bird&quot;</span><span class="p">)</span>
<span class="go">False</span>
</code></pre>
</div>
</div>


                </section>
                <section id="instance_properties">
                            <input id="instance_properties-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">instance_properties</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">instance_stack</span><span class="p">:</span> <span class="n"><a href="types.html#InstanceImageStack">recon3d.types.InstanceImageStack</a></span>,</span><span class="param">	<span class="n">inst_indices</span><span class="p">:</span> <span class="n"><a href="types.html#InstanceIndices">recon3d.types.InstanceIndices</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#InstanceProperties">recon3d.types.InstanceProperties</a></span>:</span></span>

                <label class="view-source-button" for="instance_properties-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#instance_properties"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="instance_properties-1064"><a href="#instance_properties-1064"><span class="linenos">1064</span></a><span class="k">def</span><span class="w"> </span><span class="nf">instance_properties</span><span class="p">(</span>
</span><span id="instance_properties-1065"><a href="#instance_properties-1065"><span class="linenos">1065</span></a>    <span class="n">instance_stack</span><span class="p">:</span> <span class="n">InstanceImageStack</span><span class="p">,</span>
</span><span id="instance_properties-1066"><a href="#instance_properties-1066"><span class="linenos">1066</span></a>    <span class="n">inst_indices</span><span class="p">:</span> <span class="n">InstanceIndices</span><span class="p">,</span>
</span><span id="instance_properties-1067"><a href="#instance_properties-1067"><span class="linenos">1067</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InstanceProperties</span><span class="p">:</span>
</span><span id="instance_properties-1068"><a href="#instance_properties-1068"><span class="linenos">1068</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="instance_properties-1069"><a href="#instance_properties-1069"><span class="linenos">1069</span></a><span class="sd">    Calculate various properties for each instance in an InstanceImageStack.</span>
</span><span id="instance_properties-1070"><a href="#instance_properties-1070"><span class="linenos">1070</span></a>
</span><span id="instance_properties-1071"><a href="#instance_properties-1071"><span class="linenos">1071</span></a><span class="sd">    Parameters</span>
</span><span id="instance_properties-1072"><a href="#instance_properties-1072"><span class="linenos">1072</span></a><span class="sd">    ----------</span>
</span><span id="instance_properties-1073"><a href="#instance_properties-1073"><span class="linenos">1073</span></a><span class="sd">    instance_stack : InstanceImageStack</span>
</span><span id="instance_properties-1074"><a href="#instance_properties-1074"><span class="linenos">1074</span></a><span class="sd">        The instance image stack containing the segmented data.</span>
</span><span id="instance_properties-1075"><a href="#instance_properties-1075"><span class="linenos">1075</span></a><span class="sd">    inst_indices : InstanceIndices</span>
</span><span id="instance_properties-1076"><a href="#instance_properties-1076"><span class="linenos">1076</span></a><span class="sd">        The instance indices containing the indices of each instance.</span>
</span><span id="instance_properties-1077"><a href="#instance_properties-1077"><span class="linenos">1077</span></a>
</span><span id="instance_properties-1078"><a href="#instance_properties-1078"><span class="linenos">1078</span></a><span class="sd">    Returns</span>
</span><span id="instance_properties-1079"><a href="#instance_properties-1079"><span class="linenos">1079</span></a><span class="sd">    -------</span>
</span><span id="instance_properties-1080"><a href="#instance_properties-1080"><span class="linenos">1080</span></a><span class="sd">    InstanceProperties</span>
</span><span id="instance_properties-1081"><a href="#instance_properties-1081"><span class="linenos">1081</span></a><span class="sd">        The properties of each instance, including number of voxels, equivalent spherical diameters,</span>
</span><span id="instance_properties-1082"><a href="#instance_properties-1082"><span class="linenos">1082</span></a><span class="sd">        centroids, ellipsoids, surface areas, and volumes.</span>
</span><span id="instance_properties-1083"><a href="#instance_properties-1083"><span class="linenos">1083</span></a>
</span><span id="instance_properties-1084"><a href="#instance_properties-1084"><span class="linenos">1084</span></a><span class="sd">    Examples</span>
</span><span id="instance_properties-1085"><a href="#instance_properties-1085"><span class="linenos">1085</span></a><span class="sd">    --------</span>
</span><span id="instance_properties-1086"><a href="#instance_properties-1086"><span class="linenos">1086</span></a><span class="sd">    &gt;&gt;&gt; instance_stack = InstanceImageStack(</span>
</span><span id="instance_properties-1087"><a href="#instance_properties-1087"><span class="linenos">1087</span></a><span class="sd">    ...     name=&quot;example_instance_stack&quot;,</span>
</span><span id="instance_properties-1088"><a href="#instance_properties-1088"><span class="linenos">1088</span></a><span class="sd">    ...     metadata=MetaData(</span>
</span><span id="instance_properties-1089"><a href="#instance_properties-1089"><span class="linenos">1089</span></a><span class="sd">    ...         data_volume=DataVolume(z_image_count=10, y_height=256, x_width=256),</span>
</span><span id="instance_properties-1090"><a href="#instance_properties-1090"><span class="linenos">1090</span></a><span class="sd">    ...         resolution=Resolution(</span>
</span><span id="instance_properties-1091"><a href="#instance_properties-1091"><span class="linenos">1091</span></a><span class="sd">    ...             dx=Length(1.0, Units.MICRON),</span>
</span><span id="instance_properties-1092"><a href="#instance_properties-1092"><span class="linenos">1092</span></a><span class="sd">    ...             dy=Length(1.0, Units.MICRON),</span>
</span><span id="instance_properties-1093"><a href="#instance_properties-1093"><span class="linenos">1093</span></a><span class="sd">    ...             dz=Length(1.0, Units.MICRON)</span>
</span><span id="instance_properties-1094"><a href="#instance_properties-1094"><span class="linenos">1094</span></a><span class="sd">    ...         ),</span>
</span><span id="instance_properties-1095"><a href="#instance_properties-1095"><span class="linenos">1095</span></a><span class="sd">    ...         pixel_units=Units.MICRON,</span>
</span><span id="instance_properties-1096"><a href="#instance_properties-1096"><span class="linenos">1096</span></a><span class="sd">    ...         origin=Origin(</span>
</span><span id="instance_properties-1097"><a href="#instance_properties-1097"><span class="linenos">1097</span></a><span class="sd">    ...             x0=Length(0.0, Units.MICRON),</span>
</span><span id="instance_properties-1098"><a href="#instance_properties-1098"><span class="linenos">1098</span></a><span class="sd">    ...             y0=Length(0.0, Units.MICRON),</span>
</span><span id="instance_properties-1099"><a href="#instance_properties-1099"><span class="linenos">1099</span></a><span class="sd">    ...             z0=Length(0.0, Units.MICRON)</span>
</span><span id="instance_properties-1100"><a href="#instance_properties-1100"><span class="linenos">1100</span></a><span class="sd">    ...         )</span>
</span><span id="instance_properties-1101"><a href="#instance_properties-1101"><span class="linenos">1101</span></a><span class="sd">    ...     ),</span>
</span><span id="instance_properties-1102"><a href="#instance_properties-1102"><span class="linenos">1102</span></a><span class="sd">    ...     data=np.random.randint(0, 2, (10, 256, 256)),</span>
</span><span id="instance_properties-1103"><a href="#instance_properties-1103"><span class="linenos">1103</span></a><span class="sd">    ...     nlabels=3,</span>
</span><span id="instance_properties-1104"><a href="#instance_properties-1104"><span class="linenos">1104</span></a><span class="sd">    ...     min_feature_size=2</span>
</span><span id="instance_properties-1105"><a href="#instance_properties-1105"><span class="linenos">1105</span></a><span class="sd">    ... )</span>
</span><span id="instance_properties-1106"><a href="#instance_properties-1106"><span class="linenos">1106</span></a><span class="sd">    &gt;&gt;&gt; inst_indices = InstanceIndices(</span>
</span><span id="instance_properties-1107"><a href="#instance_properties-1107"><span class="linenos">1107</span></a><span class="sd">    ...     source_name=&quot;example_instance_stack&quot;,</span>
</span><span id="instance_properties-1108"><a href="#instance_properties-1108"><span class="linenos">1108</span></a><span class="sd">    ...     indices=[np.array([[0, 0], [1, 1]]), np.array([[0, 1], [1, 2]])],</span>
</span><span id="instance_properties-1109"><a href="#instance_properties-1109"><span class="linenos">1109</span></a><span class="sd">    ...     labels=InstanceLabels(data=np.array([1, 2]))</span>
</span><span id="instance_properties-1110"><a href="#instance_properties-1110"><span class="linenos">1110</span></a><span class="sd">    ... )</span>
</span><span id="instance_properties-1111"><a href="#instance_properties-1111"><span class="linenos">1111</span></a><span class="sd">    &gt;&gt;&gt; properties = instance_properties(instance_stack, inst_indices)</span>
</span><span id="instance_properties-1112"><a href="#instance_properties-1112"><span class="linenos">1112</span></a><span class="sd">    &gt;&gt;&gt; print(properties)</span>
</span><span id="instance_properties-1113"><a href="#instance_properties-1113"><span class="linenos">1113</span></a><span class="sd">    InstanceProperties(source_name=&#39;example_instance_stack&#39;, labels=InstanceLabels(data=array([1, 2])), n_voxels=[NVoxel(value=0), NVoxel(value=2), NVoxel(value=2)], equivalent_sphere_diameters=[Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)], centroids=Centroids(data=[Centroid(cx=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), Centroid(cx=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), Centroid(cx=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))]), ellipsoids=BestFitEllipsoids(data=[BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0))]), BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=1.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=1.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=1.0))]), BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=1.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=1.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=1.0))])]), surface_areas=EllipsoidSurfaceAreas(data=[Area(value=0.0, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;), Area(value=19.739208802178716, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;), Area(value=19.739208802178716, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;)]), volumes=EllipsoidVolumes(data=[Volume(value=0.0, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;), Volume(value=4.1887902047863905, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;), Volume(value=4.1887902047863905, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;)]))</span>
</span><span id="instance_properties-1114"><a href="#instance_properties-1114"><span class="linenos">1114</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="instance_properties-1115"><a href="#instance_properties-1115"><span class="linenos">1115</span></a>
</span><span id="instance_properties-1116"><a href="#instance_properties-1116"><span class="linenos">1116</span></a>    <span class="n">num_labels</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">nlabels</span>
</span><span id="instance_properties-1117"><a href="#instance_properties-1117"><span class="linenos">1117</span></a>    <span class="c1"># feature 0 is the background, and we want to include the last label</span>
</span><span id="instance_properties-1118"><a href="#instance_properties-1118"><span class="linenos">1118</span></a>    <span class="n">stack_n_voxels</span> <span class="o">=</span> <span class="n">num_voxels</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">inst_indices</span><span class="p">)</span>
</span><span id="instance_properties-1119"><a href="#instance_properties-1119"><span class="linenos">1119</span></a>    <span class="n">stack_eq_diameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="instance_properties-1120"><a href="#instance_properties-1120"><span class="linenos">1120</span></a>    <span class="n">stack_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="instance_properties-1121"><a href="#instance_properties-1121"><span class="linenos">1121</span></a>    <span class="n">stack_ellipsoids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="instance_properties-1122"><a href="#instance_properties-1122"><span class="linenos">1122</span></a>    <span class="n">stack_surface_areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="instance_properties-1123"><a href="#instance_properties-1123"><span class="linenos">1123</span></a>    <span class="n">stack_volumes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="instance_properties-1124"><a href="#instance_properties-1124"><span class="linenos">1124</span></a>
</span><span id="instance_properties-1125"><a href="#instance_properties-1125"><span class="linenos">1125</span></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="instance_properties-1126"><a href="#instance_properties-1126"><span class="linenos">1126</span></a>    <span class="n">origin</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">origin</span>
</span><span id="instance_properties-1127"><a href="#instance_properties-1127"><span class="linenos">1127</span></a>
</span><span id="instance_properties-1128"><a href="#instance_properties-1128"><span class="linenos">1128</span></a>    <span class="c1"># null types</span>
</span><span id="instance_properties-1129"><a href="#instance_properties-1129"><span class="linenos">1129</span></a>    <span class="n">null_length</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</span><span id="instance_properties-1130"><a href="#instance_properties-1130"><span class="linenos">1130</span></a>    <span class="n">null_area</span> <span class="o">=</span> <span class="n">Area</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">unit_squared</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</span><span id="instance_properties-1131"><a href="#instance_properties-1131"><span class="linenos">1131</span></a>    <span class="n">null_volume</span> <span class="o">=</span> <span class="n">Volume</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">unit_cubed</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</span><span id="instance_properties-1132"><a href="#instance_properties-1132"><span class="linenos">1132</span></a>    <span class="n">null_axis</span> <span class="o">=</span> <span class="n">EllipsoidAxis</span><span class="p">(</span>
</span><span id="instance_properties-1133"><a href="#instance_properties-1133"><span class="linenos">1133</span></a>        <span class="n">length</span><span class="o">=</span><span class="n">null_length</span><span class="p">,</span>
</span><span id="instance_properties-1134"><a href="#instance_properties-1134"><span class="linenos">1134</span></a>        <span class="n">orientation</span><span class="o">=</span><span class="n">UnitVector</span><span class="p">(</span>
</span><span id="instance_properties-1135"><a href="#instance_properties-1135"><span class="linenos">1135</span></a>            <span class="n">u</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="instance_properties-1136"><a href="#instance_properties-1136"><span class="linenos">1136</span></a>            <span class="n">v</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="instance_properties-1137"><a href="#instance_properties-1137"><span class="linenos">1137</span></a>            <span class="n">w</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="instance_properties-1138"><a href="#instance_properties-1138"><span class="linenos">1138</span></a>        <span class="p">),</span>
</span><span id="instance_properties-1139"><a href="#instance_properties-1139"><span class="linenos">1139</span></a>    <span class="p">)</span>
</span><span id="instance_properties-1140"><a href="#instance_properties-1140"><span class="linenos">1140</span></a>    <span class="c1"># set first entry to correct type of zero for feature 0</span>
</span><span id="instance_properties-1141"><a href="#instance_properties-1141"><span class="linenos">1141</span></a>    <span class="n">stack_n_voxels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">NVoxel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="instance_properties-1142"><a href="#instance_properties-1142"><span class="linenos">1142</span></a>    <span class="n">stack_eq_diameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">null_length</span>
</span><span id="instance_properties-1143"><a href="#instance_properties-1143"><span class="linenos">1143</span></a>    <span class="n">stack_centroids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Centroid</span><span class="p">(</span>
</span><span id="instance_properties-1144"><a href="#instance_properties-1144"><span class="linenos">1144</span></a>        <span class="n">cx</span><span class="o">=</span><span class="n">null_length</span><span class="p">,</span>
</span><span id="instance_properties-1145"><a href="#instance_properties-1145"><span class="linenos">1145</span></a>        <span class="n">cy</span><span class="o">=</span><span class="n">null_length</span><span class="p">,</span>
</span><span id="instance_properties-1146"><a href="#instance_properties-1146"><span class="linenos">1146</span></a>        <span class="n">cz</span><span class="o">=</span><span class="n">null_length</span><span class="p">,</span>
</span><span id="instance_properties-1147"><a href="#instance_properties-1147"><span class="linenos">1147</span></a>    <span class="p">)</span>
</span><span id="instance_properties-1148"><a href="#instance_properties-1148"><span class="linenos">1148</span></a>    <span class="n">stack_ellipsoids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">BestFitEllipsoid</span><span class="p">(</span>
</span><span id="instance_properties-1149"><a href="#instance_properties-1149"><span class="linenos">1149</span></a>        <span class="n">a</span><span class="o">=</span><span class="n">null_axis</span><span class="p">,</span>
</span><span id="instance_properties-1150"><a href="#instance_properties-1150"><span class="linenos">1150</span></a>        <span class="n">b</span><span class="o">=</span><span class="n">null_axis</span><span class="p">,</span>
</span><span id="instance_properties-1151"><a href="#instance_properties-1151"><span class="linenos">1151</span></a>        <span class="n">c</span><span class="o">=</span><span class="n">null_axis</span><span class="p">,</span>
</span><span id="instance_properties-1152"><a href="#instance_properties-1152"><span class="linenos">1152</span></a>    <span class="p">)</span>
</span><span id="instance_properties-1153"><a href="#instance_properties-1153"><span class="linenos">1153</span></a>    <span class="n">stack_surface_areas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">null_area</span>
</span><span id="instance_properties-1154"><a href="#instance_properties-1154"><span class="linenos">1154</span></a>    <span class="n">stack_volumes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">null_volume</span>
</span><span id="instance_properties-1155"><a href="#instance_properties-1155"><span class="linenos">1155</span></a>
</span><span id="instance_properties-1156"><a href="#instance_properties-1156"><span class="linenos">1156</span></a>    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="instance_properties-1157"><a href="#instance_properties-1157"><span class="linenos">1157</span></a>        <span class="k">if</span> <span class="p">((</span><span class="n">instance</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="instance_properties-1158"><a href="#instance_properties-1158"><span class="linenos">1158</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Analyzing feature </span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">num_labels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="instance_properties-1159"><a href="#instance_properties-1159"><span class="linenos">1159</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="n">inst_indices</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span>
</span><span id="instance_properties-1160"><a href="#instance_properties-1160"><span class="linenos">1160</span></a>        <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">stack_n_voxels</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="instance_properties-1161"><a href="#instance_properties-1161"><span class="linenos">1161</span></a>
</span><span id="instance_properties-1162"><a href="#instance_properties-1162"><span class="linenos">1162</span></a>        <span class="c1"># Equivalent spherical diameter</span>
</span><span id="instance_properties-1163"><a href="#instance_properties-1163"><span class="linenos">1163</span></a>        <span class="n">stack_eq_diameters</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">equivalent_spherical_diameter</span><span class="p">(</span>
</span><span id="instance_properties-1164"><a href="#instance_properties-1164"><span class="linenos">1164</span></a>            <span class="n">n_voxels</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="instance_properties-1165"><a href="#instance_properties-1165"><span class="linenos">1165</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="instance_properties-1166"><a href="#instance_properties-1166"><span class="linenos">1166</span></a>        <span class="p">)</span>
</span><span id="instance_properties-1167"><a href="#instance_properties-1167"><span class="linenos">1167</span></a>
</span><span id="instance_properties-1168"><a href="#instance_properties-1168"><span class="linenos">1168</span></a>        <span class="c1"># Centroid (real-space coordinates)</span>
</span><span id="instance_properties-1169"><a href="#instance_properties-1169"><span class="linenos">1169</span></a>        <span class="n">centroid</span> <span class="o">=</span> <span class="n">center_of_mass</span><span class="p">(</span>
</span><span id="instance_properties-1170"><a href="#instance_properties-1170"><span class="linenos">1170</span></a>            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
</span><span id="instance_properties-1171"><a href="#instance_properties-1171"><span class="linenos">1171</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="instance_properties-1172"><a href="#instance_properties-1172"><span class="linenos">1172</span></a>            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="instance_properties-1173"><a href="#instance_properties-1173"><span class="linenos">1173</span></a>        <span class="p">)</span>
</span><span id="instance_properties-1174"><a href="#instance_properties-1174"><span class="linenos">1174</span></a>        <span class="n">stack_centroids</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span>
</span><span id="instance_properties-1175"><a href="#instance_properties-1175"><span class="linenos">1175</span></a>
</span><span id="instance_properties-1176"><a href="#instance_properties-1176"><span class="linenos">1176</span></a>        <span class="c1"># Ellipsoid properties</span>
</span><span id="instance_properties-1177"><a href="#instance_properties-1177"><span class="linenos">1177</span></a>        <span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">fit_ellipsoid</span><span class="p">(</span>
</span><span id="instance_properties-1178"><a href="#instance_properties-1178"><span class="linenos">1178</span></a>            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
</span><span id="instance_properties-1179"><a href="#instance_properties-1179"><span class="linenos">1179</span></a>            <span class="n">centroid</span><span class="o">=</span><span class="n">centroid</span><span class="p">,</span>
</span><span id="instance_properties-1180"><a href="#instance_properties-1180"><span class="linenos">1180</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="instance_properties-1181"><a href="#instance_properties-1181"><span class="linenos">1181</span></a>            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="instance_properties-1182"><a href="#instance_properties-1182"><span class="linenos">1182</span></a>        <span class="p">)</span>
</span><span id="instance_properties-1183"><a href="#instance_properties-1183"><span class="linenos">1183</span></a>        <span class="n">stack_ellipsoids</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">ellipsoid</span>
</span><span id="instance_properties-1184"><a href="#instance_properties-1184"><span class="linenos">1184</span></a>
</span><span id="instance_properties-1185"><a href="#instance_properties-1185"><span class="linenos">1185</span></a>        <span class="n">surface_area</span> <span class="o">=</span> <span class="n">ellipsoid_surface_area</span><span class="p">(</span><span class="n">ellipsoid</span><span class="o">=</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="instance_properties-1186"><a href="#instance_properties-1186"><span class="linenos">1186</span></a>        <span class="n">stack_surface_areas</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_area</span>
</span><span id="instance_properties-1187"><a href="#instance_properties-1187"><span class="linenos">1187</span></a>
</span><span id="instance_properties-1188"><a href="#instance_properties-1188"><span class="linenos">1188</span></a>        <span class="n">volume</span> <span class="o">=</span> <span class="n">ellipsoid_volume</span><span class="p">(</span><span class="n">ellipsoid</span><span class="o">=</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="instance_properties-1189"><a href="#instance_properties-1189"><span class="linenos">1189</span></a>        <span class="n">stack_volumes</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span>
</span><span id="instance_properties-1190"><a href="#instance_properties-1190"><span class="linenos">1190</span></a>
</span><span id="instance_properties-1191"><a href="#instance_properties-1191"><span class="linenos">1191</span></a>    <span class="n">properties</span> <span class="o">=</span> <span class="n">InstanceProperties</span><span class="p">(</span>
</span><span id="instance_properties-1192"><a href="#instance_properties-1192"><span class="linenos">1192</span></a>        <span class="n">source_name</span><span class="o">=</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="instance_properties-1193"><a href="#instance_properties-1193"><span class="linenos">1193</span></a>        <span class="n">labels</span><span class="o">=</span><span class="n">inst_indices</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
</span><span id="instance_properties-1194"><a href="#instance_properties-1194"><span class="linenos">1194</span></a>        <span class="n">n_voxels</span><span class="o">=</span><span class="n">stack_n_voxels</span><span class="p">,</span>
</span><span id="instance_properties-1195"><a href="#instance_properties-1195"><span class="linenos">1195</span></a>        <span class="n">equivalent_sphere_diameters</span><span class="o">=</span><span class="n">stack_eq_diameters</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="instance_properties-1196"><a href="#instance_properties-1196"><span class="linenos">1196</span></a>        <span class="n">centroids</span><span class="o">=</span><span class="n">Centroids</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stack_centroids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span><span id="instance_properties-1197"><a href="#instance_properties-1197"><span class="linenos">1197</span></a>        <span class="n">ellipsoids</span><span class="o">=</span><span class="n">BestFitEllipsoids</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stack_ellipsoids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span><span id="instance_properties-1198"><a href="#instance_properties-1198"><span class="linenos">1198</span></a>        <span class="n">surface_areas</span><span class="o">=</span><span class="n">EllipsoidSurfaceAreas</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stack_surface_areas</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span><span id="instance_properties-1199"><a href="#instance_properties-1199"><span class="linenos">1199</span></a>        <span class="n">volumes</span><span class="o">=</span><span class="n">EllipsoidVolumes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stack_volumes</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span><span id="instance_properties-1200"><a href="#instance_properties-1200"><span class="linenos">1200</span></a>    <span class="p">)</span>
</span><span id="instance_properties-1201"><a href="#instance_properties-1201"><span class="linenos">1201</span></a>
</span><span id="instance_properties-1202"><a href="#instance_properties-1202"><span class="linenos">1202</span></a>    <span class="k">return</span> <span class="n">properties</span>
</span></pre></div>


            <div class="docstring"><p>Calculate various properties for each instance in an InstanceImageStack.</p>

<h2 id="parameters">Parameters</h2>

<p>instance_stack : InstanceImageStack
    The instance image stack containing the segmented data.
inst_indices : InstanceIndices
    The instance indices containing the indices of each instance.</p>

<h2 id="returns">Returns</h2>

<p>InstanceProperties
    The properties of each instance, including number of voxels, equivalent spherical diameters,
    centroids, ellipsoids, surface areas, and volumes.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">instance_stack</span> <span class="o">=</span> <span class="n">InstanceImageStack</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_instance_stack&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">metadata</span><span class="o">=</span><span class="n">MetaData</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">data_volume</span><span class="o">=</span><span class="n">DataVolume</span><span class="p">(</span><span class="n">z_image_count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">y_height</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">x_width</span><span class="o">=</span><span class="mi">256</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">resolution</span><span class="o">=</span><span class="n">Resolution</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">dx</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">dy</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">dz</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">pixel_units</span><span class="o">=</span><span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">origin</span><span class="o">=</span><span class="n">Origin</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">x0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">y0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">z0</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Units</span><span class="o">.</span><span class="n">MICRON</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">nlabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">min_feature_size</span><span class="o">=</span><span class="mi">2</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inst_indices</span> <span class="o">=</span> <span class="n">InstanceIndices</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">source_name</span><span class="o">=</span><span class="s2">&quot;example_instance_stack&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">indices</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])],</span>
<span class="gp">... </span>    <span class="n">labels</span><span class="o">=</span><span class="n">InstanceLabels</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">properties</span> <span class="o">=</span> <span class="n">instance_properties</span><span class="p">(</span><span class="n">instance_stack</span><span class="p">,</span> <span class="n">inst_indices</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
<span class="go">InstanceProperties(source_name=&#39;example_instance_stack&#39;, labels=InstanceLabels(data=array([1, 2])), n_voxels=[NVoxel(value=0), NVoxel(value=2), NVoxel(value=2)], equivalent_sphere_diameters=[Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)], centroids=Centroids(data=[Centroid(cx=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), Centroid(cx=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=0.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;)), Centroid(cx=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cy=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), cz=Length(value=1.5, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;))]), ellipsoids=BestFitEllipsoids(data=[BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=0.0))]), BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=1.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=1.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=1.0))]), BestFitEllipsoid(a=EllipsoidAxis(length=Length(value=1.240700981798799, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=1.0, v=0.0, w=0.0)), b=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=1.0, w=0.0)), c=EllipsoidAxis(length=Length(value=0.0, unit=&lt;Units.MICRON: &#39;micron&#39;&gt;), orientation=UnitVector(u=0.0, v=0.0, w=1.0))])]), surface_areas=EllipsoidSurfaceAreas(data=[Area(value=0.0, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;), Area(value=19.739208802178716, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;), Area(value=19.739208802178716, unit_squared=&lt;Units.MICRON: &#39;micron&#39;&gt;)]), volumes=EllipsoidVolumes(data=[Volume(value=0.0, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;), Volume(value=4.1887902047863905, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;), Volume(value=4.1887902047863905, unit_cubed=&lt;Units.MICRON: &#39;micron&#39;&gt;)]))</span>
</code></pre>
</div>
</div>


                </section>
                <section id="process">
                            <input id="process-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">yml_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="process-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#process"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="process-1205"><a href="#process-1205"><span class="linenos">1205</span></a><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">yml_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="process-1206"><a href="#process-1206"><span class="linenos">1206</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="process-1207"><a href="#process-1207"><span class="linenos">1207</span></a><span class="sd">    Processes a directory of images specified in a YAML file, creates a semantic image stack,</span>
</span><span id="process-1208"><a href="#process-1208"><span class="linenos">1208</span></a><span class="sd">    and performs instance analysis on all semantic label classes within the stack.</span>
</span><span id="process-1209"><a href="#process-1209"><span class="linenos">1209</span></a><span class="sd">    Saves all instance stacks and properties into an HDF5 file containing the original semantic image stack.</span>
</span><span id="process-1210"><a href="#process-1210"><span class="linenos">1210</span></a>
</span><span id="process-1211"><a href="#process-1211"><span class="linenos">1211</span></a><span class="sd">    Parameters</span>
</span><span id="process-1212"><a href="#process-1212"><span class="linenos">1212</span></a><span class="sd">    ----------</span>
</span><span id="process-1213"><a href="#process-1213"><span class="linenos">1213</span></a><span class="sd">    yml_file : Path</span>
</span><span id="process-1214"><a href="#process-1214"><span class="linenos">1214</span></a><span class="sd">        The fully pathed YAML file that specifies settings.</span>
</span><span id="process-1215"><a href="#process-1215"><span class="linenos">1215</span></a>
</span><span id="process-1216"><a href="#process-1216"><span class="linenos">1216</span></a><span class="sd">    Returns</span>
</span><span id="process-1217"><a href="#process-1217"><span class="linenos">1217</span></a><span class="sd">    -------</span>
</span><span id="process-1218"><a href="#process-1218"><span class="linenos">1218</span></a><span class="sd">    bool</span>
</span><span id="process-1219"><a href="#process-1219"><span class="linenos">1219</span></a><span class="sd">        True if the process was successful, False otherwise.</span>
</span><span id="process-1220"><a href="#process-1220"><span class="linenos">1220</span></a>
</span><span id="process-1221"><a href="#process-1221"><span class="linenos">1221</span></a><span class="sd">    Examples</span>
</span><span id="process-1222"><a href="#process-1222"><span class="linenos">1222</span></a><span class="sd">    --------</span>
</span><span id="process-1223"><a href="#process-1223"><span class="linenos">1223</span></a><span class="sd">    &gt;&gt;&gt; yml_file = Path(&quot;path/to/input.yml&quot;)</span>
</span><span id="process-1224"><a href="#process-1224"><span class="linenos">1224</span></a><span class="sd">    &gt;&gt;&gt; process(yml_file)</span>
</span><span id="process-1225"><a href="#process-1225"><span class="linenos">1225</span></a><span class="sd">    True</span>
</span><span id="process-1226"><a href="#process-1226"><span class="linenos">1226</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="process-1227"><a href="#process-1227"><span class="linenos">1227</span></a>
</span><span id="process-1228"><a href="#process-1228"><span class="linenos">1228</span></a>    <span class="n">semantic_stack</span> <span class="o">=</span> <span class="n">process_image_stack</span><span class="p">(</span><span class="n">yml_file</span><span class="p">)</span>
</span><span id="process-1229"><a href="#process-1229"><span class="linenos">1229</span></a>    <span class="n">n_semantic_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">semantic_stack</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="process-1230"><a href="#process-1230"><span class="linenos">1230</span></a>
</span><span id="process-1231"><a href="#process-1231"><span class="linenos">1231</span></a>    <span class="c1"># create h5</span>
</span><span id="process-1232"><a href="#process-1232"><span class="linenos">1232</span></a>    <span class="n">h5_path</span> <span class="o">=</span> <span class="n">hio</span><span class="o">.</span><span class="n">image_to_hdf</span><span class="p">(</span><span class="n">yml_file</span><span class="p">)</span>
</span><span id="process-1233"><a href="#process-1233"><span class="linenos">1233</span></a>
</span><span id="process-1234"><a href="#process-1234"><span class="linenos">1234</span></a>    <span class="c1"># start instance analysis</span>
</span><span id="process-1235"><a href="#process-1235"><span class="linenos">1235</span></a>    <span class="n">db</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">yml_file</span><span class="p">)</span>
</span><span id="process-1236"><a href="#process-1236"><span class="linenos">1236</span></a>    <span class="k">for</span> <span class="n">instance_name</span> <span class="ow">in</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;class_labels&quot;</span><span class="p">]:</span>
</span><span id="process-1237"><a href="#process-1237"><span class="linenos">1237</span></a>        <span class="c1"># # check yml values match the labels in the semantic image stack</span>
</span><span id="process-1238"><a href="#process-1238"><span class="linenos">1238</span></a>        <span class="c1"># for semantic_label in n_semantic_labels:</span>
</span><span id="process-1239"><a href="#process-1239"><span class="linenos">1239</span></a>
</span><span id="process-1240"><a href="#process-1240"><span class="linenos">1240</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance_analysis_included</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">instance_name</span><span class="p">):</span>
</span><span id="process-1241"><a href="#process-1241"><span class="linenos">1241</span></a>            <span class="k">continue</span>
</span><span id="process-1242"><a href="#process-1242"><span class="linenos">1242</span></a>
</span><span id="process-1243"><a href="#process-1243"><span class="linenos">1243</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analyzing &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; semantic label&quot;</span><span class="p">)</span>
</span><span id="process-1244"><a href="#process-1244"><span class="linenos">1244</span></a>
</span><span id="process-1245"><a href="#process-1245"><span class="linenos">1245</span></a>        <span class="c1"># create the instance_stacks</span>
</span><span id="process-1246"><a href="#process-1246"><span class="linenos">1246</span></a>        <span class="n">inst_stack</span> <span class="o">=</span> <span class="n">semantic_to_instance</span><span class="p">(</span>
</span><span id="process-1247"><a href="#process-1247"><span class="linenos">1247</span></a>            <span class="n">semantic_stack</span><span class="o">=</span><span class="n">semantic_stack</span><span class="p">,</span>
</span><span id="process-1248"><a href="#process-1248"><span class="linenos">1248</span></a>            <span class="n">instance_name</span><span class="o">=</span><span class="n">instance_name</span><span class="p">,</span>
</span><span id="process-1249"><a href="#process-1249"><span class="linenos">1249</span></a>            <span class="n">instance_value</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;class_labels&quot;</span><span class="p">][</span><span class="n">instance_name</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
</span><span id="process-1250"><a href="#process-1250"><span class="linenos">1250</span></a>            <span class="n">min_feature_size</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;class_labels&quot;</span><span class="p">][</span><span class="n">instance_name</span><span class="p">][</span><span class="s2">&quot;instance_analysis&quot;</span><span class="p">][</span>
</span><span id="process-1251"><a href="#process-1251"><span class="linenos">1251</span></a>                <span class="s2">&quot;min_feature_size&quot;</span>
</span><span id="process-1252"><a href="#process-1252"><span class="linenos">1252</span></a>            <span class="p">],</span>
</span><span id="process-1253"><a href="#process-1253"><span class="linenos">1253</span></a>        <span class="p">)</span>
</span><span id="process-1254"><a href="#process-1254"><span class="linenos">1254</span></a>
</span><span id="process-1255"><a href="#process-1255"><span class="linenos">1255</span></a>        <span class="c1"># get instance_indices</span>
</span><span id="process-1256"><a href="#process-1256"><span class="linenos">1256</span></a>        <span class="n">inst_indices</span> <span class="o">=</span> <span class="n">instance_indices</span><span class="p">(</span>
</span><span id="process-1257"><a href="#process-1257"><span class="linenos">1257</span></a>            <span class="n">instance_stack</span><span class="o">=</span><span class="n">inst_stack</span><span class="p">,</span>
</span><span id="process-1258"><a href="#process-1258"><span class="linenos">1258</span></a>        <span class="p">)</span>
</span><span id="process-1259"><a href="#process-1259"><span class="linenos">1259</span></a>        <span class="k">if</span> <span class="n">inst_stack</span><span class="o">.</span><span class="n">min_feature_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="process-1260"><a href="#process-1260"><span class="linenos">1260</span></a>            <span class="c1"># overwrites instance_stack and inst_indices</span>
</span><span id="process-1261"><a href="#process-1261"><span class="linenos">1261</span></a>            <span class="n">inst_stack</span><span class="p">,</span> <span class="n">inst_indices</span> <span class="o">=</span> <span class="n">minimum_size_filter</span><span class="p">(</span>
</span><span id="process-1262"><a href="#process-1262"><span class="linenos">1262</span></a>                <span class="n">initial_stack</span><span class="o">=</span><span class="n">inst_stack</span><span class="p">,</span>
</span><span id="process-1263"><a href="#process-1263"><span class="linenos">1263</span></a>                <span class="n">initial_indices</span><span class="o">=</span><span class="n">inst_indices</span><span class="p">,</span>
</span><span id="process-1264"><a href="#process-1264"><span class="linenos">1264</span></a>            <span class="p">)</span>
</span><span id="process-1265"><a href="#process-1265"><span class="linenos">1265</span></a>
</span><span id="process-1266"><a href="#process-1266"><span class="linenos">1266</span></a>        <span class="c1"># add to h5</span>
</span><span id="process-1267"><a href="#process-1267"><span class="linenos">1267</span></a>        <span class="n">hio</span><span class="o">.</span><span class="n">add_to_h5</span><span class="p">(</span>
</span><span id="process-1268"><a href="#process-1268"><span class="linenos">1268</span></a>            <span class="n">inst_stack</span><span class="p">,</span>
</span><span id="process-1269"><a href="#process-1269"><span class="linenos">1269</span></a>            <span class="n">h5_path</span><span class="o">=</span><span class="n">h5_path</span><span class="p">,</span>
</span><span id="process-1270"><a href="#process-1270"><span class="linenos">1270</span></a>            <span class="n">h5_group</span><span class="o">=</span><span class="s2">&quot;VoxelData&quot;</span><span class="p">,</span>
</span><span id="process-1271"><a href="#process-1271"><span class="linenos">1271</span></a>        <span class="p">)</span>
</span><span id="process-1272"><a href="#process-1272"><span class="linenos">1272</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">labelled &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; voxel data added&quot;</span><span class="p">)</span>
</span><span id="process-1273"><a href="#process-1273"><span class="linenos">1273</span></a>
</span><span id="process-1274"><a href="#process-1274"><span class="linenos">1274</span></a>        <span class="c1"># TODO not implemented instance indices yet</span>
</span><span id="process-1275"><a href="#process-1275"><span class="linenos">1275</span></a>        <span class="c1"># hio.add_to_h5(</span>
</span><span id="process-1276"><a href="#process-1276"><span class="linenos">1276</span></a>        <span class="c1">#     inst_indices,</span>
</span><span id="process-1277"><a href="#process-1277"><span class="linenos">1277</span></a>        <span class="c1">#     h5_path=h5_path,</span>
</span><span id="process-1278"><a href="#process-1278"><span class="linenos">1278</span></a>        <span class="c1">#     h5_group=f&quot;{instance_name}&quot;,</span>
</span><span id="process-1279"><a href="#process-1279"><span class="linenos">1279</span></a>        <span class="c1"># )</span>
</span><span id="process-1280"><a href="#process-1280"><span class="linenos">1280</span></a>
</span><span id="process-1281"><a href="#process-1281"><span class="linenos">1281</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">calculating &#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; instance properties...&quot;</span><span class="p">)</span>
</span><span id="process-1282"><a href="#process-1282"><span class="linenos">1282</span></a>        <span class="c1"># calculate indepedendent feature properties</span>
</span><span id="process-1283"><a href="#process-1283"><span class="linenos">1283</span></a>        <span class="n">inst_properties</span> <span class="o">=</span> <span class="n">instance_properties</span><span class="p">(</span>
</span><span id="process-1284"><a href="#process-1284"><span class="linenos">1284</span></a>            <span class="n">instance_stack</span><span class="o">=</span><span class="n">inst_stack</span><span class="p">,</span>
</span><span id="process-1285"><a href="#process-1285"><span class="linenos">1285</span></a>            <span class="n">inst_indices</span><span class="o">=</span><span class="n">inst_indices</span><span class="p">,</span>
</span><span id="process-1286"><a href="#process-1286"><span class="linenos">1286</span></a>        <span class="p">)</span>
</span><span id="process-1287"><a href="#process-1287"><span class="linenos">1287</span></a>
</span><span id="process-1288"><a href="#process-1288"><span class="linenos">1288</span></a>        <span class="c1"># add to h5</span>
</span><span id="process-1289"><a href="#process-1289"><span class="linenos">1289</span></a>        <span class="n">hio</span><span class="o">.</span><span class="n">add_to_h5</span><span class="p">(</span>
</span><span id="process-1290"><a href="#process-1290"><span class="linenos">1290</span></a>            <span class="n">inst_properties</span><span class="p">,</span>
</span><span id="process-1291"><a href="#process-1291"><span class="linenos">1291</span></a>            <span class="n">h5_path</span><span class="o">=</span><span class="n">h5_path</span><span class="p">,</span>
</span><span id="process-1292"><a href="#process-1292"><span class="linenos">1292</span></a>            <span class="n">h5_group</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="process-1293"><a href="#process-1293"><span class="linenos">1293</span></a>        <span class="p">)</span>
</span><span id="process-1294"><a href="#process-1294"><span class="linenos">1294</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; instance property data added&quot;</span><span class="p">)</span>
</span><span id="process-1295"><a href="#process-1295"><span class="linenos">1295</span></a>
</span><span id="process-1296"><a href="#process-1296"><span class="linenos">1296</span></a>        <span class="n">nearest_neighbors</span> <span class="o">=</span> <span class="n">nearest_neighbor_distance</span><span class="p">(</span>
</span><span id="process-1297"><a href="#process-1297"><span class="linenos">1297</span></a>            <span class="n">centroids</span><span class="o">=</span><span class="n">inst_properties</span><span class="o">.</span><span class="n">centroids</span>
</span><span id="process-1298"><a href="#process-1298"><span class="linenos">1298</span></a>        <span class="p">)</span>
</span><span id="process-1299"><a href="#process-1299"><span class="linenos">1299</span></a>        <span class="n">hio</span><span class="o">.</span><span class="n">add_to_h5</span><span class="p">(</span>
</span><span id="process-1300"><a href="#process-1300"><span class="linenos">1300</span></a>            <span class="n">nearest_neighbors</span><span class="p">,</span>
</span><span id="process-1301"><a href="#process-1301"><span class="linenos">1301</span></a>            <span class="n">h5_path</span><span class="o">=</span><span class="n">h5_path</span><span class="p">,</span>
</span><span id="process-1302"><a href="#process-1302"><span class="linenos">1302</span></a>            <span class="n">h5_group</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="process-1303"><a href="#process-1303"><span class="linenos">1303</span></a>        <span class="p">)</span>
</span><span id="process-1304"><a href="#process-1304"><span class="linenos">1304</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">instance_name</span><span class="si">}</span><span class="s2">&#39; neighborhood property data added&quot;</span><span class="p">)</span>
</span><span id="process-1305"><a href="#process-1305"><span class="linenos">1305</span></a>
</span><span id="process-1306"><a href="#process-1306"><span class="linenos">1306</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Processes a directory of images specified in a YAML file, creates a semantic image stack,
and performs instance analysis on all semantic label classes within the stack.
Saves all instance stacks and properties into an HDF5 file containing the original semantic image stack.</p>

<h2 id="parameters">Parameters</h2>

<p>yml_file : Path
    The fully pathed YAML file that specifies settings.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the process was successful, False otherwise.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">yml_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;path/to/input.yml&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">process</span><span class="p">(</span><span class="n">yml_file</span><span class="p">)</span>
<span class="go">True</span>
</code></pre>
</div>
</div>


                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-1309"><a href="#main-1309"><span class="linenos">1309</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="main-1310"><a href="#main-1310"><span class="linenos">1310</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-1311"><a href="#main-1311"><span class="linenos">1311</span></a><span class="sd">    Command-line interface for running instance analysis on image stacks.</span>
</span><span id="main-1312"><a href="#main-1312"><span class="linenos">1312</span></a>
</span><span id="main-1313"><a href="#main-1313"><span class="linenos">1313</span></a><span class="sd">    This function serves as the entry point for terminal-based access to the instance analysis module.</span>
</span><span id="main-1314"><a href="#main-1314"><span class="linenos">1314</span></a><span class="sd">    It is invoked from the command line using the &#39;instance_analysis&#39; command specified in pyproject.toml.</span>
</span><span id="main-1315"><a href="#main-1315"><span class="linenos">1315</span></a><span class="sd">    The function processes a YAML input file to create a semantic image stack and performs instance analysis</span>
</span><span id="main-1316"><a href="#main-1316"><span class="linenos">1316</span></a><span class="sd">    on all semantic label classes within the stack. The results, including instance stacks and properties,</span>
</span><span id="main-1317"><a href="#main-1317"><span class="linenos">1317</span></a><span class="sd">    are saved into an HDF5 file.</span>
</span><span id="main-1318"><a href="#main-1318"><span class="linenos">1318</span></a>
</span><span id="main-1319"><a href="#main-1319"><span class="linenos">1319</span></a><span class="sd">    Parameters</span>
</span><span id="main-1320"><a href="#main-1320"><span class="linenos">1320</span></a><span class="sd">    ----------</span>
</span><span id="main-1321"><a href="#main-1321"><span class="linenos">1321</span></a><span class="sd">    None</span>
</span><span id="main-1322"><a href="#main-1322"><span class="linenos">1322</span></a>
</span><span id="main-1323"><a href="#main-1323"><span class="linenos">1323</span></a><span class="sd">    Returns</span>
</span><span id="main-1324"><a href="#main-1324"><span class="linenos">1324</span></a><span class="sd">    -------</span>
</span><span id="main-1325"><a href="#main-1325"><span class="linenos">1325</span></a><span class="sd">    None</span>
</span><span id="main-1326"><a href="#main-1326"><span class="linenos">1326</span></a>
</span><span id="main-1327"><a href="#main-1327"><span class="linenos">1327</span></a><span class="sd">    Examples</span>
</span><span id="main-1328"><a href="#main-1328"><span class="linenos">1328</span></a><span class="sd">    --------</span>
</span><span id="main-1329"><a href="#main-1329"><span class="linenos">1329</span></a><span class="sd">    To run the instance analysis, use the following command in the terminal:</span>
</span><span id="main-1330"><a href="#main-1330"><span class="linenos">1330</span></a><span class="sd">    $ instance_analysis path/to/input.yml</span>
</span><span id="main-1331"><a href="#main-1331"><span class="linenos">1331</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="main-1332"><a href="#main-1332"><span class="linenos">1332</span></a>
</span><span id="main-1333"><a href="#main-1333"><span class="linenos">1333</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span id="main-1334"><a href="#main-1334"><span class="linenos">1334</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the .yml user input file&quot;</span><span class="p">)</span>
</span><span id="main-1335"><a href="#main-1335"><span class="linenos">1335</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="main-1336"><a href="#main-1336"><span class="linenos">1336</span></a>    <span class="n">input_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_file</span>
</span><span id="main-1337"><a href="#main-1337"><span class="linenos">1337</span></a>    <span class="n">process</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
</span><span id="main-1338"><a href="#main-1338"><span class="linenos">1338</span></a>
</span><span id="main-1339"><a href="#main-1339"><span class="linenos">1339</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2"> processed!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Command-line interface for running instance analysis on image stacks.</p>

<p>This function serves as the entry point for terminal-based access to the instance analysis module.
It is invoked from the command line using the 'instance_analysis' command specified in pyproject.toml.
The function processes a YAML input file to create a semantic image stack and performs instance analysis
on all semantic label classes within the stack. The results, including instance stacks and properties,
are saved into an HDF5 file.</p>

<h2 id="parameters">Parameters</h2>

<p>None</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="examples">Examples</h2>

<p>To run the instance analysis, use the following command in the terminal:
$ instance_analysis path/to/input.yml</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>